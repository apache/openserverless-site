name: test

on:
  push:
    branches:
      - main

env:
  PUBLISH_DIRECTORY: public

permissions:
  contents: write

jobs:
  tests:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    - name: Checkout Production
      if: github.ref_name == 'main'
      uses: actions/checkout@v4
      with:
        ref: asf-site
        path: ${{ env.PUBLISH_DIRECTORY }}
    - name: Install Hugo
      run: |
        sudo apt-get update
        sudo apt-get install -y hugo asciidoctor
    - name: Prepare
      working-directory: ${{ env.PUBLISH_DIRECTORY }}
      run: |
        rm -rf stylesheets
    - name: Build Hugo site
      run: |
        hugo mod clean --all
        hugo
  
    #- name: Deploy to ASF
    #  run: |
    #    cp -r public/* $GITHUB_WORKSPACE/public/