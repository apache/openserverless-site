<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=canonical type=text/html href=/docs/><link rel=alternate type=application/rss+xml href=/docs/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Docs | Apache OpenServerless™</title>
<meta name=description content="A Docsy example site"><meta property="og:url" content="/docs/"><meta property="og:site_name" content="Apache OpenServerless™"><meta property="og:title" content="Docs"><meta property="og:description" content="About Apache OpenServerless Apache OpenServerless is an Open Source project, released under the Apache License 2.0 providing a portable and complete Serverless environment, allowing to build quickly and easily cloud-native applications.
Our goal is to make OpenServerless ubitiquous, allowing it to easily run a complete and portable environment that runs in every Kubernetes.
OpenServerless is based on Apache OpenWhisk, which provides a powerful, production-ready serverless engine.
However, the serverless engine is just the beginning, because a serverless environment requires a set of integrated services."><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta itemprop=name content="Docs"><meta itemprop=description content="About Apache OpenServerless Apache OpenServerless is an Open Source project, released under the Apache License 2.0 providing a portable and complete Serverless environment, allowing to build quickly and easily cloud-native applications.
Our goal is to make OpenServerless ubitiquous, allowing it to easily run a complete and portable environment that runs in every Kubernetes.
OpenServerless is based on Apache OpenWhisk, which provides a powerful, production-ready serverless engine.
However, the serverless engine is just the beginning, because a serverless environment requires a set of integrated services."><meta itemprop=dateModified content="2024-10-30T00:05:05+01:00"><meta itemprop=wordCount content="209"><meta name=twitter:card content="summary"><meta name=twitter:title content="Docs"><meta name=twitter:description content="About Apache OpenServerless Apache OpenServerless is an Open Source project, released under the Apache License 2.0 providing a portable and complete Serverless environment, allowing to build quickly and easily cloud-native applications.
Our goal is to make OpenServerless ubitiquous, allowing it to easily run a complete and portable environment that runs in every Kubernetes.
OpenServerless is based on Apache OpenWhisk, which provides a powerful, production-ready serverless engine.
However, the serverless engine is just the beginning, because a serverless environment requires a set of integrated services."><link rel=preload href=/scss/main.min.19cc757d7643534ced6e4e22b958048fcaed7f38defabbadf5b3a5b200ee4d28.css as=style><link href=/scss/main.min.19cc757d7643534ced6e4e22b958048fcaed7f38defabbadf5b3a5b200ee4d28.css rel=stylesheet integrity><script src=/js/jquery-3.7.1.min.js></script><script defer src=/js/lunr-2.3.9.min.js></script><link rel=stylesheet href=/css/prism.css></head><body class=td-section><header><nav class="td-navbar js-navbar-scroll" data-bs-theme=dark><div class="container-fluid flex-column flex-md-row"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg viewBox="0 0 1024 781"><g stroke-width="2" fill="none" stroke-linecap="butt"><path stroke="#76a3c4" vector-effect="non-scaling-stroke" d="M438.8 120.98Q435.57 121.88 434.78 122.21 431.12 123.7 423.21 127.52"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M423.21 127.52C416.56 130.57 409.18 133.39 403.28 136.68Q394.42 141.62 387.66 147.15 379.83 153.54 367.83 164.27C360.8 170.55 354.15 177.8 347.45 184.72"/><path stroke="#76a3c4" vector-effect="non-scaling-stroke" d="M347.45 184.72 342.5 189.88Q342.21 190.18 341.84 190.38 341.07 190.8 341.03 191.71 341.01 192.11 340.65 191.92 340.53 191.86 340.4 191.9 339.91 192.07 339.71 192.6 339.03 194.41 337.73 195.89 337.39 196.28 337.81 195.97 337.86 195.93 337.92 195.9 338.54 195.6 338.12 196.15 335.04 200.12 332.21 203.99 332.03 204.23 331.79 204.04L331.46 203.78Q331.41 203.74 331.44 203.69 332.29 202.33 333.12 201.24 333.2 201.13 333.11 201 333.07 200.95 333.03 201 332.05 202.53 330.7 203.79 330.54 203.94 330.75 203.87 330.79 203.85 330.84 203.87 331.05 203.97 331.06 204.2 331.13 205.63 329.99 206.5A1.85 1.78 81.9 00329.4 207.32Q329.06 208.29 328.39 209.14 328.09 209.52 327.61 209.58 325.89 209.82 326 211.78A1.3 1.27-28 01325.72 212.66Q324.07 214.8 323.12 217.7"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M323.12 217.7 318.02 228.46"/><path stroke="#76a3c4" vector-effect="non-scaling-stroke" d="M318.02 228.46Q313.27 234.86 311.76 237.75 309.37 242.33 305.99 252.05 304.46 256.44 305.93 254.25"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M305.93 254.25Q305.62 255.63 304.89 256.82 304.77 257.01 304.97 257.12L305.2 257.24Q305.23 257.26 305.24 257.22 306.13 255.05 307.26 252.78 307.34 252.62 307.51 252.71L307.73 252.82Q307.75 252.84 307.74 252.86 306.25 255.22 305.41 257.9 304.19 261.82 302.64 265.97 302.35 266.75 301.89 267.38C300.98 268.59 301.07 270.27 300.39 271.68Q299.06 274.47 298.36 277.53 298.26 277.97 297.92 278.28 297.32 278.84 297.16 279.76 296.53 283.42 295.29 287.79C294.38 290.99 294.69 294.16 293.83 297.36 292.99 300.5 293.12 303.75 292.59 306.9Q290.82 317.42 290.83 332.15C290.83 348.21 291.88 362.54 296.59 377.96Q298.48 384.15 300.49 390.37 301.18 392.52 299.65 390.86 298.11 389.19 295.54 387.72 290.29 384.72 285.05 381.84"/><path stroke="#76a3c4" vector-effect="non-scaling-stroke" d="M285.05 381.84Q283.43 380.56 281.9 380.1C279.89 379.5 278.26 378.64 276.39 378.23 274.28 377.77 271.98 376.83 270.21 376.37Q255.65 372.58 240.43 373.13"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M240.43 373.13Q233.74 372.8 227 373.57 218.25 374.57 209.52 375.73 205.54 376.26 202.03 377.1 198.41 377.96 194.65 378.96 194.3 379.05 194.13 379.39A.74.72-79.5 01193.55 379.8Q189.92 380.15 187.2 381.49 184.73 382.71 182.18 383.81 179.39 385.01 177.01 386.52q-10.2 6.5-21.71 15.23-11.53 8.75-19.24 19.06C135.77 421.2 135.78 421.58 135.55 421.95Q132.47 426.87 128.69 431.08 125.96 434.1 123.91 437.19 121.72 440.47 119.57 443.8 119.26 444.28 119.09 444.83 118.95 445.24 118.63 445.53 116.84 447.17 116 449.6A1.7 1.69 80.4 01115.47 450.35Q115.1 450.66 114.87 451.08 111.96 456.46 110.57 460.85 109.15 465.35 107.7 469.25 104.74 477.22 102.44 485.43 102.33 485.83 102.71 485.65 103.01 485.5 102.86 485.13 102.81 485.01 102.88 485.11 102.9 485.13 102.93 485.15 102.99 485.16 102.97 485.22 101.22 490.96 100.5 495.31 98.77 505.78 98.79 517.39 98.79 517.88 98.5 518.29 98.25 518.63 98.23 519.04 97.87 528.44 98.18 537.77"/><path stroke="#76a3c4" vector-effect="non-scaling-stroke" d="M98.18 537.77Q98.75 547.92 100.1 554.97q3.73 19.49 13.1 38.62 15.56 31.76 43.03 52.74Q162.21 650.9 172.97 656.97 173.4 657.21 173.93 657.11 174.27 657.04 174.47 657.33 175.25 658.44 176.62 658.35 176.74 658.34 176.63 658.37 176.5 658.41 176.38 658.48 176.21 658.58 176.36 658.71 179.72 661.6 184.36 663.69 193.12 667.64 200.92 670.96 203.51 672.06 206.39 672.09C213.79 672.17 220.75 674.59 227.85 675.5Q241.51 677.25 258.42 677.27 335.37 677.38 410.89 677.26 415.61 677.25 421.31 677.06A.94.94.0 00422.22 676.12L422.48 603.46"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M422.48 603.46C422.72 519.97 422.5 436.49 422.59 353Q422.59 348.1 423.66 344.48C424.85 340.39 429.55 336.76 433.9 336.21Q436.66 335.85 439.49 335.86 494.27 335.98 572.06 335.69 584.93 335.64 589.91 334.78 597.94 333.4 606.26 330.74C615.95 327.65 626.03 324.05 635.5 320.14Q646.37 315.66 657.62 312.96 667.09 310.69 676.08 307.82 691.68 302.85 706.51 297.5 712.77 295.24 718.01 296.26"/><path stroke="#76a3c4" vector-effect="non-scaling-stroke" d="M718.01 296.26Q725.51 299 729.94 305.03 734.73 311.55 735.73 318.39 736.01 320.31 736.08 332.62 736.25 364.24 736.19 397 736.19 399.08 736.23 400.97"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M736.23 400.97Q735.9 449.45 735.46 497.75 735.19 527.79 736.15 604.08"/><path stroke="#76a3c4" vector-effect="non-scaling-stroke" d="M736.15 604.08 736.67 675.56A2.19 2.19.0 00738.87 677.73Q767.94 677.54 795.44 677.62 817.97 677.68 841.39 674.15 847.16 673.28 852.49 671.66C860.03 669.38 868.01 666.67 874.77 663.04 886.51 656.73 899.29 648.52 907.95 640.2Q915.92 632.55 923.63 625.37 929.31 620.09 933.33 613.73C935.19 610.8 937.51 608.42 939.12 605.35 940.33 603.02 941.92 600.89 943.21 598.54Q943.45 598.12 943.29 597.67L943.16 597.31A.83.81 57.5 01943.33 596.5Q944.29 595.46 944.39 593.99A1.71 1.69-26.2 01944.69 593.13Q945.61 591.77 945.97 590.12 946.3 588.59 946.91 587.17 949.11 582.1 951.27 576.84 951.72 575.76 951.83 574.56 951.94 573.38 952.44 572.26 953.13 570.7 953.66 569.03 955.4 563.55 956.49 558.44 958.79 547.6 959.78 535.62 961.35 516.61 958.61 497.75C957.77 492.01 956.07 486.17 954.92 480.43Q954.15 476.64 952.59 472.89 950.98 469.01 950.1 465.43 949.18 461.64 947.3 458.42C946.62 457.26 946.43 456.23 946.02 455.01Q945.59 453.76 944.8 452.54 943.11 449.92 941.65 447.11C941.28 446.4 941.38 445.57 941.14 445Q940.04 442.39 934.75 436.96"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M934.75 436.96c-13.04-17.58-27.99-33.32-46.72-44.66"/><path stroke="#76a3c4" vector-effect="non-scaling-stroke" d="M888.03 392.3Q882.24 387.36 875.24 384.36 875.2 384.34 875.22 384.3L875.35 384.08Q875.43 383.93 875.59 384L877.96 385.14Q877.99 385.16 878 385.13L878.15 384.9Q878.28 384.7 878.05 384.62 872.13 382.5 867.06 380.02 863.08 378.07 858.83 376.66 854.27 375.14 850.01 374.21 849.95 374.2 849.93 374.26L849.87 374.51A.03.03.0 00849.9 374.55Q857.11 375.83 861.77 378.39 864.48 379.88 861.51 379.04 859.01 378.34 856.67 377.6 852.48 376.26 846.15 375.67 846.1 375.67 846.08 375.63 846.06 375.57 846.12 375.55 846.17 375.54 846.21 375.55 847.25 375.84 848.13 375.69 848.82 375.58 848.13 375.43 844.1 374.56 840.02 375.3"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M840.02 375.3C831.63 374.33 823.73 372.69 814.84 373.31 813.35 373.41 812.06 372.84 810.51 372.87Q803.01 373.01 796.27 374.55C793.63 375.15 790.95 375.45 788.28 375.61Q787.88 375.64 787.61 375.92 787.23 376.32 786.68 376.4 780.74 377.31 775.04 379.37 770.87 380.88 764.64 384.8 759.7 387.91 754.7 391.19"/><path stroke="#76a3c4" vector-effect="non-scaling-stroke" d="M754.7 391.19Q756.26 383.46 757.81 375.98 759.76 366.58 760.51 360.7 763.46 337.48 761.63 314.17 760.99 306.01 758.91 294.37 757.01 283.7 754.89 272.75 752.59 260.84 747.54 249.46 745.67 245.25 743.7 240.2 741.38 234.25 736.66 226.75C735.76 225.32 735.24 223.86 734.21 222.51Q733.24 221.24 732.62 219.78C731.88 218.02 730.63 216.88 729.84 215.09 728.87 212.88 727.16 211.39 726.04 209.26Q724.69 206.7 722.92 204.55 721.11 202.35 719.49 200.03C716.95 196.39 714.67 192.59 711.27 189.61Q707.54 186.33 704.82 182.42C701.84 178.13 697.85 175.09 694.54 171.01 691.17 166.84 686.76 163.44 682.74 159.88 681.82 159.06 681.72 157.86 680.73 157.06Q677.63 154.54 674.69 152.45A.07.06-54.1 00674.6 152.47L674.46 152.68Q674.33 152.89 674.54 153.03 676.02 153.98 677.32 155.07 677.52 155.24 677.29 155.11C674.74 153.75 672.51 152.11 670.69 149.82Q669.3 148.07 667.31 146.74 660.44 142.14 653.7 138.48 648.98 135.92 644.35 132.84 639.79 129.81 632.39 126.59 617.15 119.97 605.94 116.26C604.1 115.65 602.23 115.81 600.47 115.15"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M600.47 115.15Q599.76 114.79 599.28 114.25"/><path stroke="#76a3c4" vector-effect="non-scaling-stroke" d="M599.28 114.25Q596.64 112.8 593.69 111.95 583.64 109.04 573.39 106.9 563.66 104.88 556.72 105.12"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M556.72 105.12Q535.59 102.85 519.25 103.18 496.98 103.62 471.85 109.31C463.27 111.26 455.62 114.24 447.42 117.07Q446.79 117.29 446.29 117.73 445.73 118.22 445.1 118.66 444.28 119.23 443.25 119.55 441.01 120.23 438.8 120.98"/><path stroke="#e2f3ff" vector-effect="non-scaling-stroke" d="M556.72 105.12Q564.58 106.17 572.15 108.42C574.83 109.21 577.17 109.07 579.82 109.64Q580.27 109.74 580.44 110.18 580.67 110.82 581.38 110.86 584.36 111.04 587.12 112.11C589.32 112.96 591.64 112.98 593.93 113.32Q594.18 113.36 596.46 114.17 597.76 114.63 599.28 114.25"/><path stroke="#e2f3ff" vector-effect="non-scaling-stroke" d="M600.47 115.15Q594.24 113.95 588.04 112.66 587.87 112.62 587.83 112.79 587.79 112.96 587.95 113.01 608.88 119.22 628.21 129.72C633.49 132.58 638.52 136.35 642.99 140.24q14.51 12.64 31.59 30.96Q681.7 178.84 686.51 185.46 692.99 194.41 696.62 201.36q10.9 20.91 18.41 47.15Q719.1 262.72 719.73 277.51 719.97 283.23 720.2 288.75 720.33 291.8 718.01 296.26"/><path stroke="#e2f3ff" vector-effect="non-scaling-stroke" d="M422.48 603.46 422.19 604.18Q421.98 604.7 421.43 604.61 416.66 603.86 412.59 603.87 348.88 604.09 284.71 603.84 267.13 603.77 251.02 602.46q-26.06-2.13-48.84-16.86C192.75 579.51 184.08 570.63 176.23 562.27 168.02 553.53 162.76 544.13 157.62 533.43Q155.23 528.46 153.32 520.84 150.92 511.24 149.17 502.91 148.38 499.18 148.32 495.49 148.17 486.3 148.6 475.52 148.73 472.34 149.5 469.45C150.03 467.49 149.69 465.7 150.07 463.83Q151.96 454.51 155.02 444.09 155.48 442.53 153.86 442.72 152.56 442.88 151.06 444.55 146.57 449.55 141.46 455.04 139.5 457.14 138.35 459.6C134.82 467.17 129.7 474.41 125.5 481.29Q121.17 488.38 116.92 498.43q-5.45 12.9-6.99 23.22C108.92 528.49 108.26 535.39 107.3 542.31Q107.23 542.83 106.78 543.08C101.52 546 99.61 542.27 98.18 537.77"/><path stroke="#e2f3ff" vector-effect="non-scaling-stroke" d="M240.43 373.13Q248.72 374.13 256.93 375.23C258.7 375.47 260.5 375.38 262.22 375.92Q264.38 376.6 266.46 376.63 268.9 376.67 270.74 377.14 278.05 378.99 285.05 381.84"/><path stroke="#e2f3ff" vector-effect="non-scaling-stroke" d="M305.93 254.25l12.09-25.79"/><path stroke="#e2f3ff" vector-effect="non-scaling-stroke" d="M323.12 217.7 323.73 217.65Q324.29 217.6 324.32 217.04 324.34 216.71 324.56 216.47 325.2 215.76 324.74 216.59 324.56 216.9 324.39 217.19 324.34 217.28 324.42 217.33 324.53 217.4 324.61 217.5 324.73 217.67 324.8 217.48L327.22 210.74Q327.33 210.44 327.62 210.57L327.88 210.69Q327.9 210.7 327.87 210.75L326.51 213.47Q326.35 213.8 326.68 213.96L326.95 214.1A.12.12.0 00327.11 214.04Q328.64 210.79 330.13 208.73 334.34 202.94 338.25 196.98C340.99 192.8 344.46 188.91 347.45 184.72"/><path stroke="#e2f3ff" vector-effect="non-scaling-stroke" d="M423.21 127.52l11.43-4.11Q434.84 123.34 434.69 123.5 434.59 123.61 434.43 123.71 433.68 124.17 434.55 124.09 434.86 124.06 435.14 123.85 436.98 122.44 438.8 120.98"/><path stroke="#e2f3ff" vector-effect="non-scaling-stroke" d="M754.7 391.19Q747.41 397.76 741.58 399.89 740.39 400.32 736.23 400.97"/><path stroke="#e2f3ff" vector-effect="non-scaling-stroke" d="M840.02 375.3Q848.37 376.89 856.74 378.43 858.39 378.73 859.67 379.4 861.35 380.28 862.67 380.11 863.04 380.06 862.71 380.22 862.58 380.28 862.61 380.45A.15.15.0 00862.73 380.57Q866.19 381.33 869.24 383.34 871.62 384.91 874.77 386.12 881.6 388.74 888.03 392.3"/><path stroke="#e2f3ff" vector-effect="non-scaling-stroke" d="M934.75 436.96Q933.36 439.7 931.62 440.82 930.42 441.59 929.18 440.89C920.72 436.1 912.25 432.32 903.95 427.51Q895.85 422.81 887.81 419.18A.49.49.0 00887.11 419.62Q887.09 420.94 887.79 422.07C891.49 428.02 895.07 433.53 898.27 440Q900.43 444.36 901.68 448 905.05 457.86 905.65 470.46 906.19 481.77 906.47 492.77 906.79 505.08 902.92 519.5C901.13 526.18 898.98 532.57 895.88 538.78Q889.94 550.64 883.64 559.19 875.85 569.75 866.31 577.47 846.68 593.35 821.44 600.21C811.7 602.85 801.87 603.19 791.75 603.52Q762.45 604.46 736.15 604.08"/><path stroke="#76a3c4" vector-effect="non-scaling-stroke" d="M572.05 680.95Q573.46 683.34 577.75 683.35 578.25 683.35 578.66 683.64 580.2 684.7 582 685.13 584.37 685.69 585.95 686.1 588.82 686.85 591.3 687.21C595.8 687.86 600.29 689.82 604.84 691.11Q618.05 694.87 630.86 698.4 635.66 699.73 651.25 702.9 652.68 703.19 654.31 703.37 655.83 703.54 657.52 704.26 660.29 705.43 664.46 705.55"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M664.46 705.55 700.51 716.23A.45.45.0 00701.07 715.67Q700.51 713.85 700.53 711.75 701.4 620.4 700.42 518.5 700.28 504.3 700.93 458.5 701.46 420.35 700.4 335.5 700.38 334.25 700.52 333.01A.89.88 85.1 00699.4 332.06Q679.62 337.71 665.91 342.7 641.72 351.5 619.65 358.49 592.44 367.1 572.6 374.15A1.9 1.89-9.9 00571.34 375.93Q571.18 513.33 571.39 654.5 571.41 667.76 572.05 680.95"/><path stroke="#e2f3ff" vector-effect="non-scaling-stroke" d="M664.46 705.55Q662.11 704.49 659.7 703.75 657.6 703.1 655.67 702.18 653.66 701.22 651.42 700.83C647.87 700.21 644.58 699.9 641.14 698.5Q637.25 696.91 633.31 695.66 624.29 692.77 614.98 690.12 607.98 688.12 599.95 686.55 588.3 684.27 584.74 683.66 576.99 682.31 572.05 680.95"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M506.73 508.96Q507.23 508.97 507.24 509.47L507.61 567.73A1.71 1.71.0 00509.29 569.43L512.14 569.48Q513.67 569.51 513.68 567.99L514.06 509.31A.65.65.0 01514.72 508.66Q524.38 508.75 533.37 508.51 534.45 508.49 535.45 508.14 536.77 507.68 535.94 506.56 525.56 492.62 516.03 477.72 513.11 473.15 510.64 468.22A.71.71.0 00509.34 468.32Q508.89 469.68 508.14 470.81 499.59 483.62 490.59 498.33C488.69 501.42 486.13 503.98 484.7 507.4A.85.84-75.5 00485.38 508.57C492.34 509.35 499.77 508.84 506.73 508.96"/><path stroke="#e2f3ff" vector-effect="non-scaling-stroke" d="M323.4069 219.9496A.86.45 98.9 00323.9846 219.1696.86.45 98.9 00323.6731 218.2504.86.45 98.9 00323.0954 219.0304.86.45 98.9 00323.4069 219.9496"/><path stroke="#76a3c4" vector-effect="non-scaling-stroke" d="M562.87 105.64Q563.01 105.79 563.21 105.74 563.58 105.65 563.24 105.48 563.06 105.39 562.89 105.5A.09.09.0 00562.87 105.64"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M679.22 372.53C679.23 371.09 679.54 369.88 679.85 368.51A.54.54.0 00679.29 367.85Q677.1 368.03 675.2 368.64 662.08 372.86 652.04 375.23 641.91 377.62 633.09 380.61 616.35 386.29 597.27 393.54C595.19 394.33 594.11 394.37 594.1 396.75Q593.82 453.73 594.23 510.63A.53.53.0 00594.87 511.14C612.16 507.54 629.52 503.71 647.2 500.59Q662.96 497.81 678.69 494.94 679.2 494.85 679.2 494.33 679.02 429.9 679.22 372.53"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M679.1894 535.7817a14.73 13.11 84.9 0011.7487-15.8371 14.73 13.11 84.9 00-14.3675-13.5063 14.73 13.11 84.9 00-11.7487 15.8371 14.73 13.11 84.9 0014.3675 13.5063"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M653.47 677.48C653.58 677.65 653.78 677.81 653.97 677.85Q666.29 680.76 678.03 684.83A.8.79-79.7 00679.09 684.09C679.65 637.75 679.02 593.21 679.12 547.6Q679.12 546.36 677.91 546.11 673.94 545.3 670.08 544.24C662.1 542.05 657.76 536.87 655.27 529.33A.58.57 76.9 00654.64 528.93Q625.29 532.84 594.78 537.76A.97.97.0 00593.96 538.72L594.14 660.05A1.82 1.81-79.8 00595.31 661.75Q600.8 663.83 606.74 665.66 624.02 670.98 642.31 674.66 645.11 675.22 647.69 676.02 650.42 676.85 653.38 677.42 653.44 677.43 653.47 677.48"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M663.15 390.16A.99.99.0 00661.85 389.22l-51.99 17.14A.99.99.0 00609.19 407.31L609.77 491.24A.99.99.0 00610.99 492.19L662.55 480A.99.99.0 00663.31 479.04L663.15 390.16"/><path stroke="#93b0c4" vector-effect="non-scaling-stroke" d="M610.01 645.38C610.01 646.98 610.77 648.42 612.26 649.06 620.63 652.63 629.2 654.01 637.6 656.47Q649.19 659.86 661.88 663.03 663.27 663.38 663.33 661.95 663.43 659.77 663.43 657.69 663.36 600.71 663.09 550.52A1.49 1.48 1.9 00661.71 549.05Q658.24 548.79 654.88 548.95 640.98 549.6 624.11 551.2 617.1 551.87 609.98 552.02A.46.45-1.3 00609.53 552.48Q609.94 600.04 610.01 645.38"/></g><path fill="#276089" d="M255.43 337.58A1.16 1.15-8 00256.16 336.62Q256.94 329.44 256.97 321.89 257.01 312.67 258.49 300.83 260.97 280.96 264.63 264.23 267.08 253.08 270.94 243.18C272.28 239.75 274.57 236.93 276.22 233.52 282.54 220.44 289.18 206.77 297.09 195.08c14.64-21.65 32.53-44.29 51-59.85Q358.75 126.26 377.98 112.74 386.74 106.58 396.21 101.52q32.66-17.44 64.71-24.98C478.3 72.45 497.66 69.39 516.24 68.95Q539.13 68.4 559.76 70.68 603.35 75.49 639 92.39c15.7 7.44 31.16 15.56 45.33 25.63C708.06 134.9 728.25 153.79 745.77 178.17q28.53 39.69 41.12 83.29C789.89 271.86 792.34 283.71 793.66 294.66Q796.2 315.76 797.41 337.48A1.29 1.29.0 00798.69 338.7Q815.49 338.72 831.21 339.39C868.91 341 905.17 359.29 933.64 383.01 939.46 387.86 944.72 394.3 949.76 400.34 970.1 424.7 985.53 454.74 991.58 486.07Q997.12 514.79 994.49 540.6 989.42 590.5 960.66 630.97 946.97 650.24 931.32 664.82 918.69 676.6 899.38 686.96 880.83 696.92 863.47 701.77 836.07 709.42 806.25 710.24 774.38 711.1 736.61 711.19A1.97 1.96 7.1 00734.72 712.66C734.18 714.76 733.61 717.01 733.65 719.2 733.84 728.71 732.87 743.34 721.34 746.39Q718.5 747.14 716.12 748.82 715.67 749.14 715.13 749.15 713.55 749.18 711.03 748.73C690.73 745.11 671.12 739.21 651.67 733.55 640.94 730.43 629.8 726.69 618.56 723.66Q594.7 717.23 575.34 712.41 569.8 711.03 554.9 710.73C535.85 710.34 517.09 709.97 498.26 710.05Q426.4 710.36 354.01 711.11C327.54 711.39 300.74 711.31 273.96 711.36Q244.61 711.41 219.84 708.3 208.25 706.84 188 700.75 172.03 695.95 155.79 686.75 144.05 680.09 137 674.83c-19.35-14.45-34.77-33.51-48.28-53.75C85.29 615.94 82.26 610.27 79.9 604.58 72.57 586.93 66.35 568.74 63.94 550.49 62.68 540.98 61.35 531.56 61.65 521.49q1.04-35.65 13.88-70.2Q79.3 441.12 83.46 433.44q17.03-31.42 43.33-53.64c21.23-17.94 45.35-29.63 72.03-36.95C216.78 337.93 234.03 338.04 253.26 337.98Q254.42 337.98 255.43 337.58zM438.8 120.98Q435.57 121.88 434.78 122.21 431.12 123.7 423.21 127.52C416.56 130.57 409.18 133.39 403.28 136.68Q394.42 141.62 387.66 147.15 379.83 153.54 367.83 164.27C360.8 170.55 354.15 177.8 347.45 184.72L342.5 189.88Q342.21 190.18 341.84 190.38 341.07 190.8 341.03 191.71 341.01 192.11 340.65 191.92 340.53 191.86 340.4 191.9 339.91 192.07 339.71 192.6 339.03 194.41 337.73 195.89 337.39 196.28 337.81 195.97 337.86 195.93 337.92 195.9 338.54 195.6 338.12 196.15 335.04 200.12 332.21 203.99 332.03 204.23 331.79 204.04L331.46 203.78Q331.41 203.74 331.44 203.69 332.29 202.33 333.12 201.24 333.2 201.13 333.11 201 333.07 200.95 333.03 201 332.05 202.53 330.7 203.79 330.54 203.94 330.75 203.87 330.79 203.85 330.84 203.87 331.05 203.97 331.06 204.2 331.13 205.63 329.99 206.5A1.85 1.78 81.9 00329.4 207.32Q329.06 208.29 328.39 209.14 328.09 209.52 327.61 209.58 325.89 209.82 326 211.78A1.3 1.27-28 01325.72 212.66Q324.07 214.8 323.12 217.7L318.02 228.46Q313.27 234.86 311.76 237.75 309.37 242.33 305.99 252.05 304.46 256.44 305.93 254.25 305.62 255.63 304.89 256.82 304.77 257.01 304.97 257.12L305.2 257.24Q305.23 257.26 305.24 257.22 306.13 255.05 307.26 252.78 307.34 252.62 307.51 252.71L307.73 252.82Q307.75 252.84 307.74 252.86 306.25 255.22 305.41 257.9 304.19 261.82 302.64 265.97 302.35 266.75 301.89 267.38C300.98 268.59 301.07 270.27 300.39 271.68Q299.06 274.47 298.36 277.53 298.26 277.97 297.92 278.28 297.32 278.84 297.16 279.76 296.53 283.42 295.29 287.79C294.38 290.99 294.69 294.16 293.83 297.36 292.99 300.5 293.12 303.75 292.59 306.9Q290.82 317.42 290.83 332.15C290.83 348.21 291.88 362.54 296.59 377.96Q298.48 384.15 300.49 390.37 301.18 392.52 299.65 390.86 298.11 389.19 295.54 387.72 290.29 384.72 285.05 381.84 283.43 380.56 281.9 380.1C279.89 379.5 278.26 378.64 276.39 378.23 274.28 377.77 271.98 376.83 270.21 376.37Q255.65 372.58 240.43 373.13 233.74 372.8 227 373.57 218.25 374.57 209.52 375.73 205.54 376.26 202.03 377.1 198.41 377.96 194.65 378.96 194.3 379.05 194.13 379.39A.74.72-79.5 01193.55 379.8Q189.92 380.15 187.2 381.49 184.73 382.71 182.18 383.81 179.39 385.01 177.01 386.52q-10.2 6.5-21.71 15.23-11.53 8.75-19.24 19.06C135.77 421.2 135.78 421.58 135.55 421.95Q132.47 426.87 128.69 431.08 125.96 434.1 123.91 437.19 121.72 440.47 119.57 443.8 119.26 444.28 119.09 444.83 118.95 445.24 118.63 445.53 116.84 447.17 116 449.6A1.7 1.69 80.4 01115.47 450.35Q115.1 450.66 114.87 451.08 111.96 456.46 110.57 460.85 109.15 465.35 107.7 469.25 104.74 477.22 102.44 485.43 102.33 485.83 102.71 485.65 103.01 485.5 102.86 485.13 102.81 485.01 102.88 485.11 102.9 485.13 102.93 485.15 102.99 485.16 102.97 485.22 101.22 490.96 100.5 495.31 98.77 505.78 98.79 517.39 98.79 517.88 98.5 518.29 98.25 518.63 98.23 519.04 97.87 528.44 98.18 537.77 98.75 547.92 100.1 554.97q3.73 19.49 13.1 38.62 15.56 31.76 43.03 52.74Q162.21 650.9 172.97 656.97 173.4 657.21 173.93 657.11 174.27 657.04 174.47 657.33 175.25 658.44 176.62 658.35 176.74 658.34 176.63 658.37 176.5 658.41 176.38 658.48 176.21 658.58 176.36 658.71 179.72 661.6 184.36 663.69 193.12 667.64 200.92 670.96 203.51 672.06 206.39 672.09C213.79 672.17 220.75 674.59 227.85 675.5Q241.51 677.25 258.42 677.27 335.37 677.38 410.89 677.26 415.61 677.25 421.31 677.06A.94.94.0 00422.22 676.12L422.48 603.46C422.72 519.97 422.5 436.49 422.59 353Q422.59 348.1 423.66 344.48C424.85 340.39 429.55 336.76 433.9 336.21Q436.66 335.85 439.49 335.86 494.27 335.98 572.06 335.69 584.93 335.64 589.91 334.78 597.94 333.4 606.26 330.74C615.95 327.65 626.03 324.05 635.5 320.14Q646.37 315.66 657.62 312.96 667.09 310.69 676.08 307.82 691.68 302.85 706.51 297.5 712.77 295.24 718.01 296.26 725.51 299 729.94 305.03 734.73 311.55 735.73 318.39 736.01 320.31 736.08 332.62 736.25 364.24 736.19 397 736.19 399.08 736.23 400.97 735.9 449.45 735.46 497.75 735.19 527.79 736.15 604.08L736.67 675.56A2.19 2.19.0 00738.87 677.73Q767.94 677.54 795.44 677.62 817.97 677.68 841.39 674.15 847.16 673.28 852.49 671.66C860.03 669.38 868.01 666.67 874.77 663.04 886.51 656.73 899.29 648.52 907.95 640.2Q915.92 632.55 923.63 625.37 929.31 620.09 933.33 613.73C935.19 610.8 937.51 608.42 939.12 605.35 940.33 603.02 941.92 600.89 943.21 598.54Q943.45 598.12 943.29 597.67L943.16 597.31A.83.81 57.5 01943.33 596.5Q944.29 595.46 944.39 593.99A1.71 1.69-26.2 01944.69 593.13Q945.61 591.77 945.97 590.12 946.3 588.59 946.91 587.17 949.11 582.1 951.27 576.84 951.72 575.76 951.83 574.56 951.94 573.38 952.44 572.26 953.13 570.7 953.66 569.03 955.4 563.55 956.49 558.44 958.79 547.6 959.78 535.62 961.35 516.61 958.61 497.75C957.77 492.01 956.07 486.17 954.92 480.43Q954.15 476.64 952.59 472.89 950.98 469.01 950.1 465.43 949.18 461.64 947.3 458.42C946.62 457.26 946.43 456.23 946.02 455.01Q945.59 453.76 944.8 452.54 943.11 449.92 941.65 447.11C941.28 446.4 941.38 445.57 941.14 445Q940.04 442.39 934.75 436.96c-13.04-17.58-27.99-33.32-46.72-44.66Q882.24 387.36 875.24 384.36 875.2 384.34 875.22 384.3L875.35 384.08Q875.43 383.93 875.59 384L877.96 385.14Q877.99 385.16 878 385.13L878.15 384.9Q878.28 384.7 878.05 384.62 872.13 382.5 867.06 380.02 863.08 378.07 858.83 376.66 854.27 375.14 850.01 374.21 849.95 374.2 849.93 374.26L849.87 374.51A.03.03.0 00849.9 374.55Q857.11 375.83 861.77 378.39 864.48 379.88 861.51 379.04 859.01 378.34 856.67 377.6 852.48 376.26 846.15 375.67 846.1 375.67 846.08 375.63 846.06 375.57 846.12 375.55 846.17 375.54 846.21 375.55 847.25 375.84 848.13 375.69 848.82 375.58 848.13 375.43 844.1 374.56 840.02 375.3C831.63 374.33 823.73 372.69 814.84 373.31 813.35 373.41 812.06 372.84 810.51 372.87Q803.01 373.01 796.27 374.55C793.63 375.15 790.95 375.45 788.28 375.61Q787.88 375.64 787.61 375.92 787.23 376.32 786.68 376.4 780.74 377.31 775.04 379.37 770.87 380.88 764.64 384.8 759.7 387.91 754.7 391.19 756.26 383.46 757.81 375.98 759.76 366.58 760.51 360.7 763.46 337.48 761.63 314.17 760.99 306.01 758.91 294.37 757.01 283.7 754.89 272.75 752.59 260.84 747.54 249.46 745.67 245.25 743.7 240.2 741.38 234.25 736.66 226.75C735.76 225.32 735.24 223.86 734.21 222.51Q733.24 221.24 732.62 219.78C731.88 218.02 730.63 216.88 729.84 215.09 728.87 212.88 727.16 211.39 726.04 209.26Q724.69 206.7 722.92 204.55 721.11 202.35 719.49 200.03C716.95 196.39 714.67 192.59 711.27 189.61Q707.54 186.33 704.82 182.42C701.84 178.13 697.85 175.09 694.54 171.01 691.17 166.84 686.76 163.44 682.74 159.88 681.82 159.06 681.72 157.86 680.73 157.06Q677.63 154.54 674.69 152.45A.07.06-54.1 00674.6 152.47L674.46 152.68Q674.33 152.89 674.54 153.03 676.02 153.98 677.32 155.07 677.52 155.24 677.29 155.11C674.74 153.75 672.51 152.11 670.69 149.82Q669.3 148.07 667.31 146.74 660.44 142.14 653.7 138.48 648.98 135.92 644.35 132.84 639.79 129.81 632.39 126.59 617.15 119.97 605.94 116.26C604.1 115.65 602.23 115.81 600.47 115.15Q599.76 114.79 599.28 114.25 596.64 112.8 593.69 111.95 583.64 109.04 573.39 106.9 563.66 104.88 556.72 105.12 535.59 102.85 519.25 103.18 496.98 103.62 471.85 109.31C463.27 111.26 455.62 114.24 447.42 117.07Q446.79 117.29 446.29 117.73 445.73 118.22 445.1 118.66 444.28 119.23 443.25 119.55 441.01 120.23 438.8 120.98zM572.05 680.95Q573.46 683.34 577.75 683.35 578.25 683.35 578.66 683.64 580.2 684.7 582 685.13 584.37 685.69 585.95 686.1 588.82 686.85 591.3 687.21C595.8 687.86 600.29 689.82 604.84 691.11Q618.05 694.87 630.86 698.4 635.66 699.73 651.25 702.9 652.68 703.19 654.31 703.37 655.83 703.54 657.52 704.26 660.29 705.43 664.46 705.55L700.51 716.23A.45.45.0 00701.07 715.67Q700.51 713.85 700.53 711.75 701.4 620.4 700.42 518.5 700.28 504.3 700.93 458.5 701.46 420.35 700.4 335.5 700.38 334.25 700.52 333.01A.89.88 85.1 00699.4 332.06Q679.62 337.71 665.91 342.7 641.72 351.5 619.65 358.49 592.44 367.1 572.6 374.15A1.9 1.89-9.9 00571.34 375.93Q571.18 513.33 571.39 654.5 571.41 667.76 572.05 680.95zM506.73 508.96Q507.23 508.97 507.24 509.47L507.61 567.73A1.71 1.71.0 00509.29 569.43L512.14 569.48Q513.67 569.51 513.68 567.99L514.06 509.31A.65.65.0 01514.72 508.66Q524.38 508.75 533.37 508.51 534.45 508.49 535.45 508.14 536.77 507.68 535.94 506.56 525.56 492.62 516.03 477.72 513.11 473.15 510.64 468.22A.71.71.0 00509.34 468.32Q508.89 469.68 508.14 470.81 499.59 483.62 490.59 498.33C488.69 501.42 486.13 503.98 484.7 507.4A.85.84-75.5 00485.38 508.57C492.34 509.35 499.77 508.84 506.73 508.96z"/><path fill="#fff" d="M556.72 105.12Q564.58 106.17 572.15 108.42C574.83 109.21 577.17 109.07 579.82 109.64Q580.27 109.74 580.44 110.18 580.67 110.82 581.38 110.86 584.36 111.04 587.12 112.11C589.32 112.96 591.64 112.98 593.93 113.32Q594.18 113.36 596.46 114.17 597.76 114.63 599.28 114.25 599.76 114.79 600.47 115.15 594.24 113.95 588.04 112.66 587.87 112.62 587.83 112.79 587.79 112.96 587.95 113.01 608.88 119.22 628.21 129.72C633.49 132.58 638.52 136.35 642.99 140.24q14.51 12.64 31.59 30.96Q681.7 178.84 686.51 185.46 692.99 194.41 696.62 201.36q10.9 20.91 18.41 47.15Q719.1 262.72 719.73 277.51 719.97 283.23 720.2 288.75 720.33 291.8 718.01 296.26 712.77 295.24 706.51 297.5 691.68 302.85 676.08 307.82 667.09 310.69 657.62 312.96 646.37 315.66 635.5 320.14C626.03 324.05 615.95 327.65 606.26 330.74Q597.94 333.4 589.91 334.78 584.93 335.64 572.06 335.69 494.27 335.98 439.49 335.86 436.66 335.85 433.9 336.21C429.55 336.76 424.85 340.39 423.66 344.48Q422.59 348.1 422.59 353C422.5 436.49 422.72 519.97 422.48 603.46L422.19 604.18Q421.98 604.7 421.43 604.61 416.66 603.86 412.59 603.87 348.88 604.09 284.71 603.84 267.13 603.77 251.02 602.46q-26.06-2.13-48.84-16.86C192.75 579.51 184.08 570.63 176.23 562.27 168.02 553.53 162.76 544.13 157.62 533.43Q155.23 528.46 153.32 520.84 150.92 511.24 149.17 502.91 148.38 499.18 148.32 495.49 148.17 486.3 148.6 475.52 148.73 472.34 149.5 469.45C150.03 467.49 149.69 465.7 150.07 463.83Q151.96 454.51 155.02 444.09 155.48 442.53 153.86 442.72 152.56 442.88 151.06 444.55 146.57 449.55 141.46 455.04 139.5 457.14 138.35 459.6C134.82 467.17 129.7 474.41 125.5 481.29Q121.17 488.38 116.92 498.43q-5.45 12.9-6.99 23.22C108.92 528.49 108.26 535.39 107.3 542.31Q107.23 542.83 106.78 543.08C101.52 546 99.61 542.27 98.18 537.77Q97.87 528.44 98.23 519.04 98.25 518.63 98.5 518.29 98.79 517.88 98.79 517.39 98.77 505.78 100.5 495.31 101.22 490.96 102.97 485.22 102.99 485.16 102.93 485.15 102.9 485.13 102.88 485.11 102.81 485.01 102.86 485.13 103.01 485.5 102.71 485.65 102.33 485.83 102.44 485.43 104.74 477.22 107.7 469.25 109.15 465.35 110.57 460.85 111.96 456.46 114.87 451.08 115.1 450.66 115.47 450.35A1.7 1.69 80.4 00116 449.6Q116.84 447.17 118.63 445.53 118.95 445.24 119.09 444.83 119.26 444.28 119.57 443.8 121.72 440.47 123.91 437.19 125.96 434.1 128.69 431.08 132.47 426.87 135.55 421.95C135.78 421.58 135.77 421.2 136.06 420.81Q143.77 410.5 155.3 401.75 166.81 393.02 177.01 386.52 179.39 385.01 182.18 383.81 184.73 382.71 187.2 381.49 189.92 380.15 193.55 379.8A.74.72-79.5 00194.13 379.39Q194.3 379.05 194.65 378.96 198.41 377.96 202.03 377.1 205.54 376.26 209.52 375.73 218.25 374.57 227 373.57 233.74 372.8 240.43 373.13 248.72 374.13 256.93 375.23C258.7 375.47 260.5 375.38 262.22 375.92Q264.38 376.6 266.46 376.63 268.9 376.67 270.74 377.14 278.05 378.99 285.05 381.84 290.29 384.72 295.54 387.72 298.11 389.19 299.65 390.86 301.18 392.52 300.49 390.37 298.48 384.15 296.59 377.96C291.88 362.54 290.83 348.21 290.83 332.15Q290.82 317.42 292.59 306.9C293.12 303.75 292.99 300.5 293.83 297.36 294.69 294.16 294.38 290.99 295.29 287.79Q296.53 283.42 297.16 279.76 297.32 278.84 297.92 278.28 298.26 277.97 298.36 277.53 299.06 274.47 300.39 271.68C301.07 270.27 300.98 268.59 301.89 267.38Q302.35 266.75 302.64 265.97 304.19 261.82 305.41 257.9 306.25 255.22 307.74 252.86 307.75 252.84 307.73 252.82L307.51 252.71Q307.34 252.62 307.26 252.78 306.13 255.05 305.24 257.22 305.23 257.26 305.2 257.24L304.97 257.12Q304.77 257.01 304.89 256.82 305.62 255.63 305.93 254.25l12.09-25.79L323.12 217.7 323.73 217.65Q324.29 217.6 324.32 217.04 324.34 216.71 324.56 216.47 325.2 215.76 324.74 216.59 324.56 216.9 324.39 217.19 324.34 217.28 324.42 217.33 324.53 217.4 324.61 217.5 324.73 217.67 324.8 217.48L327.22 210.74Q327.33 210.44 327.62 210.57L327.88 210.69Q327.9 210.7 327.87 210.75L326.51 213.47Q326.35 213.8 326.68 213.96L326.95 214.1A.12.12.0 00327.11 214.04Q328.64 210.79 330.13 208.73 334.34 202.94 338.25 196.98C340.99 192.8 344.46 188.91 347.45 184.72 354.15 177.8 360.8 170.55 367.83 164.27q12-10.73 19.83-17.12Q394.42 141.62 403.28 136.68C409.18 133.39 416.56 130.57 423.21 127.52l11.43-4.11Q434.84 123.34 434.69 123.5 434.59 123.61 434.43 123.71 433.68 124.17 434.55 124.09 434.86 124.06 435.14 123.85 436.98 122.44 438.8 120.98 441.01 120.23 443.25 119.55 444.28 119.23 445.1 118.66 445.73 118.22 446.29 117.73 446.79 117.29 447.42 117.07C455.62 114.24 463.27 111.26 471.85 109.31q25.13-5.69 47.4-6.13Q535.59 102.85 556.72 105.12zM323.4069 219.9496A.86.45 98.9 00323.9846 219.1696.86.45 98.9 00323.6731 218.2504.86.45 98.9 00323.0954 219.0304.86.45 98.9 00323.4069 219.9496z"/><path fill="#c4e6ff" d="M599.28 114.25Q597.76 114.63 596.46 114.17 594.18 113.36 593.93 113.32C591.64 112.98 589.32 112.96 587.12 112.11Q584.36 111.04 581.38 110.86 580.67 110.82 580.44 110.18 580.27 109.74 579.82 109.64C577.17 109.07 574.83 109.21 572.15 108.42Q564.58 106.17 556.72 105.12 563.66 104.88 573.39 106.9 583.64 109.04 593.69 111.95 596.64 112.8 599.28 114.25zm-36.41-8.61Q563.01 105.79 563.21 105.74 563.58 105.65 563.24 105.48 563.06 105.39 562.89 105.5A.09.09.0 00562.87 105.64z"/><path fill="#276089" d="M562.87 105.64A.09.09.0 01562.89 105.5Q563.06 105.39 563.24 105.48 563.58 105.65 563.21 105.74 563.01 105.79 562.87 105.64z"/><path fill="#c4e6ff" d="M600.47 115.15C602.23 115.81 604.1 115.65 605.94 116.26Q617.15 119.97 632.39 126.59 639.79 129.81 644.35 132.84 648.98 135.92 653.7 138.48 660.44 142.14 667.31 146.74 669.3 148.07 670.69 149.82C672.51 152.11 674.74 153.75 677.29 155.11Q677.52 155.24 677.32 155.07 676.02 153.98 674.54 153.03 674.33 152.89 674.46 152.68L674.6 152.47A.07.06-54.1 01674.69 152.45Q677.63 154.54 680.73 157.06C681.72 157.86 681.82 159.06 682.74 159.88 686.76 163.44 691.17 166.84 694.54 171.01 697.85 175.09 701.84 178.13 704.82 182.42Q707.54 186.33 711.27 189.61C714.67 192.59 716.95 196.39 719.49 200.03Q721.11 202.35 722.92 204.55 724.69 206.7 726.04 209.26C727.16 211.39 728.87 212.88 729.84 215.09 730.63 216.88 731.88 218.02 732.62 219.78Q733.24 221.24 734.21 222.51C735.24 223.86 735.76 225.32 736.66 226.75Q741.38 234.25 743.7 240.2 745.67 245.25 747.54 249.46 752.59 260.84 754.89 272.75 757.01 283.7 758.91 294.37 760.99 306.01 761.63 314.17 763.46 337.48 760.51 360.7 759.76 366.58 757.81 375.98 756.26 383.46 754.7 391.19 747.41 397.76 741.58 399.89 740.39 400.32 736.23 400.97 736.19 399.08 736.19 397 736.25 364.24 736.08 332.62 736.01 320.31 735.73 318.39 734.73 311.55 729.94 305.03 725.51 299 718.01 296.26 720.33 291.8 720.2 288.75 719.97 283.23 719.73 277.51 719.1 262.72 715.03 248.51 707.52 222.27 696.62 201.36 692.99 194.41 686.51 185.46 681.7 178.84 674.58 171.2q-17.08-18.32-31.59-30.96C638.52 136.35 633.49 132.58 628.21 129.72q-19.33-10.5-40.26-16.71Q587.79 112.96 587.83 112.79 587.87 112.62 588.04 112.66 594.24 113.95 600.47 115.15z"/><path fill="#c4e6ff" d="M438.8 120.98Q436.98 122.44 435.14 123.85 434.86 124.06 434.55 124.09 433.68 124.17 434.43 123.71 434.59 123.61 434.69 123.5 434.84 123.34 434.64 123.41l-11.43 4.11Q431.12 123.7 434.78 122.21 435.57 121.88 438.8 120.98z"/><path fill="#c4e6ff" d="M347.45 184.72C344.46 188.91 340.99 192.8 338.25 196.98Q334.34 202.94 330.13 208.73 328.64 210.79 327.11 214.04A.12.12.0 01326.95 214.1L326.68 213.96Q326.35 213.8 326.51 213.47L327.87 210.75Q327.9 210.7 327.88 210.69L327.62 210.57Q327.33 210.44 327.22 210.74L324.8 217.48Q324.73 217.67 324.61 217.5 324.53 217.4 324.42 217.33 324.34 217.28 324.39 217.19 324.56 216.9 324.74 216.59 325.2 215.76 324.56 216.47 324.34 216.71 324.32 217.04 324.29 217.6 323.73 217.65L323.12 217.7Q324.07 214.8 325.72 212.66A1.3 1.27-28 00326 211.78Q325.89 209.82 327.61 209.58 328.09 209.52 328.39 209.14 329.06 208.29 329.4 207.32A1.85 1.78 81.9 01329.99 206.5Q331.13 205.63 331.06 204.2 331.05 203.97 330.84 203.87 330.79 203.85 330.75 203.87 330.54 203.94 330.7 203.79 332.05 202.53 333.03 201 333.07 200.95 333.11 201 333.2 201.13 333.12 201.24 332.29 202.33 331.44 203.69 331.41 203.74 331.46 203.78L331.79 204.04Q332.03 204.23 332.21 203.99 335.04 200.12 338.12 196.15 338.54 195.6 337.92 195.9 337.86 195.93 337.81 195.97 337.39 196.28 337.73 195.89 339.03 194.41 339.71 192.6 339.91 192.07 340.4 191.9 340.53 191.86 340.65 191.92 341.01 192.11 341.03 191.71 341.07 190.8 341.84 190.38 342.21 190.18 342.5 189.88L347.45 184.72z"/><ellipse fill="#c4e6ff" cx="0" cy="0" transform="translate(323.54,219.10) rotate(98.9)" rx=".86" ry=".45"/><path fill="#c4e6ff" d="M305.93 254.25Q304.46 256.44 305.99 252.05 309.37 242.33 311.76 237.75 313.27 234.86 318.02 228.46l-12.09 25.79z"/><path fill="#fff" d="M664.46 705.55Q662.11 704.49 659.7 703.75 657.6 703.1 655.67 702.18 653.66 701.22 651.42 700.83C647.87 700.21 644.58 699.9 641.14 698.5Q637.25 696.91 633.31 695.66 624.29 692.77 614.98 690.12 607.98 688.12 599.95 686.55 588.3 684.27 584.74 683.66 576.99 682.31 572.05 680.95 571.41 667.76 571.39 654.5 571.18 513.33 571.34 375.93A1.9 1.89-9.9 01572.6 374.15Q592.44 367.1 619.65 358.49 641.72 351.5 665.91 342.7 679.62 337.71 699.4 332.06A.89.88 85.1 01700.52 333.01Q700.38 334.25 700.4 335.5 701.46 420.35 700.93 458.5 700.28 504.3 700.42 518.5 701.4 620.4 700.53 711.75 700.51 713.85 701.07 715.67A.45.45.0 01700.51 716.23L664.46 705.55zm14.76-333.02C679.23 371.09 679.54 369.88 679.85 368.51A.54.54.0 00679.29 367.85Q677.1 368.03 675.2 368.64 662.08 372.86 652.04 375.23 641.91 377.62 633.09 380.61 616.35 386.29 597.27 393.54C595.19 394.33 594.11 394.37 594.1 396.75Q593.82 453.73 594.23 510.63A.53.53.0 00594.87 511.14C612.16 507.54 629.52 503.71 647.2 500.59Q662.96 497.81 678.69 494.94 679.2 494.85 679.2 494.33 679.02 429.9 679.22 372.53zM679.1894 535.7817a14.73 13.11 84.9 0011.7487-15.8371 14.73 13.11 84.9 00-14.3675-13.5063 14.73 13.11 84.9 00-11.7487 15.8371 14.73 13.11 84.9 0014.3675 13.5063zM653.47 677.48C653.58 677.65 653.78 677.81 653.97 677.85Q666.29 680.76 678.03 684.83A.8.79-79.7 00679.09 684.09C679.65 637.75 679.02 593.21 679.12 547.6Q679.12 546.36 677.91 546.11 673.94 545.3 670.08 544.24C662.1 542.05 657.76 536.87 655.27 529.33A.58.57 76.9 00654.64 528.93Q625.29 532.84 594.78 537.76A.97.97.0 00593.96 538.72L594.14 660.05A1.82 1.81-79.8 00595.31 661.75Q600.8 663.83 606.74 665.66 624.02 670.98 642.31 674.66 645.11 675.22 647.69 676.02 650.42 676.85 653.38 677.42 653.44 677.43 653.47 677.48z"/><path fill="#276089" d="M679.22 372.53Q679.02 429.9 679.2 494.33 679.2 494.85 678.69 494.94 662.96 497.81 647.2 500.59C629.52 503.71 612.16 507.54 594.87 511.14A.53.53.0 01594.23 510.63Q593.82 453.73 594.1 396.75C594.11 394.37 595.19 394.33 597.27 393.54Q616.35 386.29 633.09 380.61 641.91 377.62 652.04 375.23 662.08 372.86 675.2 368.64 677.1 368.03 679.29 367.85A.54.54.0 01679.85 368.51C679.54 369.88 679.23 371.09 679.22 372.53zM663.15 390.16A.99.99.0 00661.85 389.22l-51.99 17.14A.99.99.0 00609.19 407.31L609.77 491.24A.99.99.0 00610.99 492.19L662.55 480A.99.99.0 00663.31 479.04L663.15 390.16z"/><path fill="#fff" d="M840.02 375.3Q848.37 376.89 856.74 378.43 858.39 378.73 859.67 379.4 861.35 380.28 862.67 380.11 863.04 380.06 862.71 380.22 862.58 380.28 862.61 380.45A.15.15.0 00862.73 380.57Q866.19 381.33 869.24 383.34 871.62 384.91 874.77 386.12 881.6 388.74 888.03 392.3C906.76 403.64 921.71 419.38 934.75 436.96Q933.36 439.7 931.62 440.82 930.42 441.59 929.18 440.89C920.72 436.1 912.25 432.32 903.95 427.51Q895.85 422.81 887.81 419.18A.49.49.0 00887.11 419.62Q887.09 420.94 887.79 422.07C891.49 428.02 895.07 433.53 898.27 440Q900.43 444.36 901.68 448 905.05 457.86 905.65 470.46 906.19 481.77 906.47 492.77 906.79 505.08 902.92 519.5C901.13 526.18 898.98 532.57 895.88 538.78Q889.94 550.64 883.64 559.19 875.85 569.75 866.31 577.47 846.68 593.35 821.44 600.21C811.7 602.85 801.87 603.19 791.75 603.52Q762.45 604.46 736.15 604.08 735.19 527.79 735.46 497.75 735.9 449.45 736.23 400.97 740.39 400.32 741.58 399.89 747.41 397.76 754.7 391.19 759.7 387.91 764.64 384.8 770.87 380.88 775.04 379.37 780.74 377.31 786.68 376.4 787.23 376.32 787.61 375.92 787.88 375.64 788.28 375.61C790.95 375.45 793.63 375.15 796.27 374.55Q803.01 373.01 810.51 372.87C812.06 372.84 813.35 373.41 814.84 373.31 823.73 372.69 831.63 374.33 840.02 375.3z"/><path fill="#c4e6ff" d="M285.05 381.84Q278.05 378.99 270.74 377.14 268.9 376.67 266.46 376.63 264.38 376.6 262.22 375.92C260.5 375.38 258.7 375.47 256.93 375.23Q248.72 374.13 240.43 373.13 255.65 372.58 270.21 376.37C271.98 376.83 274.28 377.77 276.39 378.23 278.26 378.64 279.89 379.5 281.9 380.1Q283.43 380.56 285.05 381.84z"/><path fill="#c4e6ff" d="M888.03 392.3Q881.6 388.74 874.77 386.12 871.62 384.91 869.24 383.34 866.19 381.33 862.73 380.57A.15.15.0 01862.61 380.45Q862.58 380.28 862.71 380.22 863.04 380.06 862.67 380.11 861.35 380.28 859.67 379.4 858.39 378.73 856.74 378.43 848.37 376.89 840.02 375.3 844.1 374.56 848.13 375.43 848.82 375.58 848.13 375.69 847.25 375.84 846.21 375.55 846.17 375.54 846.12 375.55 846.06 375.57 846.08 375.63 846.1 375.67 846.15 375.67 852.48 376.26 856.67 377.6 859.01 378.34 861.51 379.04 864.48 379.88 861.77 378.39 857.11 375.83 849.9 374.55A.03.03.0 01849.87 374.51L849.93 374.26Q849.95 374.2 850.01 374.21 854.27 375.14 858.83 376.66 863.08 378.07 867.06 380.02 872.13 382.5 878.05 384.62 878.28 384.7 878.15 384.9L878 385.13Q877.99 385.16 877.96 385.14L875.59 384Q875.43 383.93 875.35 384.08L875.22 384.3Q875.2 384.34 875.24 384.36q7 3 12.79 7.94z"/><path fill="#fff" d="M663.15 390.16 663.31 479.04A.99.99.0 01662.55 480L610.99 492.19A.99.99.0 01609.77 491.24L609.19 407.31A.99.99.0 01609.86 406.36l51.99-17.14A.99.99.0 01663.15 390.16z"/><path fill="#c4e6ff" d="M934.75 436.96Q940.04 442.39 941.14 445C941.38 445.57 941.28 446.4 941.65 447.11Q943.11 449.92 944.8 452.54 945.59 453.76 946.02 455.01C946.43 456.23 946.62 457.26 947.3 458.42Q949.18 461.64 950.1 465.43 950.98 469.01 952.59 472.89 954.15 476.64 954.92 480.43C956.07 486.17 957.77 492.01 958.61 497.75Q961.35 516.61 959.78 535.62 958.79 547.6 956.49 558.44 955.4 563.55 953.66 569.03 953.13 570.7 952.44 572.26 951.94 573.38 951.83 574.56 951.72 575.76 951.27 576.84 949.11 582.1 946.91 587.17 946.3 588.59 945.97 590.12 945.61 591.77 944.69 593.13A1.71 1.69-26.2 00944.39 593.99Q944.29 595.46 943.33 596.5A.83.81 57.5 00943.16 597.31L943.29 597.67Q943.45 598.12 943.21 598.54C941.92 600.89 940.33 603.02 939.12 605.35 937.51 608.42 935.19 610.8 933.33 613.73Q929.31 620.09 923.63 625.37 915.92 632.55 907.95 640.2C899.29 648.52 886.51 656.73 874.77 663.04 868.01 666.67 860.03 669.38 852.49 671.66Q847.16 673.28 841.39 674.15 817.97 677.68 795.44 677.62 767.94 677.54 738.87 677.73A2.19 2.19.0 01736.67 675.56L736.15 604.08Q762.45 604.46 791.75 603.52C801.87 603.19 811.7 602.85 821.44 600.21Q846.68 593.35 866.31 577.47 875.85 569.75 883.64 559.19 889.94 550.64 895.88 538.78C898.98 532.57 901.13 526.18 902.92 519.5Q906.79 505.08 906.47 492.77 906.19 481.77 905.65 470.46 905.05 457.86 901.68 448 900.43 444.36 898.27 440C895.07 433.53 891.49 428.02 887.79 422.07Q887.09 420.94 887.11 419.62A.49.49.0 01887.81 419.18Q895.85 422.81 903.95 427.51C912.25 432.32 920.72 436.1 929.18 440.89Q930.42 441.59 931.62 440.82 933.36 439.7 934.75 436.96z"/><path fill="#c4e6ff" d="M422.48 603.46 422.22 676.12A.94.94.0 01421.31 677.06Q415.61 677.25 410.89 677.26 335.37 677.38 258.42 677.27 241.51 677.25 227.85 675.5C220.75 674.59 213.79 672.17 206.39 672.09Q203.51 672.06 200.92 670.96 193.12 667.64 184.36 663.69 179.72 661.6 176.36 658.71 176.21 658.58 176.38 658.48 176.5 658.41 176.63 658.37 176.74 658.34 176.62 658.35 175.25 658.44 174.47 657.33 174.27 657.04 173.93 657.11 173.4 657.21 172.97 656.97 162.21 650.9 156.23 646.33q-27.47-20.98-43.03-52.74Q103.83 574.46 100.1 554.97 98.75 547.92 98.18 537.77C99.61 542.27 101.52 546 106.78 543.08Q107.23 542.83 107.3 542.31C108.26 535.39 108.92 528.49 109.93 521.65Q111.47 511.33 116.92 498.43q4.25-10.05 8.58-17.14C129.7 474.41 134.82 467.17 138.35 459.6Q139.5 457.14 141.46 455.04 146.57 449.55 151.06 444.55 152.56 442.88 153.86 442.72 155.48 442.53 155.02 444.09 151.96 454.51 150.07 463.83C149.69 465.7 150.03 467.49 149.5 469.45Q148.73 472.34 148.6 475.52 148.17 486.3 148.32 495.49 148.38 499.18 149.17 502.91 150.92 511.24 153.32 520.84 155.23 528.46 157.62 533.43C162.76 544.13 168.02 553.53 176.23 562.27 184.08 570.63 192.75 579.51 202.18 585.6q22.78 14.73 48.84 16.86Q267.13 603.77 284.71 603.84 348.88 604.09 412.59 603.87 416.66 603.86 421.43 604.61 421.98 604.7 422.19 604.18L422.48 603.46z"/><path fill="#fff" d="M506.73 508.96C499.77 508.84 492.34 509.35 485.38 508.57A.85.84-75.5 01484.7 507.4C486.13 503.98 488.69 501.42 490.59 498.33q9-14.71 17.55-27.52Q508.89 469.68 509.34 468.32A.71.71.0 01510.64 468.22Q513.11 473.15 516.03 477.72 525.56 492.62 535.94 506.56 536.77 507.68 535.45 508.14 534.45 508.49 533.37 508.51 524.38 508.75 514.72 508.66A.65.65.0 00514.06 509.31L513.68 567.99Q513.67 569.51 512.14 569.48L509.29 569.43A1.71 1.71.0 01507.61 567.73L507.24 509.47Q507.23 508.97 506.73 508.96z"/><ellipse fill="#276089" cx="0" cy="0" transform="translate(677.88,521.11) rotate(84.9)" rx="14.73" ry="13.11"/><path fill="#276089" d="M653.38 677.42Q650.42 676.85 647.69 676.02 645.11 675.22 642.31 674.66 624.02 670.98 606.74 665.66 600.8 663.83 595.31 661.75A1.82 1.81-79.8 01594.14 660.05L593.96 538.72A.97.97.0 01594.78 537.76Q625.29 532.84 654.64 528.93A.58.57 76.9 01655.27 529.33C657.76 536.87 662.1 542.05 670.08 544.24Q673.94 545.3 677.91 546.11 679.12 546.36 679.12 547.6C679.02 593.21 679.65 637.75 679.09 684.09A.8.79-79.7 01678.03 684.83Q666.29 680.76 653.97 677.85C653.78 677.81 653.58 677.65 653.47 677.48Q653.44 677.43 653.38 677.42zm-43.37-32.04C610.01 646.98 610.77 648.42 612.26 649.06 620.63 652.63 629.2 654.01 637.6 656.47Q649.19 659.86 661.88 663.03 663.27 663.38 663.33 661.95 663.43 659.77 663.43 657.69 663.36 600.71 663.09 550.52A1.49 1.48 1.9 00661.71 549.05Q658.24 548.79 654.88 548.95 640.98 549.6 624.11 551.2 617.1 551.87 609.98 552.02A.46.45-1.3 00609.53 552.48Q609.94 600.04 610.01 645.38z"/><path fill="#fff" d="M612.26 649.06C610.77 648.42 610.01 646.98 610.01 645.38Q609.94 600.04 609.53 552.48A.46.45-1.3 01609.98 552.02Q617.1 551.87 624.11 551.2 640.98 549.6 654.88 548.95 658.24 548.79 661.71 549.05A1.49 1.48 1.9 01663.09 550.52Q663.36 600.71 663.43 657.69 663.43 659.77 663.33 661.95 663.27 663.38 661.88 663.03 649.19 659.86 637.6 656.47C629.2 654.01 620.63 652.63 612.26 649.06z"/><path fill="#c4e6ff" d="M664.46 705.55Q660.29 705.43 657.52 704.26 655.83 703.54 654.31 703.37 652.68 703.19 651.25 702.9 635.66 699.73 630.86 698.4 618.05 694.87 604.84 691.11C600.29 689.82 595.8 687.86 591.3 687.21Q588.82 686.85 585.95 686.1 584.37 685.69 582 685.13 580.2 684.7 578.66 683.64 578.25 683.35 577.75 683.35 573.46 683.34 572.05 680.95 576.99 682.31 584.74 683.66 588.3 684.27 599.95 686.55 607.98 688.12 614.98 690.12 624.29 692.77 633.31 695.66 637.25 696.91 641.14 698.5C644.58 699.9 647.87 700.21 651.42 700.83Q653.66 701.22 655.67 702.18 657.6 703.1 659.7 703.75 662.11 704.49 664.46 705.55z"/></svg></span><span class=navbar-brand__name>Apache OpenServerless™</span></a><div class="td-navbar-nav-scroll ms-md-auto" id=main_navbar><ul class=navbar-nav><li class=nav-item><a class=nav-link href=/about/><span>About</span></a></li><li class=nav-item><a class=nav-link href=/blog/><span>Blog</span></a></li><li class=nav-item><a class="nav-link active" href=/docs/><span>Docs</span></a></li><li class=nav-item><a class=nav-link href=/community/><span>Community</span></a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" role=button data-bs-toggle=dropdown aria-haspopup=true aria-expanded=false href><span>Apache Software Foundation</span></a><ul class=dropdown-menu><li><a class=dropdown-item href=https://www.apache.org/>Apache Homepage</a></li><li><a class=dropdown-item href=https://www.apache.org/licenses/>License</a></li><li><a class=dropdown-item href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li><li><a class=dropdown-item href=https://www.apache.org/foundation/thanks.html>Thanks</a></li><li><a class=dropdown-item href=https://www.apache.org/security/>Security</a></li><li><a class=dropdown-item href=https://privacy.apache.org/policies/privacy-policy-public.html>Privacy</a></li><li><a class=dropdown-item href=https://www.apache.org/events/current-event>Events</a></li></ul></li></ul></div><div class="d-none d-lg-block"><div class="td-search td-search--offline"><div class=td-search__icon></div><input type=search class="td-search__input form-control" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off data-offline-search-index-json-src=/offline-search-index.87ddc9af86ef4e1ef7c8748aab7f4972.json data-offline-search-base-href=/ data-offline-search-max-results=10></div></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 ps-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/docs/>Return to the regular view of this page</a>.</p></div><h1 class=title>Docs</h1><ul><li>1: <a href=#pg-2c1938025a1224a6506a8d481ee4a5c6>Tutorial</a></li><ul><li>1.1: <a href=#pg-3b1ec3a9b3851e0ec55c8e2ff8c84699>Getting started</a></li><ul></ul><li>1.2: <a href=#pg-027017c25c90f3e4086f50e27ba217ca>First steps</a></li><ul></ul><li>1.3: <a href=#pg-b45007aa6cc09b274b1d98c8a381a96c>Form validation</a></li><ul></ul><li>1.4: <a href=#pg-94880291bf080cdca13e898d317d795f>Use database</a></li><ul></ul><li>1.5: <a href=#pg-b63dd4c4560ad4b126907edb94fad405>Sending notifications</a></li><ul></ul><li>1.6: <a href=#pg-641d15a616ec48d5b2420ed9c67581ff>App Deployment</a></li><ul></ul></ul><li>2: <a href=#pg-01d9bce0990ebbcfcc9cb834c8365b3e>CLI</a></li><ul><li>2.1: <a href=#pg-a59e9ad2a8fb11a85d8ebedec00ea6b6>Entities</a></li><ul><li>2.1.1: <a href=#pg-0f78024b5380f26a2900a3b24b8df6a2>Packages</a></li><ul></ul><li>2.1.2: <a href=#pg-92e5b80b2a52f86c8fa5eac178ced4d8>Actions</a></li><ul></ul><li>2.1.3: <a href=#pg-554923b69d6a963b7b804b6a9c9cbca1>Activations</a></li><ul></ul><li>2.1.4: <a href=#pg-7ef4df7378cddcf2eede13ac0f6e3773>Sequences</a></li><ul></ul><li>2.1.5: <a href=#pg-8f082b7c68191e2e106ca0e1c10959e2>Triggers</a></li><ul></ul><li>2.1.6: <a href=#pg-6a429876717c094e5d07d91849fe1619>Rules</a></li><ul></ul></ul><li>2.2: <a href=#pg-1dd578aa460d31b1869cc6d674346f9c>Administration</a></li><ul></ul><li>2.3: <a href=#pg-6340dcb693e404ad47e4e09c1ee11088>Debugging</a></li><ul></ul><li>2.4: <a href=#pg-7c5884f2646d97650d003d132a755b1f>Project</a></li><ul></ul><li>2.5: <a href=#pg-fb7457c476cfc08297adf7909fafd156>Web Assets</a></li><ul></ul></ul><li>3: <a href=#pg-b00a88a07ceb21b1a83e5822e0c86c1d>Reference</a></li><ul><li>3.1: <a href=#pg-74fdda9fa92a80e92e8b3d05dd0e8ba1>Advanced</a></li><ul><li>3.1.1: <a href=#pg-4e4418ead51c6c16751a09aaa9f7902c>Advanced CLI</a></li><ul></ul><li>3.1.2: <a href=#pg-84f68b8583b274cc8a7f9f04c649e1b4>Building your runtime</a></li><ul></ul><li>3.1.3: <a href=#pg-aa85069ab6f58eef613cc4e73ddbe0c1>Naming And Limits</a></li><ul></ul><li>3.1.4: <a href=#pg-5b43e18f4cddb0aabe9809532e2cc2fe>Rest API</a></li><ul></ul><li>3.1.5: <a href=#pg-c7225acdcbc593d8fa87d59944d1fa90>Runtimes under the hood</a></li><ul></ul><li>3.1.6: <a href=#pg-81b8ae42271adca707c7d285d1fd091b>Scheduler</a></li><ul></ul></ul><li>3.2: <a href=#pg-9a9f38e443de2df9046eecaddcd64dcb>Entities</a></li><ul><li>3.2.1: <a href=#pg-81c0ecd9c622d63e01ce626c30f315ba>Actions</a></li><ul></ul><li>3.2.2: <a href=#pg-0fbd1ebffcee5d3c07d1d8080f65183d>Web Actions</a></li><ul></ul><li>3.2.3: <a href=#pg-134f790c8d9ec8048316409a5842a9e7>Parameters</a></li><ul></ul><li>3.2.4: <a href=#pg-1a65c20d0a8a7e9ac6e3d7ebb32079cf>Packages</a></li><ul></ul><li>3.2.5: <a href=#pg-edfa631df9f2b93b7371eb7b774a35b8>Feeds</a></li><ul></ul><li>3.2.6: <a href=#pg-38495e8c2bc869b2620d6c789f0e418f>Annotations</a></li><ul></ul></ul><li>3.3: <a href=#pg-7c3791c874a67812e76da777841eec4d>Runtimes</a></li><ul></ul><li>3.4: <a href=#pg-fd53f7b5e98190bcc94d79b123790625>Tasks</a></li><ul><li>3.4.1: <a href=#pg-b92302ba4aa446aa810640c0f09ead94>config</a></li><ul></ul><li>3.4.2: <a href=#pg-c8a38269aa9c696d7d5b83c75c4d0ee0>setup</a></li><ul></ul></ul><li>3.5: <a href=#pg-c808ce38575e73f72835d7ed02b03780>Tools</a></li><ul><li>3.5.1: <a href=#pg-27ce85a78a48fecdeaa223d6b60b9bb9>base64</a></li><ul></ul><li>3.5.2: <a href=#pg-7932ac2b4477bd1e28e9f99cc6850ede>datefmt</a></li><ul></ul><li>3.5.3: <a href=#pg-771bb4a3c7333d06a601254ab63e20cb>echoif</a></li><ul></ul><li>3.5.4: <a href=#pg-7d915f0d4d6c781752d0a371929c3352>echoifempty</a></li><ul></ul><li>3.5.5: <a href=#pg-86190bc978c4d2adda8dc9db5be23f15>echoifexists</a></li><ul></ul><li>3.5.6: <a href=#pg-957dcc702a96e2e23e576c933d3bc8b5>empty</a></li><ul></ul><li>3.5.7: <a href=#pg-8d2457cb6ed9caebbffb74a82bdb3d4a>executable</a></li><ul></ul><li>3.5.8: <a href=#pg-28776d09d77edb2f29290aa0d0317d1c>extract</a></li><ul></ul><li>3.5.9: <a href=#pg-54aadb1a1239626b6e9e5e5d76e6f9ab>filetype</a></li><ul></ul><li>3.5.10: <a href=#pg-7a204ccf058880671046a598c0ab9206>needupdate</a></li><ul></ul><li>3.5.11: <a href=#pg-4d4e8dd2805d9c72fdcd8875d523b6fc>opspath</a></li><ul></ul><li>3.5.12: <a href=#pg-a11b9684bbdd698277d71db79d0dc3cd>random</a></li><ul></ul><li>3.5.13: <a href=#pg-58f2e7983aeaee9bfd09b58381094395>remove</a></li><ul></ul><li>3.5.14: <a href=#pg-15cce568fc445c0f72c6689d934503aa>rename</a></li><ul></ul><li>3.5.15: <a href=#pg-6d3b138f9ac0461dca4dfebacf8d9216>retry</a></li><ul></ul><li>3.5.16: <a href=#pg-ac2f82cf229777ff21bbd04ac5673bbe>sh</a></li><ul></ul><li>3.5.17: <a href=#pg-d6d15458a9b424af5a6956daea9d60e6>urlenc</a></li><ul></ul><li>3.5.18: <a href=#pg-1db8dce395fca4dfad1747b8a6b9b05e>validate</a></li><ul></ul></ul></ul><li>4: <a href=#pg-273a1d3f87830cbffaaf95a64d1ab7e6>Installation</a></li><ul><li>4.1: <a href=#pg-8c3f05165c53384fa59c1453a0fb9b64>Quick Start</a></li><ul></ul><li>4.2: <a href=#pg-1642ee41003decf99634e3d9c714851c>Download</a></li><ul></ul><li>4.3: <a href=#pg-d88677d4167778f5d3ca8a81629227c5>Prerequisites</a></li><ul><li>4.3.1: <a href=#pg-0224021be1c39f3dd5683066e33d007c>Local Docker</a></li><ul></ul><li>4.3.2: <a href=#pg-b0ef4b2e79b17c0bf42df9cbc4da7029>Linux Server</a></li><ul><li>4.3.2.1: <a href=#pg-c8f8a7091cc35f968fc5e121e51c459b>SSH and Sudo</a></li><ul></ul><li>4.3.2.2: <a href=#pg-7de93c022dce0399d0fb529ba96bc7e6>Server on AWS</a></li><ul></ul><li>4.3.2.3: <a href=#pg-3a59e283e51e41b6d5b36b0ca31c690c>Server on Azure</a></li><ul></ul><li>4.3.2.4: <a href=#pg-8e157365d16cb8fe54ef2c7d50505022>Install K3S</a></li><ul></ul><li>4.3.2.5: <a href=#pg-b4e9b33b69177f5f056217b0d67c2031>Install MicroK8S</a></li><ul></ul></ul><li>4.3.3: <a href=#pg-f32ce604d7868701850b6029ab564835>Kubernetes Cluster</a></li><ul><li>4.3.3.1: <a href=#pg-1fd119711d8fba54dc56350b34daad88>Amazon EKS</a></li><ul></ul><li>4.3.3.2: <a href=#pg-c5304e0f61e6fb87af4b9940c2922fec>Azure AKS</a></li><ul></ul><li>4.3.3.3: <a href=#pg-e0ed70c138e5d50c8207cdcc1a07f4e0>Generic Kubernetes</a></li><ul></ul></ul></ul><li>4.4: <a href=#pg-f6b9a66f9506e4a7437691a389daca4f>Configure OpenServerless</a></li><ul><li>4.4.1: <a href=#pg-be207599c3aa71cb110feb062b890918>DNS and SSL</a></li><ul></ul><li>4.4.2: <a href=#pg-29e1dfdb1ff6aee88ce1de74e2c1f27d>Services</a></li><ul></ul></ul><li>4.5: <a href=#pg-234d738d46569ad9a8a7ae7fed565a21>Install OpenServerless</a></li><ul><li>4.5.1: <a href=#pg-468eb1c803501e0c8fee24ddc1d4914c>Docker</a></li><ul></ul><li>4.5.2: <a href=#pg-2a348e473e676744aeb27b6b290fa85c>Linux Server</a></li><ul></ul><li>4.5.3: <a href=#pg-e2ad6ea02f40220590e02be2e3387f01>Kubernetes cluster</a></li><ul></ul></ul><li>4.6: <a href=#pg-c7d6e75a293d35b4ca7156b87967599c>Troubleshooting</a></li><ul></ul></ul></ul><div class=content><h2 id=about-apache-openserverless>About Apache OpenServerless</h2><p>Apache OpenServerless is an Open Source project, released under the
<a href=https://github.com/apache/openserverless/blob/main/LICENSE>Apache License
2.0</a>
providing a portable and complete
<a href=https://martinfowler.com/articles/serverless.html>Serverless</a>
environment, allowing to build quickly and easily cloud-native
applications.</p><p>Our goal is to make OpenServerless <strong>ubitiquous</strong>, allowing it to easily
run a complete and portable environment that runs in every
<a href=https://kubernetes.io/>Kubernetes</a>.</p><p>OpenServerless is based on <a href=https://openwhisk.apache.org>Apache
OpenWhisk</a>, which provides a powerful,
production-ready serverless engine.</p><p>However, the serverless engine is just the beginning, because a
serverless environment requires a set of integrated services.</p><p>OpenServerless provides integrated with OpenWhisk several additional
services such as databases, object storage, and a cron scheduler.</p><p>Furthermore, we test it on many public cloud Kubernetes services and
on-premises Kubernetes vendors.</p><p>The platform is paired with a powerful CLI tool, <code>ops</code>, which lets you
deploy OpenServerless quickly and easily everywhere, and perform a lot
of development tasks.</p><p>Our goal is to build a <strong>complete</strong> distribution of a serverless
environment with the following features:</p><ul><li><p>It is easy to install and manage.</p></li><li><p>Integrates all the key services to build applications.</p></li><li><p>It is as portable as possible to run potentially in every
Kubernetes.</p></li><li><p>It is however tested regularly against a set of supported Kubernetes
environments.</p></li></ul><p>If you want to know more about our goals, check our
<a href=https://github.com/nuvolaris/nuvolaris/blob/main/docs/ROADMAP.md><strong>roadmap</strong></a>
document.</p></div></div><div class=td-content style=page-break-before:always><h1 id=pg-2c1938025a1224a6506a8d481ee4a5c6>1 - Tutorial</h1><div class=lead>Showcase serverless development in action</div><h2 id=tutorial>Tutorial</h2><p>This tutorial walks you through developing a simple OpenServerless
application using the Command Line Interface (CLI) and Javascript (but
any supported language will do).</p><p>Its purpose is to showcase serverless development in action by creating
a contact form for a website. We will see the development process from
start to finish, including the deployment of the platform and running
the application.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-3b1ec3a9b3851e0ec55c8e2ff8c84699>1.1 - Getting started</h1><div class=lead>Let&rsquo;s start building a sample application</div><h2 id=getting-started>Getting started</h2><h3 id=build-a-sample-application>Build a sample Application</h3><p>Imagine we have a static website and need server logic to store contacts
and validate data. This would require a server, a database and some code
to glue it all together. With a serverless approach, we can just
sprinkle little functions (that we call actions) on top of our static
website and let OpenServerless take care of the rest. No more setting up
VMs, backend web servers, databases, etc.</p><p>In this tutorial, we will see how you can take advantage of several
services which are already part of a OpenServerless deployment and
develop a contact form page for users to fill it with their emails and
messages, which are then sent via email to us and stored in a database.</p><h3 id=openserverless-cli-ops>Openserverless CLI: Ops</h3><p>Serverless development is mostly performed on the CLI, and
OpenServerless has its tool called <code>ops</code>. It’s a command line tool that
allows you to deploy (and interact with) the platform seamlessly to the
cloud, locally and in custom environments.</p><p>Ops is cross-platform and can be installed on Windows, Linux and MacOS.
You can find the project and the sources on
<a href=https://github.com/apache/openserverless-cli>Apache OpenServerless Cli Github page</a></p><h3 id=deploy-openserverless>Deploy OpenServerless</h3><p>To start using OpenServerless you can refer to the <a href=/docs/installation/>Installation
Guide</a>. You can follow the local
installation to quickly get started with OpenServerless deployed on your
machine, or if you want to follow the tutorial on a deployment on cloud
you can pick one of the many supported cloud provider. Once installed
come back here!</p><h3 id=enabling-services>Enabling Services</h3><p>After installing OpenServerless on a local machine with Docker or on a
supported cloud, you can enable or disable the services offered by the platform.
As we will use Postgres database, the Static content with the Minio S3 compatible
storage and a cron scheduler, let’s run in the terminal:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops config <span style=color:#204a87>enable</span> --postgres --static --minio --cron
</span></span></code></pre></div><p>Since you should already have a deployment running, we have to update it
with the new services so they get deployed. Simply run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops update apply
</span></span></code></pre></div><p>And with just that (when it finishes), we have everything we need ready
to use!</p><h3 id=cleaning-up>Cleaning Up</h3><p>Once you are done and want to clean the services configuration, just
run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops config disable --postgres --static --minio --cron
</span></span></code></pre></div><hr></div><div class=td-content style=page-break-before:always><h1 id=pg-027017c25c90f3e4086f50e27ba217ca>1.2 - First steps</h1><div class=lead>Move your first steps on Apache Openserverless</div><h2 id=first-steps>First steps</h2><h3 id=starting-at-the-front>Starting at the Front</h3><p>Right now, after a freshly installation, if we visit the <code>&lt;apihost></code> you
will see a very simple page with:</p><blockquote><p>Welcome to OpenServerless static content distributor landing page!!!</p></blockquote><p>That’s because we’ve activated the static content, and by default it
starts with this simple <code>index.html</code> page. We will instead have our own
index page that shows the users a contact form powered by OpenServerless
actions. Let’s write it now.</p><p>Let’s create a folder that will contain all of our app code:
<code>contact_us_app</code>.</p><p>Inside that create a new folder called <code>web</code> which will store our static
frontend, and add there a <code>index.html</code> file with the following:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#8f5902;font-style:italic>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>html</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>head</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>link</span> <span style=color:#c4a000>href</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css&#34;</span> <span style=color:#c4a000>rel</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;stylesheet&#34;</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;bootstrap-css&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>head</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>body</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>id</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;container&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;row&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;col-md-8 col-md-offset-2&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>               <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>h4</span><span style=color:#000;font-weight:700>&gt;</span>Get in Touch<span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>h4</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>               <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>form</span> <span style=color:#c4a000>method</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;POST&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-group&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                     <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>input</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;text&#34;</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;name&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-control&#34;</span> <span style=color:#c4a000>placeholder</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Name&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-group&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                     <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>input</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;email&#34;</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;email&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-control&#34;</span> <span style=color:#c4a000>placeholder</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;E-mail&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-group&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                     <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>input</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;tel&#34;</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;phone&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-control&#34;</span> <span style=color:#c4a000>placeholder</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Phone&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>div</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-group&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                     <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>textarea</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;message&#34;</span> <span style=color:#c4a000>rows</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;3&#34;</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;form-control&#34;</span> <span style=color:#c4a000>placeholder</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;Message&#34;</span><span style=color:#000;font-weight:700>&gt;&lt;/</span><span style=color:#204a87;font-weight:700>textarea</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                  <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>button</span> <span style=color:#c4a000>class</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;btn btn-default&#34;</span> <span style=color:#c4a000>type</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;submit&#34;</span> <span style=color:#c4a000>name</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;button&#34;</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>                     Send
</span></span><span style=display:flex><span>                  <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>button</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>               <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>form</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>         <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>div</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>   <span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>body</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>&lt;/</span><span style=color:#204a87;font-weight:700>html</span><span style=color:#000;font-weight:700>&gt;</span>
</span></span></code></pre></div><p>Now we just have to upload it to our OpenServerless deployment. You
could upload it using something like <code>curl</code> with a <code>PUT</code> to where your
platform is deployed at, but there is an handy command that does it
automatically for all files in a folder:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops web upload web/
</span></span></code></pre></div><p>Pass to <code>ops web upload</code> the path to folder where the index.html is
stored in (the <code>web</code> folder) and visit again <code>&lt;apihost></code>.</p><p>Now you should see the new index page:</p><p><img alt=Form src=/docs/tutorial/images/form.png></p><h3 id=the-contact-package>The Contact Package</h3><p>The contact form we just uploaded does not do anything. To make it work
let’s start by creating a new package to hold our actions. Moreover, we
can bind to this package the database url, so the actions can directly
access it!</p><p>With the <code>debug</code> command you can see what’s going on in your deployment.
This time let’s use it to grab the &ldquo;postgres_url&rdquo; value:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops -config -d <span style=color:#000;font-weight:700>|</span> grep POSTGRES_URL
</span></span></code></pre></div><p>Copy the Postgres URL (something like <code>postgresql://...</code>). Now we can
create a new package for the application:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops package create contact -p dbUri &lt;postgres_url&gt;
</span></span><span style=display:flex><span>ok: created package contact
</span></span></code></pre></div><p>The actions under this package will be able to access the &ldquo;dbUri&rdquo;
variable from their args!</p><p>To follow the same structure for our action files, let’s create a folder
<code>packages</code> and inside another folder <code>contact</code> to give our actions a
nice, easy to find, home.</p><p>To manage and check out your packages, you can use the <code>ops packages</code>
subcommands.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops package list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>packages
</span></span><span style=display:flex><span>/openserverless/contact  private
</span></span><span style=display:flex><span>/openserverless/hello    private     &lt;-- a default package created during deployment
</span></span></code></pre></div><p>And to get specific information on a package:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops package get contact
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ok: got package contact
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>   <span style=color:#4e9a06>&#34;namespace&#34;</span>: <span style=color:#4e9a06>&#34;openserverless&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#4e9a06>&#34;name&#34;</span>: <span style=color:#4e9a06>&#34;contact&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#4e9a06>&#34;version&#34;</span>: <span style=color:#4e9a06>&#34;0.0.1&#34;</span>,
</span></span><span style=display:flex><span>   <span style=color:#4e9a06>&#34;publish&#34;</span>: false,
</span></span><span style=display:flex><span>   <span style=color:#4e9a06>&#34;parameters&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#4e9a06>&#34;key&#34;</span>: <span style=color:#4e9a06>&#34;dbUri&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#4e9a06>&#34;value&#34;</span>: &lt;postgres_url&gt;
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>   <span style=color:#ce5c00;font-weight:700>]</span>,
</span></span><span style=display:flex><span>   <span style=color:#4e9a06>&#34;binding&#34;</span>: <span style=color:#ce5c00;font-weight:700>{}</span>,
</span></span><span style=display:flex><span>   <span style=color:#4e9a06>&#34;updated&#34;</span>: <span style=color:#0000cf;font-weight:700>1696232618540</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><hr></div><div class=td-content style=page-break-before:always><h1 id=pg-b45007aa6cc09b274b1d98c8a381a96c>1.3 - Form validation</h1><div class=lead>Learn how to add form validation from front to back-end</div><h2 id=form-validation>Form validation</h2><p>Now that we have a contact form and a package for our actions, we have
to handle the submission. We can do that by adding a new action that
will be called when the form is submitted. Let’s create a <code>submit.js</code>
file in our <code>packages/contact</code> folder.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>message</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[]</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>errors</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[]</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// TODO: Form Validation
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// TODO: Returning the Result
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>This action is a bit more complex. It takes the input object (called
args) which will contain the form data (accessible via <code>args.name</code>,
<code>args.email</code>, etc.). With that. we will do some validation and then
return the result.</p><h3 id=validation>Validation</h3><p>Let’s start filling out the &ldquo;Form Validation&rdquo; part by checking the name:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// validate the name
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>if</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;name: &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>errors</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;No name provided&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Then the email by using a regular expression:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// validate the email
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>re</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>/\S+@\S+\.\S+/</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>re</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>test</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>email</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;email: &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>email</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>errors</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Email missing or incorrect.&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>The phone, by checking that it’s at least 10 digits:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// validate the phone
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>if</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phone</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phone</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>match</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>/\d/g</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>length</span> <span style=color:#ce5c00;font-weight:700>&gt;=</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;phone: &#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phone</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>errors</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Phone number missing or incorrect.&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Finally, the message text, if present:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// validate the message
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>if</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;message:&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h3 id=submission>Submission</h3><p>With the validation phase, we added to the &ldquo;errors&rdquo; array all the errors
we found, and to the &ldquo;message&rdquo; array all the data we want to show to the
user. So if there are errors, we have to show them, otherwise, we store
the message and return a &ldquo;thank you&rdquo; page.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// return the result
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>if</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>errors</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>length</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>errs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;&lt;ul&gt;&lt;li&gt;&#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>errors</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>join</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&lt;/li&gt;&lt;li&gt;&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#4e9a06>&#34;&lt;/li&gt;&lt;/ul&gt;&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>body</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&lt;h1&gt;Errors!&lt;/h1&gt;&#34;</span><span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>      <span style=color:#000>errs</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;&lt;br&gt;&lt;a href=&#34;javascript:window.history.back()&#34;&gt;Back&lt;/a&gt;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;&lt;pre&gt;&#34;</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>join</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;\n&#34;</span><span style=color:#000;font-weight:700>)</span><span style=color:#ce5c00;font-weight:700>+</span><span style=color:#4e9a06>&#34;&lt;/pre&gt;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>body</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&lt;h1&gt;Thank you!&lt;/h1&gt;&#34;</span><span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>data</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>email</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>email</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>phone</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phone</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>message</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Note how this action is returning HTML code. Actions can return a
<code>{ body: &lt;html> }</code> kind of response and have their own url so they can
be invoked via a browser and display some content.</p><p>The HTML code to display is always returned in the <code>body</code> field, but we
can also return other stuff. In this case we added a a field for each of
the form fields. This gives us the possibility to invoke in a sequence
another action that can act just on those fields to store the data in
the database.</p><p>Let’s start deploying the action:</p><pre><code>ops action create contact/submit submit.js --web true
ok: created action contact/submit
</code></pre><p>The <code>--web true</code> specifies it is a web action. We are creating a
<code>submit</code> action in the <code>contact</code> package, that’s why we are passing
<code>contact/submit</code>.</p><p>You can retrieve the url with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops url contact/submit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ &lt;apihost&gt;/api/v1/web/openserverless/contact/submit
</span></span></code></pre></div><p>If you click on it you will see the Error page with a list of errors,
that’s because we just invoked the submit logic for the contact form
directly, without passing in any args. This is meant to be used via the
contact form page!</p><p>We need to wire it into the index.html. So let’s open it again and add a
couple of attributes to the form:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>---             <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>form</span> <span style=color:#c4a000>method</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;POST&#34;</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>--</span> <span style=color:#c4a000>old</span>
</span></span><span style=display:flex><span><span style=color:#a40000>+++</span>            <span style=color:#a40000>&lt;</span><span style=color:#c4a000>form</span> <span style=color:#c4a000>method</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;POST&#34;</span> <span style=color:#c4a000>action</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/api/v1/web/openserverless/contact/submit&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#c4a000>enctype</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;application/x-www-form-urlencoded&#34;</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>--</span> <span style=color:#c4a000>new</span>
</span></span></code></pre></div><p>Upload the web folder again with the new changes:</p><pre><code>ops web upload web/
</code></pre><p>Now if you go to the contact form page the send button should work. It
will invoke the submit action which in turn will return some html.</p><p>If you fill it correctly, you should see the &ldquo;Thank you&rdquo; page.</p><p><img alt="Submit Result" src=/docs/tutorial/images/submit.png></p><p>Note how only the HTML from the <code>body</code> field is displayed, the other
fields are ignored in this case.</p><p>The <code>ops action</code> command can be used for many more things besides
creating actions. For example, you can use it to list all available
actions:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops action list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>actions
</span></span><span style=display:flex><span>/openserverless/contact/submit               private nodejs:18
</span></span></code></pre></div><p>And you can also get info on a specific action:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops action get contact/submit
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;namespace&#34;</span>: <span style=color:#4e9a06>&#34;openserverless/contact&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;name&#34;</span>: <span style=color:#4e9a06>&#34;submit&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;version&#34;</span>: <span style=color:#4e9a06>&#34;0.0.1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;exec&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;kind&#34;</span>: <span style=color:#4e9a06>&#34;nodejs:18&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;binary&#34;</span>: <span style=color:#204a87>false</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>  ...
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>These commands can come in handy when you need to debug your actions.</p><p>Here is the complete the <code>submit.js</code> action:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>message</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[]</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>errors</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>[]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// validate the name
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;name: &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>errors</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;No name provided&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// validate the email
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>re</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>/\S+@\S+\.\S+/</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>re</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>test</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>email</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;email: &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>email</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>errors</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Email missing or incorrect.&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// validate the phone
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phone</span> <span style=color:#ce5c00;font-weight:700>&amp;&amp;</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phone</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>match</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>/\d/g</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>length</span> <span style=color:#ce5c00;font-weight:700>&gt;=</span> <span style=color:#0000cf;font-weight:700>10</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;phone: &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phone</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>errors</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Phone number missing or incorrect.&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// validate the message
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>push</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;message:&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// return the result
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>errors</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>length</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>errs</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;&lt;ul&gt;&lt;li&gt;&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>errors</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>join</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;&lt;/li&gt;&lt;li&gt;&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;&lt;/li&gt;&lt;/ul&gt;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>body</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&lt;h1&gt;Errors!&lt;/h1&gt;&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>        <span style=color:#000>errs</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#39;&lt;br&gt;&lt;a href=&#34;javascript:window.history.back()&#34;&gt;Back&lt;/a&gt;&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>data</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;&lt;pre&gt;&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>join</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;\n&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;&lt;/pre&gt;&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>body</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;&lt;h1&gt;Thank you!&lt;/h1&gt;&#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>data</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>name</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>email</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>email</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>phone</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phone</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>message</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><hr></div><div class=td-content style=page-break-before:always><h1 id=pg-94880291bf080cdca13e898d317d795f>1.4 - Use database</h1><div class=lead>Store data into a relational database</div><h2 id=use-database>Use database</h2><h3 id=storing-the-message-in-the-database>Storing the Message in the Database</h3><p>We are ready to use the database that we enabled at the beginning of the
tutorial.</p><p>Since we are using a relational database, we need to create a table to
store the contact data. We can do that by creating a new action called
<code>create-table.js</code> in the <code>packages/contact</code> folder:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>Client</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>require</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;pg&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>async</span> <span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>client</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Client</span><span style=color:#000;font-weight:700>({</span> <span style=color:#000>connectionString</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>dbUri</span> <span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>createTable</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>`
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    CREATE TABLE IF NOT EXISTS contacts (
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        id serial PRIMARY KEY,
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        name varchar(50),
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        email varchar(50),
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        phone varchar(50),
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>        message varchar(300)
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    );
</span></span></span><span style=display:flex><span><span style=color:#4e9a06>    `</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Connect to database server
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>client</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>connect</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Connected to database&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>client</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>query</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>createTable</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Contact table created&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>e</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>e</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>throw</span> <span style=color:#000>e</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>client</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>end</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>We just need to run this once, therefore it doesn’t need to be a web
action. Here we can take advantage of the <code>cron</code> service we enabled!
There are also a couple of console logs that we can check out.</p><p>With the cron scheduler you can annotate an action with 2 kinds of
labels. One to make OpenServerless periodically invoke the action, the
other to automatically execute an action once, on creation.</p><p>Let’s create the action with the latter, which means annotating the
action with <code>autoexec true</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops action create contact/create-table create-table.js -a autoexec <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>ok: created action contact/create-table
</span></span></code></pre></div><p>With <code>-a</code> you can add &ldquo;annotations&rdquo; to an action. OpenServerless will
invoke this action as soon as possible, so we can go on.</p><p>In OpenServerless an action invocation is called an <code>activation</code>. You
can keep track, retrieve information and check logs from an action with
<code>ops activation</code>. For example, with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops activation list
</span></span></code></pre></div><p>You can retrieve the list of invocations. For caching reasons the first
time you run the command the list might be empty. Just run it again and
you will see the latest invocations (probably some <code>hello</code> actions from
the deployment).</p><p>If we want to make sure <code>create-table</code> was invoked, we can do it with
this command. The cron scheduler can take up to 1 minute to run an
<code>autoexec</code> action, so let’s wait a bit and run <code>ops activation list</code>
again.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops activation list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Datetime            Activation ID                    Kind      Start Duration   Status  Entity
</span></span><span style=display:flex><span>2023-10-02 09:52:01 1f02d3ef5c32493682d3ef5c32b936da nodejs:18 cold  312ms      success openserverless/create-table:0.0.1
</span></span><span style=display:flex><span>..
</span></span></code></pre></div><p>Or we could run <code>ops activation poll</code> to listen for new logs.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops activation poll
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Enter Ctrl-c to exit.
</span></span><span style=display:flex><span>Polling <span style=color:#204a87;font-weight:700>for</span> activation logs
</span></span></code></pre></div><p>When the logs from the <code>create-table</code> action appear, we can stop the
command with <code>Ctrl-c</code>.</p><p>Each activation has an <code>Activation ID</code> which can be used with other
<code>ops activation</code> subcommands or with the <code>ops logs</code> command.</p><p>We can also check out the logs with either <code>ops logs &lt;activation-id></code> or
<code>ops logs --last</code> to quickly grab the last activation’s logs:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops logs --last
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>2023-10-15T14:41:01.230674546Z stdout: Connected to database
</span></span><span style=display:flex><span>2023-10-15T14:41:01.238457338Z stdout: Contact table created
</span></span></code></pre></div><h3 id=the-action-to-store-the-data>The Action to Store the Data</h3><p>We could just write the code to insert data into the table in the
<code>submit.js</code> action, but it’s better to have a separate action for that.</p><p>Let’s create a new file called <code>write.js</code> in the <code>packages/contact</code>
folder:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>Client</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>require</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;pg&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>async</span> <span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>client</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Client</span><span style=color:#000;font-weight:700>({</span> <span style=color:#000>connectionString</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>dbUri</span> <span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Connect to database server
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>client</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>connect</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>email</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>phone</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>message</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>res</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>await</span> <span style=color:#000>client</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>query</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>            <span style=color:#4e9a06>&#39;INSERT INTO contacts(name,email,phone,message) VALUES($1,$2,$3,$4)&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>[</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>email</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>phone</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>]</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>res</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>e</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>e</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>throw</span> <span style=color:#000>e</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>finally</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>client</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>end</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>body</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>body</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#000>email</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#000>phone</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#000>message</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Very similar to the create table action, but this time we are inserting
data into the table by passing the values as parameters. There is also a
<code>console.log</code> on the response in case we want to check some logs again.</p><p>Let’s deploy it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops action create contact/write write.js
</span></span><span style=display:flex><span>ok: created action contact/write
</span></span></code></pre></div><h3 id=finalizing-the-submit>Finalizing the Submit</h3><p>Alright, we are almost done. We just need to create a pipeline of
<code>submit</code> → <code>write</code> actions. The <code>submit</code> action returns the 4 form
fields together with the HTML body. The <code>write</code> action expects those 4
fields to store them. Let’s put them together into a <code>sequence</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops action create contact/submit-write  --sequence contact/submit,contact/write --web <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>ok: created action contact/submit-write
</span></span></code></pre></div><p>With this command we created a new action called <code>submit-write</code> that is
a sequence of <code>submit</code> and <code>write</code>. This means that OpenServerless will
call in a sequence <code>submit</code> first, then get its output and use it as
input to call <code>write</code>.</p><p>Now the pipeline is complete, and we can test it by submitting the form
again. This time the data will be stored in the database.</p><p>Note that <code>write</code> passes on the HTML body so we can still see the thank
you message. If we want to hide it, we can just remove the <code>body</code>
property from the return value of <code>write</code>. We are still returning the
other 4 fields, so another action can use them (spoiler: it will happen
next chapter).</p><p>Let’s check out again the action list:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops action list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>actions
</span></span><span style=display:flex><span>/openserverless/contact/submit-write                  private sequence
</span></span><span style=display:flex><span>/openserverless/contact/write                         private nodejs:18
</span></span><span style=display:flex><span>/openserverless/contact/create-table                  private nodejs:18
</span></span><span style=display:flex><span>/openserverless/contact/submit                        private nodejs:18
</span></span></code></pre></div><p>You probably have something similar. Note the submit-write is managed as
an action, but it’s actually a sequence of 2 actions. This is a very
powerful feature of OpenServerless, as it allows you to create complex
pipelines of actions that can be managed as a single unit.</p><h3 id=trying-the-sequence>Trying the Sequence</h3><p>As before, we have to update our <code>index.html</code> to use the new action.
First let’s get the URL of the <code>submit-write</code> action:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops url contact/submit-write
</span></span><span style=display:flex><span>&lt;apihost&gt;/api/v1/web/openserverless/contact/submit-write
</span></span></code></pre></div><p>Then we can update the <code>index.html</code> file:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>---     <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>form</span> <span style=color:#c4a000>method</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;POST&#34;</span> <span style=color:#c4a000>action</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/api/v1/web/openserverless/contact/submit&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#c4a000>enctype</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;application/x-www-form-urlencoded&#34;</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>--</span> <span style=color:#c4a000>old</span>
</span></span><span style=display:flex><span><span style=color:#a40000>+++</span>     <span style=color:#a40000>&lt;</span><span style=color:#c4a000>form</span> <span style=color:#c4a000>method</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;POST&#34;</span> <span style=color:#c4a000>action</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/api/v1/web/openserverless/contact/submit-write&#34;</span>
</span></span><span style=display:flex><span>              <span style=color:#c4a000>enctype</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;application/x-www-form-urlencoded&#34;</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>--</span> <span style=color:#c4a000>new</span>
</span></span></code></pre></div><p>We just need to add <code>-write</code> to the action name.</p><p>Try again to fill the contact form (with correct data) and submit it.
This time the data will be stored in the database.</p><p>If you want to retrive info from you database, ops provides several
utilities under the <code>ops devel</code> command. They are useful to interact
with the integrated services, such as the database we are using.</p><p>For instance, let’s run:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops devel psql sql <span style=color:#4e9a06>&#34;SELECT * FROM CONTACTS&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[{</span><span style=color:#4e9a06>&#39;id&#39;</span>: 1, <span style=color:#4e9a06>&#39;name&#39;</span>: <span style=color:#4e9a06>&#39;OpenServerless&#39;</span>, <span style=color:#4e9a06>&#39;email&#39;</span>: <span style=color:#4e9a06>&#39;info@nuvolaris.io&#39;</span>, <span style=color:#4e9a06>&#39;phone&#39;</span>: <span style=color:#4e9a06>&#39;5551233210&#39;</span>, <span style=color:#4e9a06>&#39;message&#39;</span>: <span style=color:#4e9a06>&#39;This is awesome!&#39;</span><span style=color:#ce5c00;font-weight:700>}]</span>
</span></span></code></pre></div><hr></div><div class=td-content style=page-break-before:always><h1 id=pg-b63dd4c4560ad4b126907edb94fad405>1.5 - Sending notifications</h1><div class=lead>Sending notifications on user interaction</div><h2 id=sending-notifications>Sending notifications</h2><h3 id=contact-notification>Contact notification</h3><p>It would be great if we receive a notification when an user tries to
contact us. For this tutorial we will pick slack to receive a message
when it happens.</p><p>We need to:</p><ul><li><p>have a slack workspace where we can send messages;</p></li><li><p>create a slack app that will be added to the workspace;</p></li><li><p>activate a webhook for the app that we can trigger from an action;</p></li></ul><p>Check out the following scheme for the steps:</p><p><img alt="Slack Webhook" src=/docs/tutorial/images/slackurl.png></p><p>Once we have a webhook we can use to send messages we can proceed to
create a new action called <code>notify.js</code> (in the <code>packages/contact</code>
folder):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// notify.js
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>name</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>email</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>phone</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>message</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>text</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>`New contact request from </span><span style=color:#4e9a06>${</span><span style=color:#000>name</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06> (</span><span style=color:#4e9a06>${</span><span style=color:#000>email</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>, </span><span style=color:#4e9a06>${</span><span style=color:#000>phone</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>):\n</span><span style=color:#4e9a06>${</span><span style=color:#000>message</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>`</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Built message&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>text</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>fetch</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>notifications</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>method</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;POST&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#000>headers</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#4e9a06>&#39;Content-Type&#39;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#39;application/json&#39;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>        <span style=color:#000>body</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>JSON</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>stringify</span><span style=color:#000;font-weight:700>({</span> <span style=color:#000>text</span> <span style=color:#000;font-weight:700>}),</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>.</span><span style=color:#000>then</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>response</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>response</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ok</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Error sending message. Status code:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>response</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>status</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Message sent successfully&#34;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>body</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>body</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>})</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>.</span><span style=color:#204a87;font-weight:700>catch</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>error</span> <span style=color:#000;font-weight:700>=&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>            <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Error sending message&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>error</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>                <span style=color:#000>body</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>error</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>});</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>This action has the <code>args.notifications</code> parameter, which is the
webhook. It also has the usual 4 form fields parameters that receives in
input, used to build the text of the message. The action will return the
body of the response from the webhook.</p><p>We’ve also put some logs that we can use for debugging purposes.</p><p>Let’s first set up the action:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops action create contact/notify notify.js -p notifications &lt;your webhook&gt;
</span></span><span style=display:flex><span>ok: created action contact/notify
</span></span></code></pre></div><p>We are already setting the <code>notifications</code> parameter on action creation,
which is the webhook. The other one is the text that the submit action
will give in input at every invocation.</p><h3 id=creating-another-action-sequence>Creating Another Action Sequence</h3><p>We have developed an action that can send a Slack message as a
standalone action, but we designed it to take the output of the submit
action and return it as is. Time to extend the previous sequence!</p><p>Note that it will send messages for every submission, even for incorrect
inputs, so we will know if someone is trying to use the form without
providing all the information. But we will only store the fully
validated data in the database.</p><p>Let’s create the sequence, and then test it:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops action create contact/submit-notify --sequence contact/submit-write,contact/notify --web <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>ok: created action contact/submit-notify
</span></span></code></pre></div><p>We just created a new sequence <code>submit-notify</code> from the previous
sequence <code>submit-write</code> and the new <code>notify</code>.</p><p>If you want to get more info about this sequence, you can use the
<code>ops action get</code> command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops action get contact/submit-notify
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;namespace&#34;</span>: <span style=color:#4e9a06>&#34;openserverless/contact&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;name&#34;</span>: <span style=color:#4e9a06>&#34;submit-notify&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;version&#34;</span>: <span style=color:#4e9a06>&#34;0.0.1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;exec&#34;</span>: <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;kind&#34;</span>: <span style=color:#4e9a06>&#34;sequence&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;components&#34;</span>: <span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>            <span style=color:#4e9a06>&#34;/openserverless/contact/submit-write&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#4e9a06>&#34;/openserverless/contact/notify&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>]</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>,
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>See how the <code>exec</code> key has a <code>kind</code> of <code>sequence</code> and a list of
<code>components</code> that are the actions that compose the sequence.</p><p>Now to start using this sequence instead of using the submit action, we
need to update the <code>web/index.html</code> page to invoke the new sequence.</p><p>As before let’s grab the url:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops url contact/submit-notify
</span></span><span style=display:flex><span>&lt;apihost&gt;/api/v1/web/openserverless/contact/submit-notify
</span></span></code></pre></div><p>And update the <code>index.html</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>---            <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>form</span> <span style=color:#c4a000>method</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;POST&#34;</span> <span style=color:#c4a000>action</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/api/v1/web/openserverless/contact/submit-write&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#c4a000>enctype</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;application/x-www-form-urlencoded&#34;</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>--</span> <span style=color:#c4a000>old</span>
</span></span><span style=display:flex><span><span style=color:#a40000>+++</span>            <span style=color:#a40000>&lt;</span><span style=color:#c4a000>form</span> <span style=color:#c4a000>method</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;POST&#34;</span> <span style=color:#c4a000>action</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;/api/v1/web/openserverless/contact/submit-notify&#34;</span>
</span></span><span style=display:flex><span>                <span style=color:#c4a000>enctype</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#4e9a06>&#34;application/x-www-form-urlencoded&#34;</span><span style=color:#000;font-weight:700>&gt;</span> <span style=color:#000;font-weight:700>&lt;</span><span style=color:#204a87;font-weight:700>--</span> <span style=color:#c4a000>new</span>
</span></span></code></pre></div><p>Don’t forget to re-upload the web folder with <code>ops web upload web/</code>.</p><p>Now try to fill out the form again and press send! It will execute the
sequence and you will receive the message from your Slack App.</p><p>The tutorial introduced you to some utilities to retrieve information
and to the concept of <code>activation</code>. Let’s use some more commands to
check out the logs and see if the message was really sent.</p><p>The easiest way to check for all the activations that happen in this app
with all their logs is:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops activation poll
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Enter Ctrl-c to exit.
</span></span><span style=display:flex><span>Polling <span style=color:#204a87;font-weight:700>for</span> activation logs
</span></span></code></pre></div><p>This command polls continuously for log messages. If you go ahead and
submit a message in the app, all the actions will show up here together
with their log messages.</p><p>To also check if there are some problems with your actions, run a couple
of times <code>ops activation list</code> and check the <code>Status</code> of the
activations. If you see some <code>developer error</code> or any other errors, just
grab the activation ID and run <code>ops logs &lt;activation ID></code>.</p><hr></div><div class=td-content style=page-break-before:always><h1 id=pg-641d15a616ec48d5b2420ed9c67581ff>1.6 - App Deployment</h1><div class=lead>Learn how to deploy your app on Apache Openserverless</div><h2 id=app-deployment>App Deployment</h2><h3 id=packaging-the-app>Packaging the App</h3><p>With OpenServerless you can write a manifest file (in YAML) to have an
easy way to deploy applications.</p><p>In this last chapter of the tutorial we will package the code to easily
deploy the app, both frontend and actions.</p><h3 id=start-the-manifest-file>Start The Manifest File</h3><p>Let’s create a &ldquo;manifest.yaml&rdquo; file in the <code>packages</code> directory which
will be used to describe the actions to deploy:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>contact</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>actions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>notify</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>function</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>contacts/notify.js</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>web</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>inputs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>notifications</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>$NOTIFICATIONS</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>This is the basic manifest file with just the <code>notify</code> action. At the
top level we have the standard <code>packages</code> keyword, under which we can
define the packages we want. Until now we created all of our actions in
the <code>contact</code> package so we add it under <code>packages</code>.</p><p>Then under each package, the <code>actions</code> keyword is needed so we can add
our action custom names with the path to the code (with <code>function</code>).
Finally we also add <code>web: true</code> which is equivalent to <code>--web true</code> when
creating the action manually.</p><p>Finally we used the <code>inputs</code> keyword to define the parameters to inject
in the function.</p><p>If we apply this manifest file (we will see how soon), it will be the
same as the previous
<code>ops action create contact/notify &lt;path-to-notify.js> -p notifications $NOTIFICATIONS --web true</code>.
You need to have the webhooks url in the <code>NOTIFICATIONS</code> environment
variable.</p><h3 id=the-submit-action>The Submit Action</h3><p>The submit action is quite straightforward:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>contact</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>actions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>submit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>function</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>contact/submit.js</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>web</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><h3 id=the-database-actions>The Database Actions</h3><p>Similarly to the <code>notify</code> and <code>submit</code> actions, let’s add to the
manifest file the two actions for the database. We also need to pass as
a package parameter the DB url, so we will use <code>inputs</code> key as before,
but at the package level:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>contact</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>inputs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>dbUri</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>string</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>$POSTGRES_URL</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>actions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>write</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>function</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>contact/write.js</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>web</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>create-table</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>function</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>contact/create-table.js</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>autoexec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>Note the <code>create-table</code> action does not have the <code>web</code> set to true as it
is not needed to be exposed to the world. Instead it just has the
annotation for cron scheduler.</p><h3 id=the-sequences>The Sequences</h3><p>Lastly, we created a sequence with <code>submit</code> and <code>notify</code> that we have to
specify it in the manifest file as well.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>contact</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>inputs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>actions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#000>...</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>sequences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>submit-write</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>actions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>submit, write</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>web</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>submit-notify</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>actions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>submit-write, notify</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>web</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p>We just have to add the <code>sequences</code> key at the <code>contact</code> level (next to
<code>actions</code>) and define the sequences we want with the available actions.</p><h3 id=deployment>Deployment</h3><p>The final version of the manifest file is:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#204a87;font-weight:700>packages</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>  </span><span style=color:#204a87;font-weight:700>contact</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>inputs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>dbUri</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>type</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>string</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>$POSTGRES_URL</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>actions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>notify</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>function</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>contact/notify.js</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>web</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>inputs</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>notifications</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>            </span><span style=color:#204a87;font-weight:700>value</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>$NOTIFICATIONS</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>submit</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>function</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>contact/submit.js</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>web</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>write</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>function</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>contact/write.js</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>web</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>create-table</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>function</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>contact/create-table.js</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>annotations</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>          </span><span style=color:#204a87;font-weight:700>autoexec</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>    </span><span style=color:#204a87;font-weight:700>sequences</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>submit-write</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>actions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>submit, write</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>web</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>      </span><span style=color:#204a87;font-weight:700>submit-notify</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>actions</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#000>submit-write, notify</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span><span style=display:flex><span><span style=color:#f8f8f8;text-decoration:underline>        </span><span style=color:#204a87;font-weight:700>web</span><span style=color:#000;font-weight:700>:</span><span style=color:#f8f8f8;text-decoration:underline> </span><span style=color:#204a87;font-weight:700>true</span><span style=color:#f8f8f8;text-decoration:underline>
</span></span></span></code></pre></div><p><code>ops</code> comes equipped with a handy command to deploy an app:
<code>ops project deploy</code>.</p><p>It checks if there is a <code>packages</code> folder with inside a manifest file
and deploys all the specified actions. Then it checks if there is a
<code>web</code> folder and uploads it to the platform.</p><p>It does all what we did manually until now in one command.</p><p>So, from the top level directory of our app, let’s run (to also set the
input env var):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>POSTGRES_URL</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;your-postgres-url&gt;
</span></span><span style=display:flex><span><span style=color:#204a87>export</span> <span style=color:#000>NOTIFICATIONS</span><span style=color:#ce5c00;font-weight:700>=</span>&lt;the-webhook&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ops project deploy
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Packages and web directory present.
</span></span><span style=display:flex><span>Success: Deployment completed successfully.
</span></span><span style=display:flex><span>Found web directory. Uploading..
</span></span></code></pre></div><p>With just this command you deployed all the actions (and sequences) and
uploaded the frontend (from the web folder).</p><hr></div><div class=td-content style=page-break-before:always><h1 id=pg-01d9bce0990ebbcfcc9cb834c8365b3e>2 - CLI</h1><div class=lead>An handy command line to interact with all parts of OpenServerless</div><h2 id=openserverless-cli>OpenServerless CLI</h2><p>The <code>ops</code> command is the command line interface to OpenServerless</p><p>It let’s you to install and manipulate the components of the system.</p><p>If it is not already included in the development environment provided
you can <a href=/docs/installation/download/>download the CLI suitable for your platform from here, and
install it</a></p><h2 id=login-into-the-system>Login into the system</h2><p>To start working with you have to login in some OpenServerless
installation.</p><p>The administrator should have provided with username, password and the
URL to access the system.</p><p>For example, let’s assume you are the user <code>mirella</code> and the system is
available on <code>https://nuvolaris.dev</code>.</p><p>In order to login type the following command and enter you password.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops -login https://nuvolaris.dev mirella
</span></span><span style=display:flex><span>Enter Password:
</span></span></code></pre></div><p>If the password is correct you are logged in the system and you can use
the commands described below.</p><h2 id=next-steps>Next Steps</h2><p>Once logged in, you can:</p><ul><li><p>learn how to manage OpenServerless
<a href=/docs/cli/entities/>entities</a></p></li><li><p>learn how to deploy <a href=/docs/cli/project/>projects</a> and <a href=/docs/cli/assets/>web
assets</a></p></li><li><p>learn how to <a href=/docs/cli/admin/>administer the system</a> and <a href=/docs/cli/debug/>debug
the system</a></p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-a59e9ad2a8fb11a85d8ebedec00ea6b6>2.1 - Entities</h1><div class=lead>The parts that OpenServerless applications are made of</div><h2 id=entities>Entities</h2><p>OpenServerless applications are composed by some &ldquo;entities&rdquo; that you can
manipulate either using a command line interface or programmatically
with code.</p><p>The command line interface is the <code>ops</code> command line tools, that can be
used directly on the command line or automated through scripts. You can
also a REST API crafted explicitly for OpenServerless.</p><p>The entities available in OpenServerless are:</p><ul><li><p><a href=/docs/cli/entities/packages/>Packages</a>: They serve as a means of
grouping actions together, facilitating the sharing of parameters,
annotations, etc. Additionally, they offer a base URL that can be
utilized by web applications.</p></li><li><p><a href=/docs/cli/entities/actions/>Actions</a>: These are the fundamental
components of a OpenServerless application, capable of being written
in any programming language. Actions accept input and produce
output, both formatted in JSON.</p></li><li><p><a href=/docs/cli/entities/activations/>Activations</a>: Each action invocations
produces an activation id that can be listed. Action output and
results logged and are associated to activations and can be
retrieved providing an activativation id.</p></li><li><p><a href=/docs/cli/entities/sequences/>Sequences</a>: Actions can be
interconnected, where the output of one action serves as the input
for another, effectively forming a sequence.</p></li><li><p><a href=/docs/cli/entities/triggers/>Triggers</a>: Serving as entry points with
distinct names, triggers are instrumental in activating multiple
actions.</p></li><li><p><a href=/docs/cli/entities/rules/>Rules</a>: Rules establish an association
between a trigger and an action. Consequently, when a trigger is
fired, all associated actions are invoked accordingly.</p></li></ul><h2 id=the-ops-command>The <code>ops</code> command</h2><p>Let’s now provide an overview of OpenServerless&rsquo; command line interface,
focusing on the <code>ops</code> command.</p><p>The command can be dowloaded in precompile binary format for many
platform following the <code>Download</code> button on <a href=https://www.nuvolaris.io/>https://www.nuvolaris.io/</a></p><p>The <code>ops</code> command is composed of many commands, each one with many
subcommands. The general format is:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops &lt;entity&gt; &lt;command&gt; &lt;parameters&gt; &lt;flags&gt;
</span></span></code></pre></div><p>Note that <code>&lt;parameters></code> and <code>&lt;flags></code> are different for each
<code>&lt;command></code>, and for each <code>&lt;entity></code> there are many subcommands.</p><p>The CLI shows documention in the form of help output if you do not
provide enough parameters to it. Start with <code>ops</code> to get the list of the
main commands. If you type the <code>ops &lt;entity></code> get the help for that
entity, and so on.</p><p>For example, let’s see <code>ops</code> output (showing the command) and the more
frequently used command, <code>action</code>, also showing the more common
subcommands, shared with many others:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops
</span></span><span style=display:flex><span>Welcome to Ops, the all-mighty OpenServerless Build Tool
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The top level commands all have subcommands.
</span></span><span style=display:flex><span>Just <span style=color:#204a87>type</span> ops &lt;command&gt; to see its subcommands.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Commands:
</span></span><span style=display:flex><span>    action      work with actions
</span></span><span style=display:flex><span>    activation  work with activations
</span></span><span style=display:flex><span>    invoke      shorthand <span style=color:#204a87;font-weight:700>for</span> action invoke <span style=color:#ce5c00;font-weight:700>(</span>-r is the default<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    logs        shorthand <span style=color:#204a87;font-weight:700>for</span> activation logs
</span></span><span style=display:flex><span>    package     work with packages
</span></span><span style=display:flex><span>    result      shorthand <span style=color:#204a87;font-weight:700>for</span> activation result
</span></span><span style=display:flex><span>    rule        work with rules
</span></span><span style=display:flex><span>    trigger     work with triggers
</span></span><span style=display:flex><span>    url         get the url of a web action$ wsk action
</span></span></code></pre></div><p>There are many more sub commands used for aministrative purposes. In
this documentation we only focus on the subcommands used to manage the
main entities of OpenServerless.</p><p>Keep in mind that commands represent entities, and their subcommands
follow the CRUD model (Create, Retrieve via get/list, Update, Delete).
This serves as a helpful mnemonic to understand the <code>ops</code> command’s
functionality. While there are exceptions, these will be addressed
throughout the chapter’s discussion. Note however that some subcommand
may have some specific flags.</p><h2 id=naming-entities>Naming Entities</h2><p>Let’s see how entities are named.</p><p>Each user also has a <strong>namespace</strong>, and everything a user creates,
belongs to it.</p><p>The namespace is usually created by a system administrator.</p><p>Under a namespace you can create triggers, rules, actions and packages.</p><p>Those entities will have a name like this:</p><ul><li><p><code>/mirella/demo-triggger</code></p></li><li><p><code>/mirella/demo-rule</code></p></li><li><p><code>/mirella/demo-package</code></p></li><li><p><code>/mirella/demo-action</code></p></li></ul><p>When you create a package, you can put under it actions and feeds. Those
entities are named</p><ul><li><p><code>/mirella/demo-package/demo-action</code></p></li><li><p><code>/mirella/demo-package/demo-feed</code></p></li></ul><blockquote><p>💡 <strong>NOTE</strong></p><p>In the commands you do not require to specify a namespace. If your user
is <code>mirella</code>, your namespace is <code>/mirella</code>, and You type <code>demo-package</code>
to mean <code>/mirella/demo-package</code>, and <code>demo-package/demo-action</code> to mean
<code>/mirella/demo-package/demo-action</code>.</p></blockquote></div><div class=td-content style=page-break-before:always><h1 id=pg-0f78024b5380f26a2900a3b24b8df6a2>2.1.1 - Packages</h1><div class=lead>How to group actions and their related files</div><h2 id=packages>Packages</h2><p>OpenServerless groups actions and feeds in <strong>packages</strong> under a
namespace. It is conceptually similar to a folder containing a group of
related files.</p><p>A package allows you to:</p><ul><li><p>Group related actions together.</p></li><li><p>Share parameters and annotations (each action sees the parameters
assigned to the package).</p></li><li><p>Provide web actions with a common prefix in the URL to invoke them.</p></li></ul><p>For example, we can create a package <code>demo-package</code> and assign a
parameter:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops package create demo-package -p email no-reply@nuvolaris.io
</span></span><span style=display:flex><span>ok: created package demo-package
</span></span></code></pre></div><p>This command creates a new package with the specified name.</p><h3 id=package-creation-update-and-deletion>Package Creation, Update, and Deletion</h3><p>Let’s proceed with the commands to list, get information, update, and
finally delete a package:</p><p>First, let’s list our packages:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops package list
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>packages
</span></span><span style=display:flex><span>/openserverless/demo-package/ private
</span></span></code></pre></div><p>If you want to update a package by adding a parameter:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops package update demo-package -p email info@nuvolaris.io
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ok: updated package demo-package
</span></span></code></pre></div><p>Let’s retrieve some package information:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops package get demo-package -s
</span></span><span style=display:flex><span>package /openserverless/demo-package/sample:
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>(</span>parameters: *email<span style=color:#ce5c00;font-weight:700>)</span>
</span></span></code></pre></div><p>Note the final <code>-s</code>, which means &ldquo;summarize.&rdquo;</p><p>Finally, let’s delete a package:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops package delete demo-package
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ok: deleted package demo-package
</span></span></code></pre></div><h3 id=adding-actions-to-the-package>Adding Actions to the Package</h3><p>Actions can be added to a package using this command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops action create &lt;package-name&gt;/&lt;action-name&gt;
</span></span></code></pre></div><p>This associates an existing action with the specified package.</p><h3 id=using-packages>Using Packages</h3><p>Once a package is created, actions within it can be invoked using their
full path, with this schema: <code>&lt;package-name>/&lt;action-name></code>. This allows
organizing actions hierarchically and avoiding naming conflicts.</p><h2 id=conclusion>Conclusion</h2><p>Packages in OpenServerless provide a flexible and organized way to
manage actions and their dependencies. Using the Ops CLI, you can
efficiently create, add actions, and manage package dependencies,
simplifying the development and management of serverless applications.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-92e5b80b2a52f86c8fa5eac178ced4d8>2.1.2 - Actions</h1><div class=lead>Functions, the core of OpenServerless</div><h2 id=actions>Actions</h2><p>An action can generally be considered as a function, a snippet of code,
or generally a method.</p><p>The <code>ops action</code> command is designed for managing actions, featuring
frequently utilized CRUD operations such as list, create, update, and
delete. We will illustrate these operations through examples using a
basic hello action. Let’s assume we have the following file in the
current directory:</p><p>The <code>hello.js</code> script with the following content:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>body</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Hello&#34;</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=simple-action-deployment>Simple Action Deployment</h2><p>If we want to deploy this simple action in the package <code>demo</code>, let’s
execute:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops package update demo
</span></span><span style=display:flex><span>ok: updated package demo
</span></span><span style=display:flex><span>$ ops action update demo/hello hello.js
</span></span><span style=display:flex><span>ok: update action demo/hello
</span></span></code></pre></div><p>Note that we ensured the package exists before creating the action.</p><p>We can actually omit the package name. In this case, the package name is
<code>default</code>, which always exists in a namespace. However, we advise always
placing actions in some named package.</p><blockquote><p>💡 <strong>NOTE</strong></p><p>We used <code>update</code>, but we could have used <code>create</code> if the action does not
exist because <code>update</code> also creates the action if it does not exist and
updates it if it is already there. Update here is similar to the <code>patch</code>
concept in REST API. However, <code>create</code> generates an error if an action
does not exist, while <code>update</code> does not, so it is practical to always
use <code>update</code> instead of <code>create</code> (unless we really want an error for an
existing action for some reason).</p></blockquote><h2 id=how-to-invoke-actions>How to Invoke Actions</h2><p>Let’s try to run the action:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops invoke demo/hello
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;body&#34;</span>: <span style=color:#4e9a06>&#34;Hello&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>Actually, the <code>invoke</code> command does not exist, or better, it’s just a
handy shortcut for <code>ops action invoke -r</code>.</p><p>If you try to run <code>ops action invoke demo/hello</code>, you get:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops action invoke demo/hello
</span></span><span style=display:flex><span>ok: invoked /_/demo/hello with id fec047bc81ff40bc8047bc81ff10bc85
</span></span></code></pre></div><p>You may wonder where the result is. In reality, in OpenServerless, all
actions are by default asynchronous, so what you usually get is the
<strong>activation id</strong> to retrieve the result once the action is completed.</p><p>To block the execution until the action is completed and get the result,
you can either use the flag <code>-r</code> or <code>--result</code>, or use <code>ops invoke</code>.</p><p>Note, however, that we are using <code>ops</code> to invoke an action, which means
all the requests are authenticated. You cannot invoke actions directly
without logging into the system first.</p><p>However, you can mark an action to be public by creating it with
<code>--web true</code> (see below).</p><h3 id=public-actions>Public Actions</h3><p>If you want an action to be public, you can do:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops action update demo/hello hello.js --web <span style=color:#204a87>true</span>
</span></span><span style=display:flex><span>ok: updated action demo/hello
</span></span><span style=display:flex><span>$ ops url demo/hello
</span></span><span style=display:flex><span>https://nuvolaris.dev/api/v1/web/mirella/demo/hello
</span></span></code></pre></div><p>and you can invoke it with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ curl -sL https://nuvolaris.dev/api/v1/web/dashboard/demo/hello
</span></span><span style=display:flex><span>Hello
</span></span></code></pre></div><p>Note that the output is only showing the value of the body field. This
is because the web actions must follow a pattern to produce an output
suitable for web output, so the output should be under the key <code>body</code>,
and so on. Check the section on Web Actions for more information.</p><blockquote><p>💡 <strong>NOTE</strong></p><p>Actually, <code>ops url</code> is a shortcut for <code>ops action get --url</code>. You can
use <code>ops action get</code> to retrieve a more detailed description of an
action in JSON format.</p></blockquote><p>After <code>action create</code>, <code>action update</code>, and <code>action get</code> (and the
shortcuts <code>invoke</code> and <code>url</code>), we should mention <code>action list</code> and
<code>action delete</code>.</p><p>The <code>action list</code> command obviously lists actions and allows us to
delete them:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops action list
</span></span><span style=display:flex><span>/mirella/demo/hello                                                  private nodejs:18
</span></span><span style=display:flex><span>$ ops action delete demo/hello
</span></span><span style=display:flex><span>ok: deleted action demo/hello
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>Actions are a core part of our entities. A ops action is a
self-contained and executable unit of code deployed on the ops
serverless computing platform.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-554923b69d6a963b7b804b6a9c9cbca1>2.1.3 - Activations</h1><div class=lead>Detailed records of action executions</div><h2 id=activations>Activations</h2><p>When an event occurs that triggers a function, ops creates an activation
record, which contains information about the function execution, such as
input parameters, output results, and any metadata associated with the
activation. It’s something similar to the classic concept of <code>log</code>.</p><h2 id=how-activations-work>How activations work</h2><p>When invoking an action with <code>ops action invoke</code>, you’ll receive only an
invocation id as an answer.</p><p>This invocation id allows you to read results and outputs produced by
the execution of an action.</p><p>Let’s demonstrate how it works by modifying the <code>hello.js</code> file to add a
command to log some output.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Hello&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#4e9a06>&#34;body&#34;</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Hello&#34;</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Now, let’s deploy and invoke it (with a parameter <code>hello=world</code>) to get
the activation id:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops action update demo/hello hello.js
</span></span><span style=display:flex><span>ok: updated action demo/hello
</span></span><span style=display:flex><span>$ ops action invoke demo/hello
</span></span><span style=display:flex><span>ok: invoked /_/demo/hello with id 0367e39ba7c74268a7e39ba7c7126846
</span></span></code></pre></div><p>Associated with every invocation, there is an activation id (in the
example, it is <code>0367e39ba7c74268a7e39ba7c7126846</code>).</p><p>We use this id to retrieve the results of the invocation with
<code>ops activation result</code> or its shortcut, just <code>ops result</code>, and we can
retrieve the logs using <code>ops activation logs</code> or just <code>ops logs</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops result 0367e39ba7c74268a7e39ba7c7126846
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;body&#34;</span>: <span style=color:#4e9a06>&#34;Hello&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>$ ops logs 0367e39ba7c74268a7e39ba7c7126846
</span></span><span style=display:flex><span>2024-02-17T20:01:31.901124753Z stdout: Hello
</span></span></code></pre></div><h3 id=list-of-activations>List of activations</h3><p>You can list the activations with <code>ops activation list</code> and limit the
number with <code>--limit</code> if you are interested in a subset.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops activation list --limit <span style=color:#0000cf;font-weight:700>5</span>
</span></span><span style=display:flex><span>Datetime            Activation ID                    Kind      Start Duration   Status  Entity
</span></span><span style=display:flex><span>2024-02-17 20:01:31 0367e39ba7c74268a7e39ba7c7126846 nodejs:18 warm  8ms        success dashboard/hello:0.0.1
</span></span><span style=display:flex><span>2024-02-17 20:00:00 f4f82ee713444028b82ee71344b0287d nodejs:18 warm  5ms        success dashboard/hello:0.0.1
</span></span><span style=display:flex><span>2024-02-17 19:59:54 98d19fe130da4e93919fe130da7e93cb nodejs:18 cold  33ms       success dashboard/hello:0.0.1
</span></span><span style=display:flex><span>2024-02-17 17:40:53 f25e1f8bc24f4f269e1f8bc24f1f2681 python:3  warm  3ms        success dashboard/index:0.0.2
</span></span><span style=display:flex><span>2024-02-17 17:35:12 bed3213547cc4aed93213547cc8aed8e python:3  warm  2ms        success dashboard/index:0.0.2
</span></span></code></pre></div><p>Note also the <code>--since</code> option, which is useful to show activations from
a given timestamp (you can obtain a timestamp with <code>date +%s</code>).</p><p>Since it can be quite annoying to keep track of the activation id, there
are two useful alternatives.</p><p>With <code>ops result --last</code> and <code>ops logs --last</code>, you can retrieve just
the last result or log.</p><h3 id=polling-activations>Polling activations</h3><p>With <code>ops activation poll</code>, the CLI starts a loop and displays all the
activations as they happen.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops activation poll
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Enter Ctrl-c to exit.
</span></span><span style=display:flex><span>Polling <span style=color:#204a87;font-weight:700>for</span> activation logs
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>Activations provide a way to monitor and track the execution of
functions, enabling understanding of how code behaves in response to
different events and allowing for debugging and optimizing serverless
applications.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7ef4df7378cddcf2eede13ac0f6e3773>2.1.4 - Sequences</h1><div class=lead>Combine actions in sequences</div><h2 id=sequences>Sequences</h2><p>You can combine actions into sequences and invoke them as a single
action. Therefore, a sequence represents a logical junction between two
or more actions, where each action is invoked in a specific order.</p><h3 id=combine-actions-sequentially>Combine actions sequentially</h3><p>Suppose we want to describe an algorithm for preparing a pizza. We could
prepare everything in a single action, creating it all in one go, from
preparing the dough to adding all the ingredients and cooking it.</p><p>What if you would like to edit only a specific part of your algorithm,
like adding fresh tomato instead of classic, or reducing the amount of
water in your pizza dough? Every time, you have to edit your main action
to modify only a part.</p><p>Again, what if before returning a pizza you’d like to invoke a new
action like &ldquo;add basil,&rdquo; or if you decide to refrigerate the pizza dough
after preparing it but before cooking it?</p><p>This is where sequences come into play.</p><p>Create a file called <strong>preparePizzaDough.js</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>persons</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>howManyPerson</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>flour</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>persons</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#0000cf;font-weight:700>180</span><span style=color:#000;font-weight:700>;</span> <span style=color:#8f5902;font-style:italic>// grams
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>water</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>persons</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#0000cf;font-weight:700>120</span><span style=color:#000;font-weight:700>;</span> <span style=color:#8f5902;font-style:italic>// ml
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>yeast</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>flour</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>water</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#0000cf;font-weight:700>0.02</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>pizzaDough</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;Mix &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>    <span style=color:#000>flour</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34; grams of flour with &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>    <span style=color:#000>water</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34; ml of water and add &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>    <span style=color:#000>yeast</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34; grams of brewer&#39;s yeast&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>pizzaDough</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>pizzaDough</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>whichPizza</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>whichPizza</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Now, in a file <strong>cookPizza.js</strong></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>pizzaDough</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>pizzaDough</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>whichPizza</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>args</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>whichPizza</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>let</span> <span style=color:#000>baseIngredients</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;tomato and mozzarella&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>whichPizza</span> <span style=color:#ce5c00;font-weight:700>===</span> <span style=color:#4e9a06>&#34;Margherita&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>result</span><span style=color:#ce5c00;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;Cook &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>        <span style=color:#000>pizzaDough</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34; topped with &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>        <span style=color:#000>baseIngredients</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34; for 3 minutes at 380°C&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>whichPizza</span> <span style=color:#ce5c00;font-weight:700>===</span> <span style=color:#4e9a06>&#34;Sausage&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>baseIngredients</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#4e9a06>&#34;plus sausage&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>result</span><span style=color:#ce5c00;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;Cook &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>        <span style=color:#000>pizzaDough</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34; topped with &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>        <span style=color:#000>baseIngredients</span> <span style=color:#ce5c00;font-weight:700>+</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#34;. Cook for 3 minutes at 380°C&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>We have now split our code to prepare pizza into two different actions.
When we need to edit only one action without editing everything, we can
do it! Otherwise, we can now add new actions that can be invoked or not
before cooking pizza (or after).</p><p>Let’s try it.</p><h3 id=testing-the-sequence>Testing the sequence</h3><p>First, create our two actions</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops action create preparePizzaDough preparePizzaDough.js
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ops action create cookPizza cookPizza.js
</span></span></code></pre></div><p>Now, we can create the sequence:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops action create pizzaSequence --sequence preparePizzaDough,cookPizza
</span></span></code></pre></div><p>Finally, let’s invoke it</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops action invoke --result pizzaSequence -p howManyPerson <span style=color:#0000cf;font-weight:700>4</span> -p whichPizza <span style=color:#4e9a06>&#34;Margherita&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;result&#34;</span>: <span style=color:#4e9a06>&#34;Cook Mix 720 grams of flour with 480 ml of water and add 24 grams of brewer&#39;s yeast topped with tomato and mozzarella for 3 minutes at 380°C&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><p>Now, thanks to sequences, our code is split correctly, and we are able
to scale it more easily!</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8f082b7c68191e2e106ca0e1c10959e2>2.1.5 - Triggers</h1><div class=lead>Event source that triggers an action execution</div><h2 id=triggers>Triggers</h2><p>Now let’s see what a trigger is and how to use it.</p><p>We can define a <strong>trigger</strong> as an object representing an event source
that triggers the execution of <strong>actions</strong>. When activated by an event,
associated actions are executed.</p><p>In other words, a trigger is a mechanism that listens for specific
events or conditions and initiates actions in response to those events.
It acts as the starting point for a workflow.</p><h2 id=example-sending-slack-notifications>Example: Sending Slack Notifications</h2><p>Let’s consider a scenario where we want to send Slack notifications when
users visit specific pages and submit a contact form.</p><h3 id=step-1-define-the-trigger>Step 1: Define the Trigger</h3><p>We create a trigger named &ldquo;PageVisitTrigger&rdquo; that listens for events
related to user visits on our website. To create it, you can use the
following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops trigger create PageVisitTrigger
</span></span></code></pre></div><p>Once the trigger is created, you can update it to add parameters, such
as the page parameter:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops trigger update PageVisitTrigger --param page homepage
</span></span></code></pre></div><blockquote><p>💡 <strong>NOTE</strong></p><p>Of course, there are not only <code>create</code> and <code>update</code>, but also <code>delete</code>,
and they work as expected, updating and deleting triggers. In the next
paragraph, we will also see the <code>fire</code> command, which requires you to
first create rules to do something useful.</p></blockquote><h3 id=step-2-associate-the-trigger-with-an-action>Step 2: Associate the Trigger with an Action</h3><p>Next, we create an action named &ldquo;SendSlackNotification&rdquo; that sends a
notification to Slack when invoked. Then, we associate this action with
our &ldquo;PageVisitTrigger&rdquo; trigger, specifying that it should be triggered
when users visit certain pages.</p><p>To associate the trigger with an action, you can use the following
command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops rule create TriggerRule PageVisitTrigger SendSlackNotification
</span></span></code></pre></div><p>We’ll have a better understanding of this aspect in
<a href=/docs/cli/entities/rules/#rules>Rules</a></p><p>In this example, whenever a user visits either the homepage or the
contact page, the &ldquo;SendSlackNotification&rdquo; action will be triggered,
resulting in a Slack notification being sent.</p><h2 id=conclusion>Conclusion</h2><p>Triggers provide a flexible and scalable way to automate workflows based
on various events. By defining triggers and associating them with
actions, you can create powerful applications that respond dynamically
to user interactions, system events, or any other specified conditions.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-6a429876717c094e5d07d91849fe1619>2.1.6 - Rules</h1><div class=lead>Connection rules between triggers and actions</div><h2 id=rules>Rules</h2><p>Once we have a trigger and some actions, we can create rules for the
trigger. A rule connects the trigger with an action, so if you fire the
trigger, it will invoke the action. Let’s see this in practice in the
next listing.</p><h3 id=create-data>Create data</h3><p>First of all, create a file called <strong>alert.js</strong>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#204a87;font-weight:700>function</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>log</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Suspicious activity!&#34;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>result</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#4e9a06>&#34;Suspicious activity!&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>};</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Then, create a OpenServerless action for this file:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops action create alert alert.js
</span></span></code></pre></div><p>Now, create a trigger that we’ll call <strong>notifyAlert</strong>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops trigger create notifyAlert
</span></span></code></pre></div><p>Now, all is ready, and now we can create our rule! The syntax follows
this pattern: &ldquo;ops rule create {ruleName} {triggerName} {actionName}&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops rule create alertRule notifyAlert alert
</span></span></code></pre></div><h3 id=test-your-rule>Test your rule</h3><p>Our environment can now be alerted if something suspicious occurs!
Before starting, let’s open another terminal window and enable polling
(with the command <code>ops activation poll</code>) to see what happens.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops activation poll
</span></span><span style=display:flex><span>Enter Ctrl-c to exit.
</span></span><span style=display:flex><span>Polling <span style=color:#204a87;font-weight:700>for</span> activation logs
</span></span></code></pre></div><p>It’s time to fire the trigger!</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops trigger fire notifyAlert
</span></span><span style=display:flex><span>ok: triggered /notifyAlert with id 86b8d33f64b845f8b8d33f64b8f5f887
</span></span></code></pre></div><p>Now, go to see the result! Check the terminal where you are polling
activations now!</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Enter Ctrl-c to exit.
</span></span><span style=display:flex><span>Polling <span style=color:#204a87;font-weight:700>for</span> activation logs
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Activation: <span style=color:#4e9a06>&#39;alert&#39;</span> <span style=color:#ce5c00;font-weight:700>(</span>dfb43932d304483db43932d304383dcf<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;2024-02-20T03:15.15472494535Z stdout: Suspicious activity!&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><h2 id=conclusion>Conclusion</h2><blockquote><p>💡 <strong>NOTE</strong></p><p>As with all the other commands, you can execute <code>list</code>, <code>update</code>, and
<code>delete</code> by name.</p></blockquote><p>A trigger can enable multiple rules, so firing one trigger actually
activates multiple actions. Rules can also be enabled and disabled
without removing them. As in the last example, let’s try to disable the
first rule and fire the trigger again to see what happens.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops rule disable alertRule    
</span></span><span style=display:flex><span>ok: disabled rule alertRule
</span></span><span style=display:flex><span>$ ops trigger fire notifyAlert  
</span></span><span style=display:flex><span>ok: triggered /_/notifyAlert with id 0f4fa69d910f4c738fa69d910f9c73af
</span></span></code></pre></div><ul><li><p>Disabling the rule.</p></li><li><p>Firing the trigger again.</p></li></ul><p>In the activation polling window, we can see that no action is executed
now. Of course, we can enable the rule again with:</p><pre><code>ops rule enable alertRule
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-1dd578aa460d31b1869cc6d674346f9c>2.2 - Administration</h1><div class=lead>System administration</div><h2 id=administration>Administration</h2><p>If you are the administrator and you have access to the Kubernetes
cluster where <a href=/docs/installation/>OpenServerless is
installed</a> you can administer the
system.</p><p>You have access to the <code>ops admin</code> subcommand with the following
synopsis:</p><p>Subcommand: ops admin</p><pre><code>Usage:
  admin adduser &lt;username&gt; &lt;email&gt; &lt;password&gt; [--all] [--redis] [--mongodb] [--minio] [--postgres] [--storagequota=&lt;quota&gt;|auto]
  admin deleteuser &lt;username&gt;

Commands:
  admin adduser       create a new user in OpenServerless with the username, email and password provided
  admin deleteuser    delete a user from the OpenServerless installation via the username provided

Options:
  --all                   enable all services
  --redis                 enable redis
  --mongodb               enable mongodb
  --minio                 enable minio
  --postgres              enable postgres
  --storagequota=&lt;quota&gt;
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-6340dcb693e404ad47e4e09c1ee11088>2.3 - Debugging</h1><div class=lead>Utilities to troubleshoot OpenServerless&rsquo; cluster</div><p>The <code>ops debug</code> subcomand gives access to many useful debugging
utilities as follow:</p><p>You need access to the Kubernetes cluster where OpenServerless is
installed.</p><pre><code>ops debug: available subcommands:
* apihost:                show current apihost
* certs:                  show certificates
* config:                 show deployed configuration
* images:                 show current images
* ingress:                show ingresses
* kube:                   kubernetes support subcommand prefix
* lb:                     show ingress load balancer
* log:                    show logs
* route:                  show openshift route
* runtimes:               show runtimes
* status:                 show deployment status
* watch:                  watch nodes and pod deployment
* operator:version:       show operator versions
</code></pre><p>The <code>ops debug kube</code> subcommand also gives detailed informations about
the underlying Kubernetes cluster:</p><pre><code>ops debug kube: available subcommands:
* ctl:            execute a kubectl command, specify with CMD=&lt;command&gt;
* detect:         detect the kind of kubernetes we are using
* exec:           exec bash in pod P=...
* info:           show info
* nodes:          show nodes
* ns:             show namespaces
* operator:       describe operator
* pod:            show pods and related
* svc:            show services, routes and ingresses
* users:          show openserverless users custom resources
* wait:           wait for a value matching the given jsonpath on the specific resources under the namespace openserverless
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-7c5884f2646d97650d003d132a755b1f>2.4 - Project</h1><div class=lead>How to deal with OpenServerless projects</div><h2 id=project>Project</h2><h3 id=an-openserverless-project>An OpenServerless Project</h3><blockquote><p>⚠️ <strong>WARNING</strong></p><p>This document is still 🚧 <strong>work in progress</strong> 🚧</p></blockquote><p>A project represents a logical unit of functionality whose boundaries
are up to you. Your app can contain one or more projects. The folder
structure of a project determines how the deployer finds and labels
packages and actions, how it deploys static web content, and what it
ignores.</p><p>You can detect and load entire projects into OpenServerless with a
single command using the <code>ops</code> CLI tool.</p><h3 id=project-detection>Project Detection</h3><p>When deploying a project, <code>ops</code> checks in the given path for 2 special
folders:</p><ul><li><p>The <code>packages</code> folder: contains sub-folders that are treated as
OpenServerless packages and are assumed to contain actions in the
form of either files or folders, which we refer to as Single File
Actions (SFA) and Multi File Actions (MFA).</p></li><li><p>The <code>web</code> folder: contains static web content.</p></li></ul><p>Anything else is ignored. This lets you store things in the root folder
that are not meant to be deployed on OpenServerless (such as build
folders and project documentation).</p><h4 id=single-file-actions>Single File Actions</h4><p>A single file action is simply a file with specific extension (the
supported ones: <code>.js</code> <code>.py</code> <code>.php</code> <code>.go</code> <code>.java</code>), whici is directly deployed
as an action.</p><h4 id=multi-file-actions>Multi File Actions</h4><p>A multi-file action is a folder containing a <code>main</code> file and
dependencies. The folder is bundled into a zip file and deployed as an
action.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-fb7457c476cfc08297adf7909fafd156>2.5 - Web Assets</h1><div class=lead>How to handle frontend deployment</div><h2 id=upload-web-assets>Upload Web Assets</h2><p>The <code>web</code> folder in the root of a project is used to deploy static
frontends. A static front-end is a collection of static asset under a
given folder that will be published in a web server under a path.</p><p>Every uses has associated a web accessible static area where you can
upload static assets.</p><p>You can upload a folder in this web area with</p><p><code>ops web upload &lt;folder></code></p><pre><code>Synopsis:

    Subcommand: ops web

    Commands to upload and manage static content.

    Usage:
      web upload &lt;folder&gt; [--quiet] [--clean]

    Commands:
      upload &lt;folder&gt;  Uploads a folder to the web bucket in OpenServerless.

    Options:
      --quiet   Do not print anything to stdout.
      --clean   Remove all files from the web bucket instead.
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-b00a88a07ceb21b1a83e5822e0c86c1d>3 - Reference</h1><div class=lead>OpenServerless Developer Guide</div><p>Welcome to OpenServerless Developer guide.</p><p>OpenServerless is based on <a href=https://openwhisk.apache.org>Apache OpenWhisk</a>
and the documentation in this section is derived for the official
OpenWhisk documentation.</p><p>In this sections we mostly document how to write <a href=/docs/reference/#actions.adoc><strong>actions</strong>
(functions)</a>, the building blocks of OpenWhisk and
OpenServerless applications. There are also a few related entities for
managing actions (packages, parameters etc) you also need to know.</p><p>You can write actions in a number of programming languages. OpenServerless
supports directly <a href=/docs/reference/#index-runtimes.adoc>this list of programming
languages</a>. The list is expanding over the time.</p><p>See below for documentation related to:</p><ul><li><p><a href=/docs/reference/#index-entities.adoc>OpenWhisk Entities</a></p></li><li><p><a href=/docs/reference/#index-runtimes.adoc>OpenServerless Runtimes</a></p></li><li><p><a href=/docs/reference/tools/>OpenServerless <code>ops</code> Tools</a></p></li><li><p><a href=/docs/reference/tasks/>OpenServerless <code>ops</code> Tasks</a></p></li><li><p><a href=/docs/reference/#index-references>Advanced Reference Documentation</a></p></li></ul><p>There is also a <a href=/docs/reference/#actions-actionloop.adoc>tutorial and a development
kit</a> to build your own runtime for your
favorite programming language.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-74fdda9fa92a80e92e8b3d05dd0e8ba1>3.1 - Advanced</h1><h1 id=advanced-reference-guides>Advanced Reference Guides</h1><p>You can find advanced reference documentations here:</p><ul><li><p><a href=/docs/reference/references/#reference.adoc>Naming and Limits</a></p></li><li><p><a href=/docs/reference/references/#cli.adoc>Advanced CLI</a></p></li><li><p><a href=/docs/reference/references/#rest_api.adoc>Rest API</a></p></li><li><p><a href=/docs/reference/references/#actions-new.adoc>Runtimes under the hood</a></p></li><li><p><a href=/docs/reference/references/#actions-actionloop.adoc>Building your runtime</a></p></li></ul></div><div class=td-content><h1 id=pg-4e4418ead51c6c16751a09aaa9f7902c>3.1.1 - Advanced CLI</h1><h1 id=openserverless-cli>OpenServerless CLI</h1><p>OpenServerless offers a powerful command line interface named <code>ops</code> which
extends and embeds the OpenWhisk <code>wsk</code>.</p><p>Download instructions are available <a href=/installation/download>here</a>.</p><p>Let&rsquo;s see some advanced uses of <code>ops</code>.</p><p>OpenServerless access is usually configured logging into the platform with the <code>ops -login</code> command.</p><p>You can also configure access directly using the <code>ops -wsk</code> command.</p><p>There are two required properties to configure:</p><ol><li><p><strong>API host</strong> (name or IP address) for the OpenWhisk and OpenServerless
deployment you want to use.</p></li><li><p><strong>Authorization key</strong> (username and password) which grants you
access to the OpenWhisk and OpenServerless API.</p></li></ol><p>The API host ia the installationj host, the one you configure in
installation with <code>ops config apihost</code></p><pre><code>ops -wsk property set --apihost &lt;openwhisk_baseurl&gt;
</code></pre><p>If you know your authorization key, you can configure the CLI to use it.
Otherwise, you will need to obtain an authorization key for most CLI
operations. The API key is visible in the file <code>~/.wskprops</code> after you
perform a <code>ops -login</code>. This file can be sourced to be read as
environment variables.</p><pre><code>source ~/.wskprops
ops -wsk property set --auth $AUTH
</code></pre><p><strong>Tip:</strong> The OpenWhisk and OpenServerless CLI stores properties in the
<code>~/.wskprops</code> configuration file by default. The location of this file
can be altered by setting the <code>WSK_CONFIG_FILE</code> environment variable.</p><p>The required properties described above have the following keys in the
<code>.wskprops</code> file:</p><ul><li><p><strong>APIHOST</strong> - Required key for the API host value.</p></li><li><p><strong>AUTH</strong> - Required key for the Authorization key.</p></li></ul><p>To verify your CLI setup, try <code>ops action list</code>.</p><h2 id=configure-the-cli-to-use-an-https-proxy>Configure the CLI to use an HTTPS proxy</h2><p>The CLI can be setup to use an HTTPS proxy. To setup an HTTPS proxy, an
environment variable called <code>HTTPS_PROXY</code> must be created. The variable
must be set to the address of the HTTPS proxy, and its port using the
following format: <code>{PROXY IP}:{PROXY PORT}</code>.</p><h2 id=configure-the-cli-to-use-client-certificate>Configure the CLI to use client certificate</h2><p>The CLI has an extra level of security from client to apihost, system
provides default client certificate configuration which deployment
process generated, then you can refer to below steps to use client
certificate:</p><pre><code>ops -wsk property set --cert &lt;client_cert_path&gt; --key &lt;client_key_path&gt;
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-84f68b8583b274cc8a7f9f04c649e1b4>3.1.2 - Building your runtime</h1><h1 id=developing-a-new-runtime-with-the-actionloop-proxy>Developing a new Runtime with the ActionLoop proxy</h1><p>The <a href=/docs/reference/references/actions-actionloop/#actions-new.adoc>OpenWhisk and OpenServerless runtime specification</a>
defines the expected behavior of an OpenWhisk and OpenServerless runtime; you
can choose to implement a new runtime from scratch by just following
this specification. However, the fastest way to develop a new, compliant
runtime is by reusing the <em><a href=https://github.com/apache/openwhisk-runtime-go#actionloop-runtime>ActionLoop
proxy</a></em>
which already implements most of the specification and requires you to
write code for just a few hooks to get a fully functional (and <em>fast</em>)
runtime in a few hours or less.</p><h2 id=what-is-the-actionloop-proxy>What is the ActionLoop proxy</h2><p>The <code>ActionLoop proxy</code> is a runtime “engine”, written in the <a href=https://golang.org/>Go
programming language</a>, originally developed
specifically to support the <a href=https://github.com/apache/openwhisk-runtime-go>OpenWhisk and OpenServerless Go language
runtime</a>. However, it
was written in a generic way such that it has since been adopted to
implement OpenWhisk and OpenServerless runtimes for Swift, PHP, Python, Rust,
Java, Ruby and Crystal. Even though it was developed with compiled
languages in mind it works equally well with scripting languages.</p><p>Using it, you can develop a new runtime in a fraction of the time needed
for authoring a full-fledged runtime from scratch. This is due to the
fact that you have only to write a command line protocol and not a
fully-featured web server (with a small amount of corner cases to
consider). The results should also produce a runtime that is fairly fast
and responsive. In fact, the ActionLoop proxy has also been adopted to
improve the performance of existing runtimes like Python, Ruby, PHP, and
Java where performance has improved by a factor between 2x to 20x.</p><h3 id=precompilation-of-openwhisk-and-openserverless-actions>Precompilation of OpenWhisk and OpenServerless Actions</h3><p>In addition to being the basis for new runtime development, ActionLoop
runtimes can also support offline “precompilation” of OpenWhisk and
OpenServerless Action source files into a ZIP file that contains only the
compiled binaries which are very fast to start once deployed. More
information on this approach can be found here: <a href=https://github.com/apache/openwhisk-runtime-go/blob/master/docs/DEPLOY.md#precompile>Precompiling Go Sources
Offline</a>
which describes how to do this for the Go language, but the approach
applies to any language supported by ActionLoop.</p><h1 id=tutorial---how-to-write-a-new-runtime-with-the-actionloop-proxy>Tutorial - How to write a new runtime with the ActionLoop Proxy</h1><p>This section contains a stepwise tutorial which will take you through
the process of developing a new ActionLoop runtime using the Ruby
language as the example.</p><h2 id=general-development-process>General development process</h2><p>The general procedure for authoring a runtime with the
<code>ActionLoop proxy</code> requires the following steps:</p><ul><li><p>building a docker image containing your target language compiler and
the ActionLoop runtime.</p></li><li><p>writing a simple line-oriented protocol in your target language.</p></li><li><p>writing a compilation script for your target language.</p></li><li><p>writing some mandatory tests for your language.</p></li></ul><h2 id=actionloop-starter-kit>ActionLoop Starter Kit</h2><p>To facilitate the process, there is an <code>actionloop-starter-kit</code> in the
<a href=https://github.com/apache/openwhisk-devtools/tree/master/actionloop-starter-kit>openwhisk-devtools</a>
GitHub repository, that implements a fully working runtime for Python.
It contains a stripped-down version of the real Python runtime (with
some advanced features removed) along with guided, step-by-step
instructions on how to translate it to a different target runtime
language using Ruby as an example.</p><p>In short, the starter kit provides templates you can adapt in creating
an ActionLoop runtime for each of the steps listed above, these include
:</p><p>-checking out the <code>actionloop-starter-kit</code> from the <code>openwhisk-devtools</code>
repository -editing the <code>Dockerfile</code> to create the target environment
for your target language. -converting (rewrite) the <code>launcher.py</code> script
to an equivalent for script for your target language. -editing the
<code>compile</code> script to compile your action in your target language.
-writing the mandatory tests for your target language, by adapting the
<code>ActionLoopPythonBasicTests.scala</code> file.</p><p>As a starting language, we chose Python since it is one of the more
human-readable languages (can be treated as <code>pseudo-code</code>). Do not
worry, you should only need just enough Python knowledge to be able to
rewrite <code>launcher.py</code> and edit the <code>compile</code> script for your target
language.</p><p>Finally, you will need to update the <code>ActionLoopPythonBasicTests.scala</code>
test file which, although written in the Scala language, only serves as
a wrapper that you will use to embed your target language tests into.</p><h2 id=notation>Notation</h2><p>In each step of this tutorial, we typically show snippets of either
terminal transcripts (i.e., commands and results) or “diffs” of changes
to existing code files.</p><p>Within terminal transcript snippets, comments are prefixed with <code>#</code>
character and commands are prefixed by the <code>$</code> character. Lines that
follow commands may include sample output (from their execution) which
can be used to verify against results in your local environment.</p><p>When snippets show changes to existing source files, lines without a
prefix should be left “as is”, lines with <code>-</code> should be removed and
lines with <code>+</code> should be added.</p><h2 id=prerequisites>Prerequisites</h2><ul><li>Docker engine - please have a valid <a href=https://docs.docker.com/install/>docker engine
installed</a> that supports
<a href=https://docs.docker.com/develop/develop-images/multistage-build/>multi-stage
builds</a>
(i.e., Docker 17.05 or higher) and assure the Docker daemon is
running.</li></ul><pre><code># Verify docker version
$ docker --version
Docker version 18.09.3

# Verify docker is running
$ docker ps

# The result should be a valid response listing running processes
</code></pre><h2 id=setup-the-development-directory>Setup the development directory</h2><p>So let’s start to create our own <code>actionloop-demo-ruby-2.6</code> runtime.
First, check out the <code>devtools</code> repository to access the starter kit,
then move it in your home directory to work on it.</p><pre><code>git clone https://github.com/apache/openwhisk-devtools
mv openwhisk-devtools/actionloop-starter-kit ~/actionloop-demo-ruby-v2.6
</code></pre><p>Now, take the directory <code>python3.7</code> and rename it to <code>ruby2.6</code> and use
<code>sed</code> to fix the directory name references in the Gradle build files.</p><pre><code>cd ~/actionloop-demo-ruby-v2.6
mv python3.7 ruby2.6
sed -i.bak -e 's/python3.7/ruby2.6/' settings.gradle
sed -i.bak -e 's/actionloop-demo-python-v3.7/actionloop-demo-ruby-v2.6/' ruby2.6/build.gradle
</code></pre><p>Let’s check everything is fine building the image.</p><pre><code># building the image
$ ./gradlew distDocker
# ... intermediate output omitted ...
BUILD SUCCESSFUL in 1s
2 actionable tasks: 2 executed
# checking the image is available
$ docker images actionloop-demo-ruby-v2.6
REPOSITORY                  TAG                 IMAGE ID            CREATED             SIZE
actionloop-demo-ruby-v2.6   latest              df3e77c9cd8f        2 minutes ago          94.3MB
</code></pre><p>At this point, we have built a new image named
<code>actionloop-demo-ruby-v2.6</code>. However, despite having <code>Ruby</code> in the name,
internally it still is a <code>Python</code> language runtime which we will need to
change to one supporting <code>Ruby</code> as we continue in this tutorial.</p><h2 id=preparing-the-docker-environment>Preparing the Docker environment</h2><p>Our language runtime’s <code>Dockerfile</code> has the task of preparing an
environment for executing OpenWhisk and OpenServerless Actions. Using the
ActionLoop approach, we use a multistage Docker build to</p><ol><li><p>derive our OpenWhisk and OpenServerless language runtime from an existing
Docker image that has all the target language’s tools and libraries
for running functions authored in that language.</p><ul><li>In our case, we will reference the <code>ruby:2.6.2-alpine3.9</code> image
from the <a href=https://hub.docker.com/_/ruby>Official Docker Images for
Ruby</a> on Docker Hub.</li></ul></li><li><p>leverage the existing <code>openwhisk/actionlooop-v2</code> image on Docker Hub
from which we will “extract” the <em>ActionLoop</em> proxy (i.e. copy
<code>/bin/proxy</code> binary) our runtime will use to process Activation
requests from the OpenWhisk and OpenServerless platform and execute
Actions by using the language’s tools and libraries from step #1.</p></li></ol><h2 id=repurpose-the-renamed-python-dockerfile-for-ruby-builds>Repurpose the renamed Python Dockerfile for Ruby builds</h2><p>Let’s edit the <code>ruby2.6/Dockerfile</code> to use the official Ruby image on
Docker Hub as our base image, instead of a Python image, and add our our
Ruby launcher script:</p><pre><code> FROM openwhisk/actionloop-v2:latest as builder
-FROM python:3.7-alpine
+FROM ruby:2.6.2-alpine3.9
 RUN mkdir -p /proxy/bin /proxy/lib /proxy/action
 WORKDIR /proxy
 COPY --from=builder /bin/proxy /bin/proxy
-ADD lib/launcher.py /proxy/lib/launcher.py
+ADD lib/launcher.rb /proxy/lib/launcher.rb
 ADD bin/compile /proxy/bin/compile
+RUN apk update &amp;&amp; apk add python3
 ENV OW_COMPILER=/proxy/bin/compile
 ENTRYPOINT [&quot;/bin/proxy&quot;]
</code></pre><p>Next, let’s rename the <code>launcher.py</code> (a Python script) to one that
indicates it is a Ruby script named <code>launcher.rb</code>.</p><pre><code>mv ruby2.6/lib/launcher.py ruby2.6/lib/launcher.rb
</code></pre><p>Note that:</p><ol><li><p>You changed the base Docker image to use a <code>Ruby</code> language image.</p></li><li><p>You changed the launcher script from <code>Python</code> to <code>Ruby</code>.</p></li><li><p>We had to add a <code>python3</code> package to our Ruby image since our
<code>compile</code> script will be written in Python for this tutorial. Of
course, you may choose to rewrite the <code>compile</code> script in <code>Ruby</code> if
you wish to as your own exercise.</p></li></ol><h2 id=implementing-the-actionloop-protocol>Implementing the ActionLoop protocol</h2><p>This section will take you through how to convert the contents of
<code>launcher.rb</code> (formerly <code>launcher.py</code>) to the target Ruby programming
language and implement the <code>ActionLoop protocol</code>.</p><h3 id=what-the-launcher-needs-to-do>What the launcher needs to do</h3><p>Let’s recap the steps the launcher must accomplish to implement the
<code>ActionLoop protocol</code> :</p><ol><li><p>import the Action function’s <code>main</code> method for execution.</p><ul><li>Note: the <code>compile</code> script will make the function available to
the launcher.</li></ul></li><li><p>open the system’s <code>file descriptor 3</code> which will be used to output
the functions response.</p></li><li><p>read the system’s standard input, <code>stdin</code>, line-by-line. Each line
is parsed as a JSON string and produces a JSON object (not an array
nor a scalar) to be passed as the input <code>arg</code> to the function.</p><ul><li>Note: within the JSON object, the <code>value</code> key contains the user
parameter data to be passed to your functions. All the other
keys are made available as process environment variables to the
function; these need to be uppercased and prefixed with
<code>"__OW_"</code>.</li></ul></li><li><p>invoke the <code>main</code> function with the JSON object payload.</p></li><li><p>encode the result of the function in JSON (ensuring it is only one
line and it is terminated with one newline) and write it to
<code>file descriptor 3</code>.</p></li><li><p>Once the function returns the result, flush the contents of
<code>stdout</code>, <code>stderr</code> and <code>file descriptor 3</code> (FD 3).</p></li><li><p>Finally, include the above steps in a loop so that it continually
looks for Activations. That’s it.</p></li></ol><h3 id=converting-launcher-script-to-ruby>Converting launcher script to Ruby</h3><p>Now, let’s look at the protocol described above, codified within the
launcher script <code>launcher.rb</code>, and work to convert its contents from
Python to Ruby.</p><h4 id=import-the-function-code>Import the function code</h4><p>Skipping the first few library import statements within <code>launcer.rb</code>,
which we will have to resolve later after we determine which ones Ruby
may need, we see the first significant line of code importing the actual
Action function.</p><pre><code># now import the action as process input/output
from main__ import main as main
</code></pre><p>In Ruby, this can be rewritten as:</p><pre><code># requiring user's action code
require &quot;./main__&quot;
</code></pre><p><em>Note that you are free to decide the path and filename for the
function’s source code. In our examples, we chose a base filename that
includes the word <code>"main"</code> (since it is OpenWhisk and OpenServerless
default function name) and append two underscores to better assure
uniqueness.</em></p><h4 id=open-file-descriptor-fd-3-for-function-results-output>Open File Descriptor (FD) 3 for function results output</h4><p>The <code>ActionLoop</code> proxy expects to read the results of invoking the
Action function from File Descriptor (FD) 3.</p><p>The existing Python:</p><pre><code>out = fdopen(3, &quot;wb&quot;)
</code></pre><p>would be rewritten in Ruby as:</p><pre><code>out = IO.new(3)
</code></pre><h4 id=process-actions-arguments-from-stdin>Process Action’s arguments from STDIN</h4><p>Each time the function is invoked via an HTTP request, the <code>ActionLoop</code>
proxy passes the message contents to the launcher via STDIN. The
launcher must read STDIN line-by-line and parse it as JSON.</p><p>The <code>launcher</code>’s existing Python code reads STDIN line-by-line as
follows:</p><pre><code>while True:
  line = stdin.readline()
  if not line: break
  # ...continue...
</code></pre><p>would be translated to Ruby as follows:</p><pre><code>while true
  # JSON arguments get passed via STDIN
  line = STDIN.gets()
  break unless line
  # ...continue...
end
</code></pre><p>Each line is parsed in JSON, where the <code>payload</code> is extracted from
contents of the <code>"value"</code> key. Other keys and their values are as
uppercased, <code>"__OW_"</code> prefixed environment variables:</p><p>The existing Python code for this is:</p><pre><code>  # ... continuing ...
  args = json.loads(line)
  payload = {}
  for key in args:
    if key == &quot;value&quot;:
      payload = args[&quot;value&quot;]
    else:
      os.environ[&quot;__OW_%s&quot; % key.upper()]= args[key]
  # ... continue ...
</code></pre><p>would be translated to Ruby:</p><pre><code>  # ... continuing ...
  args = JSON.parse(line)
  payload = {}
  args.each do |key, value|
    if key == &quot;value&quot;
      payload = value
    else
      # set environment variables for other keys
      ENV[&quot;__OW_#{key.upcase}&quot;] = value
    end
  end
  # ... continue ...
</code></pre><h4 id=invoking-the-action-function>Invoking the Action function</h4><p>We are now at the point of invoking the Action function and producing
its result. <em>Note we <strong>must</strong> also capture exceptions and produce an
<code>{"error": &lt;result> }</code> if anything goes wrong during execution.</em></p><p>The existing Python code for this is:</p><pre><code>  # ... continuing ...
  res = {}
  try:
    res = main(payload)
  except Exception as ex:
    print(traceback.format_exc(), file=stderr)
    res = {&quot;error&quot;: str(ex)}
  # ... continue ...
</code></pre><p>would be translated to Ruby:</p><pre><code>  # ... continuing ...
  res = {}
  begin
    res = main(payload)
  rescue Exception =&gt; e
    puts &quot;exception: #{e}&quot;
    res [&quot;error&quot;] = &quot;#{e}&quot;
  end
  # ... continue ...
</code></pre><h4 id=finalize-file-descriptor-fd-3-stdout-and-stderr>Finalize File Descriptor (FD) 3, STDOUT and STDERR</h4><p>Finally, we need to write the function’s result to File Descriptor (FD)
3 and “flush” standard out (stdout), standard error (stderr) and FD 3.</p><p>The existing Python code for this is:</p><pre><code>  out.write(json.dumps(res, ensure_ascii=False).encode('utf-8'))
  out.write(b'\n')
  stdout.flush()
  stderr.flush()
  out.flush()
</code></pre><p>would be translated to Ruby:</p><pre><code>  STDOUT.flush()
  STDERR.flush()
  out.puts(res.to_json)
  out.flush()
</code></pre><p>Congratulations! You just completed your <code>ActionLoop</code> request handler.</p><h2 id=writing-the-compilation-script>Writing the compilation script</h2><p>Now, we need to write the <code>compilation script</code>. It is basically a script
that will prepare the uploaded sources for execution, adding the
<code>launcher</code> code and generate the final executable.</p><p>For interpreted languages, the compilation script will only “prepare”
the sources for execution. The executable is simply a shell script to
invoke the interpreter.</p><p>For compiled languages, like Go it will actually invoke a compiler in
order to produce the final executable. There are also cases like Java
where we still need to execute the compilation step that produces
intermediate code, but the executable is just a shell script that will
launch the Java runtime.</p><h3 id=how-the-actionloop-proxy-handles-action-uploads>How the ActionLoop proxy handles action uploads</h3><p>The OpenWhisk and OpenServerless user can upload actions with the <code>ops</code>
Command Line Interface (CLI) tool as a single file.</p><p>This single file can be:</p><ul><li><p>a source file</p></li><li><p>an executable file</p></li><li><p>a ZIP file containing sources</p></li><li><p>a ZIP file containing an executable and other support files</p></li></ul><p><em>Important</em>: an executable for ActionLoop is either a Linux binary (an
ELF executable) or a script. A script is, using Linux conventions, is
anything starting with <code>#!</code>. The first line is interpreted as the
command to use to launch the script: <code>#!/bin/bash</code>, <code>#!/usr/bin/python</code>
etc.</p><p>The ActionLoop proxy accepts any file, prepares a work folder, with two
folders in it named <code>"src"</code> and <code>"bin"</code>. Then it detects the format of
the uploaded file. For each case, the behavior is different.</p><ul><li><p>If the uploaded file is an executable, it is stored as <code>bin/exec</code>
and executed.</p></li><li><p>If the uploaded file is not an executable and not a zip file, it is
stored as <code>src/exec</code> then the compilation script is invoked.</p></li><li><p>If the uploaded file is a zip file, it is unzipped in the <code>src</code>
folder, then the <code>src/exec</code> file is checked.</p></li><li><p>If it exists and it is an executable, the folder <code>src</code> is renamed to
<code>bin</code> and then again the <code>bin/exec</code> is executed.</p></li><li><p>If the <code>src/exec</code> is missing or is not an executable, then the
compiler script is invoked.</p></li></ul><h3 id=compiling-an-action-in-source-format>Compiling an action in source format</h3><p>The compilation script is invoked only when the upload contains sources.
According to the description in the past paragraph, if the upload is a
single file, we can expect the file is in <code>src/exec</code>, without any
prefix. Otherwise, sources are spread the <code>src</code> folder and it is the
task of the compiler script to find the sources. A runtime may impose
that when a zip file is uploaded, then there should be a fixed file with
the main function. For example, the Python runtime expects the file
<code>__main__.py</code>. However, it is not a rule: the Go runtime does not
require any specific file as it compiles everything. It only requires a
function with the name specified.</p><p>The compiler script goal is ultimately to leave in <code>bin/exec</code> an
executable (implementing the ActionLoop protocol) that the proxy can
launch. Also, if the executable is not standalone, other files must be
stored in this folder, since the proxy can also zip all of them and send
to the user when using the pre-compilation feature.</p><p>The compilation script is a script pointed by the <code>OW_COMPILER</code>
environment variable (you may have noticed it in the Dockerfile) that
will be invoked with 3 parameters:</p><ol><li><p><code>&lt;main></code> is the name of the main function specified by the user on
the <code>ops</code> command line</p></li><li><p><code>&lt;src></code> is the absolute directory with the sources already unzipped</p></li><li><p>an empty <code>&lt;bin></code> directory where we are expected to place our final
executables</p></li></ol><p>Note that both the <code>&lt;src></code> and <code>&lt;bin></code> are disposable, so we can do
things like removing the <code>&lt;bin></code> folder and rename the <code>&lt;src></code>.</p><p>Since the user generally only sends a function specified by the <code>&lt;main></code>
parameter, we have to add the launcher we wrote and adapt it to execute
the function.</p><h3 id=implementing-the-compile-for-ruby>Implementing the <code>compile</code> for Ruby</h3><p>This is the algorithm that the <code>compile</code> script in the kit follows for
Python:</p><ol><li><p>if there is a <code>&lt;src>/exec</code> it must rename to the main file; I use
the name <code>main__.py</code></p></li><li><p>if there is a <code>&lt;src>/__main__.py</code> it will rename to the main file
<code>main__.py</code></p></li><li><p>copy the <code>launcher.py</code> to <code>exec__.py</code>, replacing the <code>main(arg)</code>
with <code>&lt;main>(arg)</code>; this file imports the <code>main__.py</code> and invokes
the function <code>&lt;main></code></p></li><li><p>add a launcher script <code>&lt;src>/exec</code></p></li><li><p>finally it removes the <code>&lt;bin></code> folder and rename <code>&lt;src></code> to <code>&lt;bin></code></p></li></ol><p>We can adapt this algorithm easily to Ruby with just a few changes.</p><p>The script defines the functions <code>sources</code> and <code>build</code> then starts the
execution, at the end of the script.</p><p>Start from the end of the script, where the script collect parameters
from the command line. Instead of <code>launcher.py</code>, use <code>launcher.rb</code>:</p><pre><code>- launcher = &quot;%s/lib/launcher.py&quot; % dirname(dirname(sys.argv[0]))
+ launcher = &quot;%s/lib/launcher.rb&quot; % dirname(dirname(sys.argv[0]))
</code></pre><p>Then the script invokes the <code>source</code> function. This function renames the
<code>exec</code> file to <code>main__.py</code>, you will rename it instead to <code>main__.rb</code>:</p><pre><code>- copy_replace(src_file, &quot;%s/main__.py&quot; % src_dir)
+ copy_replace(src_file, &quot;%s/main__.rb&quot; % src_dir)
</code></pre><p>If instead there is a <code>__main__.py</code> the function will rename to
<code>main__.py</code> (the launcher invokes this file always). The Ruby runtime
will use a <code>main.rb</code> as starting point. So the next change is:</p><pre><code>- # move __main__ in the right place if it exists
- src_file = &quot;%s/__main__.py&quot; % src_dir
+ # move main.rb in the right place if it exists
+ src_file = &quot;%s/main.rb&quot; % src_dir
</code></pre><p>Now, the <code>source</code> function copies the launcher as <code>exec__.py</code>, replacing
the line <code>from main__ import main as main</code> (invoking the main function)
with <code>from main__ import &lt;main> as main</code>. In Ruby you may want to
replace the line <code>res = main(payload)</code> with <code>res = &lt;main>(payload)</code>. In
code it is:</p><pre><code>- copy_replace(launcher, &quot;%s/exec__.py&quot; % src_dir,
-   &quot;from main__ import main as main&quot;,
-    &quot;from main__ import %s as main&quot; % main )
+ copy_replace(launcher, &quot;%s/exec__.rb&quot; % src_dir,
+    &quot;res = main(payload)&quot;,
+     &quot;res = %s(payload)&quot; % main )
</code></pre><p>We are almost done. We just need the startup script that instead of
invoking python will invoke Ruby. So in the <code>build</code> function do this
change:</p><pre><code> write_file(&quot;%s/exec&quot; % tgt_dir, &quot;&quot;&quot;#!/bin/sh
 cd &quot;$(dirname $0)&quot;
-exec /usr/local/bin/python exec__.py
+exec ruby exec__.rb
 &quot;&quot;&quot;)
</code></pre><p>For an interpreted language that is all. We move the <code>src</code> folder in the
<code>bin</code>. For a compiled language instead, we may want to actually invoke
the compiler to produce the executable.</p><h2 id=debugging>Debugging</h2><p>Now that we have completed both the <code>launcher</code> and <code>compile</code> scripts, it
is time to test them.</p><p>Here we will learn how to:</p><ol><li><p>enter in a test environment</p></li><li><p>simple smoke tests to check things work</p></li><li><p>writing the validation tests</p></li><li><p>testing the image in an actual OpenWhisk and OpenServerless environment</p></li></ol><h3 id=entering-in-the-test-environment>Entering in the test environment</h3><p>In the starter kit, there is a <code>Makefile</code> that can help with our
development efforts.</p><p>We can build the Dockerfile using the provided Makefile. Since it has a
reference to the image we are building, let’s change it:</p><pre><code>sed -i.bak -e 's/actionloop-demo-python-v3.7/actionloop-demo-ruby-v2.6/' ruby2.6/Makefile
</code></pre><p>We should be now able to build the image and enter in it with
<code>make debug</code>. It will rebuild the image for us and put us into a shell
so we can enter access the image environment for testing and debugging:</p><pre><code>$ cd ruby2.6
$ make debug
# results omitted for brevity ...
</code></pre><p>Let’s start with a couple of notes about this test environment.</p><p>First, use <code>--entrypoint=/bin/sh</code> when starting the image to have a
shell available at our image entrypoint. Generally, this is true by
default; however, in some stripped down base images a shell may not be
available.</p><p>Second, the <code>/proxy</code> folder is mounted in our local directory, so that
we can edit the <code>bin/compile</code> and the <code>lib/launcher.rb</code> using our editor
outside the Docker image</p><p><em>NOTE</em> It is not necessary to rebuild the Docker image with every change
when using <code>make debug</code> since directories and environment variables used
by the proxy indicate where the code outside the Docker container is
located.</p><p>Once at the shell prompt that we will use for development, we will have
to start and stop the proxy. The shell will help us to inspect what
happened inside the container.</p><h3 id=a-simple-smoke-test>A simple smoke test</h3><p>It is time to test. Let’s write a very simple test first, converting the
<code>example\hello.py</code> in <code>example\hello.rb</code> to appear as follows:</p><pre><code>def hello(args)
  name = args[&quot;name&quot;] || &quot;stranger&quot;
  greeting = &quot;Hello #{name}!&quot;
  puts greeting
  { &quot;greeting&quot; =&gt; greeting }
end
</code></pre><p>Now change into the <code>ruby2.6</code> subdirectory of our runtime project and in
one terminal type:</p><pre><code>$ cd &lt;projectdir&gt;/ruby2.6
$ make debug
# results omitted for brevity ...
# (you should see a shell prompt of your image)
$ /bin/proxy -debug
2019/04/08 07:47:36 OpenWhisk and OpenServerless ActionLoop Proxy 2: starting
</code></pre><p>Now the runtime is started in debug mode, listening on port 8080, and
ready to accept Action deployments.</p><p>Open another terminal (while leaving the first one running the proxy)
and go <em>into the top-level directory of our project</em> to test the Action
by executing an <code>init</code> and then a couple of <code>run</code> requests using the
<code>tools/invoke.py</code> test script.</p><p>These steps should look something like this in the second terminal:</p><pre><code>$ cd &lt;projectdir&gt;
$ python tools/invoke.py init hello example/hello.rb
{&quot;ok&quot;:true}
$ python tools/invoke.py run '{}'
{&quot;greeting&quot;:&quot;Hello stranger!&quot;}
$ python tools/invoke.py run  '{&quot;name&quot;:&quot;Mike&quot;}'
{&quot;greeting&quot;:&quot;Hello Mike!&quot;}
</code></pre><p>We should also see debug output from the first terminal running the
proxy (with the <code>debug</code> flag) which should have successfully processed
the <code>init</code> and <code>run</code> requests above.</p><p>The proxy’s debug output should appear something like:</p><pre><code>/proxy # /bin/proxy -debug
2019/04/08 07:54:57 OpenWhisk and OpenServerless ActionLoop Proxy 2: starting
2019/04/08 07:58:00 compiler: /proxy/bin/compile
2019/04/08 07:58:00 it is source code
2019/04/08 07:58:00 compiling: ./action/16/src/exec main: hello
2019/04/08 07:58:00 compiling: /proxy/bin/compile hello action/16/src action/16/bin
2019/04/08 07:58:00 compiler out: , &lt;nil&gt;
2019/04/08 07:58:00 env: [__OW_API_HOST=]
2019/04/08 07:58:00 starting ./action/16/bin/exec
2019/04/08 07:58:00 Start:
2019/04/08 07:58:00 pid: 13
2019/04/08 07:58:24 done reading 13 bytes
Hello stranger!
XXX_THE_END_OF_A_WHISK_ACTIVATION_XXX
XXX_THE_END_OF_A_WHISK_ACTIVATION_XXX
2019/04/08 07:58:24 received::{&quot;greeting&quot;:&quot;Hello stranger!&quot;}
2019/04/08 07:58:54 done reading 27 bytes
Hello Mike!
XXX_THE_END_OF_A_WHISK_ACTIVATION_XXX
XXX_THE_END_OF_A_WHISK_ACTIVATION_XXX
2019/04/08 07:58:54 received::{&quot;greeting&quot;:&quot;Hello Mike!&quot;}
</code></pre><h3 id=hints-and-tips-for-debugging>Hints and tips for debugging</h3><p>Of course, it is very possible something went wrong. Here a few
debugging suggestions:</p><p>The ActionLoop runtime (proxy) can only be initialized once using the
<code>init</code> command from the <code>invoke.py</code> script. If we need to re-initialize
the runtime, we need to stop the runtime (i.e., with Control-C) and
restart it.</p><p>We can also check what is in the action folder. The proxy creates a
numbered folder under <code>action</code> and then a <code>src</code> and <code>bin</code> folder.</p><p>For example, using a terminal window, we would would see a directory and
file structure created by a single action:</p><pre><code>$ find
action/
action/1
action/1/bin
action/1/bin/exec__.rb
action/1/bin/exec
action/1/bin/main__.rb
</code></pre><p>Note that the <code>exec</code> starter, <code>exec__.rb</code> launcher and <code>main__.rb</code>
action code are have all been copied under a directory numbered`1`.</p><p>In addition, we can try to run the action directly and see if it behaves
properly:</p><pre><code>$ cd action/1/bin
$ ./exec 3&gt;&amp;1
$ {&quot;value&quot;:{&quot;name&quot;:&quot;Mike&quot;}}
Hello Mike!
{&quot;greeting&quot;:&quot;Hello Mike!&quot;}
</code></pre><p>Note we redirected the file descriptor 3 in stdout to check what is
happening, and note that logs appear in stdout too.</p><p>Also, we can test the compiler invoking it directly.</p><p>First let’s prepare the environment as it appears when we just uploaded
the action:</p><pre><code>$ cd /proxy
$ mkdir -p action/2/src action/2/bin
$ cp action/1/bin/main__.rb action/2/src/exec
$ find action/2
action/2
action/2/bin
action/2/src
action/2/src/exec
</code></pre><p>Now compile and examine the results again:</p><pre><code>$ /proxy/bin/compile main action/2/src action/2/bin
$ find action/2
action/2/
action/2/bin
action/2/bin/exec__.rb
action/2/bin/exec
action/2/bin/main__.rb
</code></pre><h2 id=testing>Testing</h2><p>If we have reached this point in the tutorial, the runtime is able to
run and execute a simple test action. Now we need to validate the
runtime against a set of mandatory tests both locally and within an
OpenWhisk and OpenServerless staging environment. Additionally, we should
author and automate additional tests for language specific features and
styles.</p><p>The <code>starter kit</code> includes two handy <code>makefiles</code> that we can leverage
for some additional tests. In the next sections, we will show how to
update them for testing our Ruby runtime.</p><h3 id=testing-multi-file-actions>Testing multi-file Actions</h3><p>So far we tested a only an Action comprised of a single file. We should
also test multi-file Actions (i.e., those with relative imports) sent to
the runtime in both source and binary formats.</p><p>First, let’s try a multi-file Action by creating a Ruby Action script
named <code>example/main.rb</code> that invokes our <code>hello.rb</code> as follows:</p><pre><code>require &quot;./hello&quot;
def main(args)
    hello(args)
end
</code></pre><p>Within the <code>example/Makefile</code> makefile:</p><ul><li><p>update the name of the image to <code>ruby-v2.6"</code> as well as the name of
the <code>main</code> action.</p></li><li><p>update the PREFIX with your DockerHub username.</p></li></ul><pre><code>-IMG=actionloop-demo-python-v3.7:latest
-ACT=hello-demo-python
-PREFIX=docker.io/openwhisk
+IMG=actionloop-demo-ruby-v2.6:latest
+ACT=hello-demo-ruby
+PREFIX=docker.io/&lt;docker username&gt;
</code></pre><p>Now, we are ready to test the various cases. Again, start the runtime
proxy in debug mode:</p><pre><code>cd ruby2.6
make debug
/bin/proxy -debug
</code></pre><p>On another terminal, try to deploy a single file:</p><pre><code>$ make test-single
python ../tools/invoke.py init hello ../example/hello.rb
{&quot;ok&quot;:true}
python ../tools/invoke.py run '{}'
{&quot;greeting&quot;:&quot;Hello stranger!&quot;}
python ../tools/invoke.py run '{&quot;name&quot;:&quot;Mike&quot;}'
{&quot;greeting&quot;:&quot;Hello Mike!&quot;}
</code></pre><p>Now, <em>stop and restart the proxy</em> and try to send a ZIP file with the
sources:</p><pre><code>$ make test-src-zip
zip src.zip main.rb hello.rb
  adding: main.rb (deflated 42%)
  adding: hello.rb (deflated 42%)
python ../tools/invoke.py init ../example/src.zip
{&quot;ok&quot;:true}
python ../tools/invoke.py run '{}'
{&quot;greeting&quot;:&quot;Hello stranger!&quot;}
python ../tools/invoke.py run '{&quot;name&quot;:&quot;Mike&quot;}'
{&quot;greeting&quot;:&quot;Hello Mike!&quot;}
</code></pre><p>Finally, test the pre-compilation: the runtime builds a zip file with
the sources ready to be deployed. Again, <em>stop and restart the proxy</em>
then:</p><pre><code>$ make test-bin-zip
docker run -i actionloop-demo-ruby-v2.6:latest -compile main &lt;src.zip &gt;bin.zip
python ../tools/invoke.py init ../example/bin.zip
{&quot;ok&quot;:true}

python ../tools/invoke.py run '{}'
{&quot;greeting&quot;:&quot;Hello stranger!&quot;}

python ../tools/invoke.py run '{&quot;name&quot;:&quot;Mike&quot;}'
{&quot;greeting&quot;:&quot;Hello Mike!&quot;}
</code></pre><p>Congratulations! The runtime works locally! Time to test it on the
public cloud. So as the last step before moving forward, let’s push the
image to Docker Hub with <code>make push</code>.</p><h3 id=testing-on-openwhisk-and-openserverless>Testing on OpenWhisk and OpenServerless</h3><p>To run this test you need to configure access to OpenWhisk and OpenServerless
with <code>ops</code>. A simple way is to get access is to register a free account
in the IBM Cloud but this works also with our own deployment of
OpenWhisk and OpenServerless.</p><p>Edit the Makefile as we did previously:</p><pre><code>IMG=actionloop-demo-ruby-v2.6:latest
ACT=hello-demo-ruby
PREFIX=docker.io/&lt;docker username&gt;
</code></pre><p>Also, change any reference to <code>hello.py</code> and <code>main.py</code> to <code>hello.rb</code> and
<code>main.rb</code>.</p><p>Once this is done, we can re-run the tests we executed locally on “the
real thing”.</p><p>Test single:</p><pre><code>$ make test-single
ops action update hello-demo-ruby hello.rb --docker docker.io/linus/actionloop-demo-ruby-v2.6:latest --main hello
ok: updated action hello-demo-ruby
ops action invoke hello-demo-ruby -r
{
    &quot;greeting&quot;: &quot;Hello stranger!&quot;
}
ops action invoke hello-demo-ruby -p name Mike -r
{
    &quot;greeting&quot;: &quot;Hello Mike!&quot;
}
</code></pre><p>Test source zip:</p><pre><code>$ make test-src-zip
zip src.zip main.rb hello.rb
  adding: main.rb (deflated 42%)
  adding: hello.rb (deflated 42%)
ops action update hello-demo-ruby src.zip --docker docker.io/linus/actionloop-demo-ruby-v2.6:latest
ok: updated action hello-demo-ruby
ops action invoke hello-demo-ruby -r
{
    &quot;greeting&quot;: &quot;Hello stranger!&quot;
}
ops action invoke hello-demo-ruby -p name Mike -r
{
    &quot;greeting&quot;: &quot;Hello Mike!&quot;
}
</code></pre><p>Test binary ZIP:</p><pre><code>$ make test-bin-zip
docker run -i actionloop-demo-ruby-v2.6:latest -compile main &lt;src.zip &gt;bin.zip
ops action update hello-demo-ruby bin.zip --docker docker.io/actionloop/actionloop-demo-ruby-v2.6:latest
ok: updated action hello-demo-ruby
ops action invoke hello-demo-ruby -r
{
    &quot;greeting&quot;: &quot;Hello stranger!&quot;
}
ops action invoke hello-demo-ruby -p name Mike -r
{
    &quot;greeting&quot;: &quot;Hello Mike!&quot;
}
</code></pre><p>Congratulations! Your runtime works also in the real world.</p><h3 id=writing-the-validation-tests>Writing the validation tests</h3><p>Before you can submit your runtime you should ensure your runtime pass
the validation tests.</p><p>Under
<code>tests/src/test/scala/runtime/actionContainers/ActionLoopPythonBasicTests.scala</code>
there is the template for the test.</p><p>Rename to
<code>tests/src/test/scala/runtime/actionContainers/ActionLoopRubyBasicTests.scala</code>,
change internally the class name to <code>class ActionLoopRubyBasicTests</code> and
implement the following test cases:</p><ul><li><p><code>testNotReturningJson</code></p></li><li><p><code>testUnicode</code></p></li><li><p><code>testEnv</code></p></li><li><p><code>testInitCannotBeCalledMoreThanOnce</code></p></li><li><p><code>testEntryPointOtherThanMain</code></p></li><li><p><code>testLargeInput</code></p></li></ul><p>You should convert Python code to Ruby code. We do not do go into the
details of each test, as they are pretty simple and obvious. You can
check the source code for the real test
<a href=https://github.com/apache/openwhisk-runtime-ruby/blob/master/tests/src/test/scala/actionContainers/Ruby26ActionLoopContainerTests.scala>here</a>.</p><p>You can verify tests are running properly with:</p><pre><code>$ ./gradlew test

Starting a Gradle Daemon, 1 busy Daemon could not be reused, use --status for details

&gt; Task :tests:test

runtime.actionContainers.ActionLoopPythoRubyTests &gt; runtime proxy should handle initialization with no code PASSED

runtime.actionContainers.ActionLoopPythoRubyTests &gt; runtime proxy should handle initialization with no content PASSED

runtime.actionContainers.ActionLoopPythoRubyTests &gt; runtime proxy should run and report an error for function not returning a json object PASSED

runtime.actionContainers.ActionLoopPythoRubyTests &gt; runtime proxy should fail to initialize a second time PASSED

runtime.actionContainers.ActionLoopPythoRubyTests &gt; runtime proxy should invoke non-standard entry point PASSED

runtime.actionContainers.ActionLoopPythoRubyTests &gt; runtime proxy should echo arguments and print message to stdout/stderr PASSED

runtime.actionContainers.ActionLoopPythoRubyTests &gt; runtime proxy should handle unicode in source, input params, logs, and result PASSED

runtime.actionContainers.ActionLoopPythoRubyTests &gt; runtime proxy should confirm expected environment variables PASSED

runtime.actionContainers.ActionLoopPythoRubyTests &gt; runtime proxy should echo a large input PASSED

BUILD SUCCESSFUL in 55s
</code></pre><p>Big congratulations are in order having reached this point successfully.
At this point, our runtime should be ready to run on any OpenWhisk and
OpenServerless platform and also can be submitted for consideration to be
included in the Apache OpenWhisk and OpenServerless project.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-aa85069ab6f58eef613cc4e73ddbe0c1>3.1.3 - Naming And Limits</h1><h1 id=system-details>System details</h1><p>The following sections provide more details about the OpenWhisk and
OpenServerless system.</p><h2 id=entities>Entities</h2><h3 id=namespaces-and-packages>Namespaces and packages</h3><p>OpenWhisk and OpenServerless actions, triggers, and rules belong in a
namespace, and optionally a package.</p><p>Packages can contain actions and feeds. A package cannot contain another
package, so package nesting is not allowed. Also, entities do not have
to be contained in a package.</p><p>In OpenServerless a namespace corresponds to an user. You can create users
with the <a href=/docs/reference/references/naming-limits/#cli:admin.adoc>admin subcommand</a> of the CLI.</p><p>The fully qualified name of an entity is
<code>/namespaceName[/packageName]/entityName</code>. Notice that <code>/</code> is used to
delimit namespaces, packages, and entities.</p><p>If the fully qualified name has three parts:
<code>/namespaceName/packageName/entityName</code>, then the namespace can be
entered without a prefixed <code>/</code>; otherwise, namespaces must be prefixed
with a <code>/</code>.</p><p>For convenience, the namespace can be left off if it is the user’s
<em>default namespace</em>.</p><p>For example, consider a user whose default namespace is <code>/myOrg</code>.
Following are examples of the fully qualified names of a number of
entities and their aliases.</p><table><col style=width:20%><col style=width:20%><col style=width:20%><col style=width:20%><col style=width:20%><thead><tr class=header><th style=text-align:left>Fully qualified name</th><th style=text-align:left>Alias</th><th style=text-align:left>Namespace</th><th style=text-align:left>Package</th><th style=text-align:left>Name</th></tr></thead><tbody><tr class=odd><td style=text-align:left><p><code>/whisk.system/cloudant/read</code></p></td><td style=text-align:left></td><td style=text-align:left><p><code>/whisk.system</code></p></td><td style=text-align:left><p><code>cloudant</code></p></td><td style=text-align:left><p><code>read</code></p></td></tr><tr class=even><td style=text-align:left><p><code>/myOrg/video/transcode</code></p></td><td style=text-align:left><p><code>video/transcode</code></p></td><td style=text-align:left><p><code>/myOrg</code></p></td><td style=text-align:left><p><code>video</code></p></td><td style=text-align:left><p><code>transcode</code></p></td></tr><tr class=odd><td style=text-align:left><p><code>/myOrg/filter</code></p></td><td style=text-align:left><p><code>filter</code></p></td><td style=text-align:left><p><code>/myOrg</code></p></td><td style=text-align:left></td><td style=text-align:left><p><code>filter</code></p></td></tr></tbody></table><p>You will be using this naming scheme when you use the OpenWhisk and
OpenServerless CLI, among other places.</p><h3 id=entity-names>Entity names</h3><p>The names of all entities, including actions, triggers, rules, packages,
and namespaces, are a sequence of characters that follow the following
format:</p><ul><li><p>The first character must be an alphanumeric character, or an
underscore.</p></li><li><p>The subsequent characters can be alphanumeric, spaces, or any of the
following: <code>_</code>, <code>@</code>, <code>.</code>, <code>-</code>.</p></li><li><p>The last character can’t be a space.</p></li></ul><p>More precisely, a name must match the following regular expression
(expressed with Java metacharacter syntax):
<code>\A([\w]|[\w][\w@ .-]*[\w@.-]+)\z</code>.</p><h2 id=system-limits>System limits</h2><h3 id=actions>Actions</h3><p>OpenWhisk and OpenServerless has a few system limits, including how much
memory an action can use and how many action invocations are allowed per
minute.</p><p><strong>Note:</strong> On Openwhisk 2.0 with the scheduler service, <strong>concurrent</strong> in
the table below really means the max containers that can be provisioned
at once for a namespace. The api <em>may</em> be able to accept more
activations than this number at once depending on a number of factors.</p><p>The following table lists the default limits for actions.</p><table style=width:99%><col style=width:5%><col style=width:74%><col style=width:9%><col style=width:3%><col style=width:4%><thead><tr class=header><th style=text-align:left>limit</th><th style=text-align:left>description</th><th style=text-align:left>configurable</th><th style=text-align:left>unit</th><th style=text-align:left>default</th></tr></thead><tbody><tr class=odd><td style=text-align:left><p>timeout</p></td><td style=text-align:left><p>a container is not allowed to run
longer than N milliseconds</p></td><td style=text-align:left><p>per action</p></td><td style=text-align:left><p>milliseconds</p></td><td style=text-align:left><p>60000</p></td></tr><tr class=even><td style=text-align:left><p>memory</p></td><td style=text-align:left><p>a container is not allowed to allocate
more than N MB of memory</p></td><td style=text-align:left><p>per action</p></td><td style=text-align:left><p>MB</p></td><td style=text-align:left><p>256</p></td></tr><tr class=odd><td style=text-align:left><p>logs</p></td><td style=text-align:left><p>a container is not allowed to write
more than N MB to stdout</p></td><td style=text-align:left><p>per action</p></td><td style=text-align:left><p>MB</p></td><td style=text-align:left><p>10</p></td></tr><tr class=even><td style=text-align:left><p>instances</p></td><td style=text-align:left><p>an action is not allowed to have more
containers than this value (<strong>new scheduler
only</strong>)</p></td><td style=text-align:left><p>per action</p></td><td style=text-align:left><p>number</p></td><td style=text-align:left><p>namespace concurrency limit</p></td></tr><tr class=odd><td style=text-align:left><p>concurrent</p></td><td style=text-align:left><p>no more than N activations may be
submitted per namespace either executing or queued for
execution</p></td><td style=text-align:left><p>per namespace</p></td><td style=text-align:left><p>number</p></td><td style=text-align:left><p>100</p></td></tr><tr class=even><td style=text-align:left><p>minuteRate</p></td><td style=text-align:left><p>no more than N activations may be
submitted per namespace per minute</p></td><td style=text-align:left><p>per namespace</p></td><td style=text-align:left><p>number</p></td><td style=text-align:left><p>120</p></td></tr><tr class=odd><td style=text-align:left><p>codeSize</p></td><td style=text-align:left><p>the maximum size of the action
code</p></td><td style=text-align:left><p>configurable, limit per action</p></td><td style=text-align:left><p>MB</p></td><td style=text-align:left><p>48</p></td></tr><tr class=even><td style=text-align:left><p>parameters</p></td><td style=text-align:left><p>the maximum size of the parameters that
can be attached</p></td><td style=text-align:left><p>not configurable, limit per
action/package/trigger</p></td><td style=text-align:left><p>MB</p></td><td style=text-align:left><p>1</p></td></tr><tr class=odd><td style=text-align:left><p>result</p></td><td style=text-align:left><p>the maximum size of the action
result</p></td><td style=text-align:left><p>not configurable, limit per
action</p></td><td style=text-align:left><p>MB</p></td><td style=text-align:left><p>1</p></td></tr></tbody></table><h3 id=per-action-timeout-ms-default-60s>Per action timeout (ms) (Default: 60s)</h3><ul><li><p>The timeout limit N is in the range [100ms..300000ms] and is set
per action in milliseconds.</p></li><li><p>A user can change the limit when creating the action.</p></li><li><p>A container that runs longer than N milliseconds is terminated.</p></li></ul><h3 id=per-action-memory-mb-default-256mb>Per action memory (MB) (Default: 256MB)</h3><ul><li><p>The memory limit M is in the range from [128MB..512MB] and is set
per action in MB.</p></li><li><p>A user can change the limit when creating the action.</p></li><li><p>A container cannot have more memory allocated than the limit.</p></li></ul><h3 id=per-action-max-instance-concurrency-default-namespace-limit-for-concurrent-invocations-only-applicable-using-new-scheduler>Per action max instance concurrency (Default: namespace limit for concurrent invocations) <strong>Only applicable using new scheduler</strong></h3><ul><li><p>The max containers that will be created for an action before
throttling in the range from [1..concurrentInvocations limit for
namespace]</p></li><li><p>By default the max allowed containers / server instances for an
action is equal to the namespace limit.</p></li><li><p>A user can change the limit when creating the action.</p></li><li><p>Defining a lower limit than the namespace limit means your max
container concurrency will be the action defined limit.</p></li><li><p>If using actionConcurrency > 1 such that your action can handle
multiple requests per instance, your true concurrency limit is
actionContainerConcurrency * actionConcurrency.</p></li><li><p>The actions within a namespaces containerConcurrency total do not
have to add up to the namespace limit though you can configure it
that way to guarantee an action will get exactly the action
container concurrency.</p></li><li><p>For example with a namespace limit of 30 with 2 actions each with a
container limit of 20; if the first action is using 20, there will
still be space for 10 for the other.</p></li></ul><h3 id=per-action-logs-mb-default-10mb>Per action logs (MB) (Default: 10MB)</h3><ul><li><p>The log limit N is in the range [0MB..10MB] and is set per action.</p></li><li><p>A user can change the limit when creating or updating the action.</p></li><li><p>Logs that exceed the set limit are truncated and a warning is added
as the last output of the activation to indicate that the activation
exceeded the set log limit.</p></li></ul><h3 id=per-action-artifact-mb-default-48mb>Per action artifact (MB) (Default: 48MB)</h3><ul><li><p>The maximum code size for the action is 48MB.</p></li><li><p>It is recommended for a JavaScript action to use a tool to
concatenate all source code including dependencies into a single
bundled file.</p></li></ul><h3 id=per-activation-payload-size-mb-fixed-1mb>Per activation payload size (MB) (Fixed: 1MB)</h3><ul><li>The maximum POST content size plus any curried parameters for an
action invocation or trigger firing is 1MB.</li></ul><h3 id=per-activation-result-size-mb-fixed-1mb>Per activation result size (MB) (Fixed: 1MB)</h3><ul><li>The maximum size of a result returned from an action is 1MB.</li></ul><h3 id=per-namespace-concurrent-invocation-default-100>Per namespace concurrent invocation (Default: 100)</h3><ul><li><p>The number of activations that are either executing or queued for
execution for a namespace cannot exceed 100.</p></li><li><p>A user is currently not able to change the limits.</p></li></ul><h3 id=invocations-per-minute-fixed-120>Invocations per minute (Fixed: 120)</h3><ul><li><p>The rate limit N is set to 120 and limits the number of action
invocations in one minute windows.</p></li><li><p>A user cannot change this limit when creating the action.</p></li><li><p>A CLI or API call that exceeds this limit receives an error code
corresponding to HTTP status code <code>429: TOO MANY REQUESTS</code>.</p></li></ul><h3 id=size-of-the-parameters-fixed-1mb>Size of the parameters (Fixed: 1MB)</h3><ul><li><p>The size limit for the parameters on creating or updating of an
action/package/trigger is 1MB.</p></li><li><p>The limit cannot be changed by the user.</p></li><li><p>An entity with too big parameters will be rejected on trying to
create or update it.</p></li></ul><h3 id=per-docker-action-open-files-ulimit-fixed-10241024>Per Docker action open files ulimit (Fixed: 1024:1024)</h3><ul><li><p>The maximum number of open files is 1024 (for both hard and soft
limits).</p></li><li><p>The docker run command use the argument <code>--ulimit nofile=1024:1024</code>.</p></li><li><p>For more information about the ulimit for open files see the <a href=https://docs.docker.com/engine/reference/commandline/run>docker
run</a>
documentation.</p></li></ul><h3 id=per-docker-action-processes-ulimit-fixed-1024>Per Docker action processes ulimit (Fixed: 1024)</h3><ul><li><p>The maximum number of processes available to the action container is
1024.</p></li><li><p>The docker run command use the argument <code>--pids-limit 1024</code>.</p></li><li><p>For more information about the ulimit for maximum number of
processes see the <a href=https://docs.docker.com/engine/reference/commandline/run>docker
run</a>
documentation.</p></li></ul><h3 id=triggers>Triggers</h3><p>Triggers are subject to a firing rate per minute as documented in the
table below.</p><table><col style=width:14%><col style=width:26%><col style=width:30%><col style=width:11%><col style=width:16%><thead><tr class=header><th style=text-align:left>limit</th><th style=text-align:left>description</th><th style=text-align:left>configurable</th><th style=text-align:left>unit</th><th style=text-align:left>default</th></tr></thead><tbody><tr class=odd><td style=text-align:left><p>minuteRate</p></td><td style=text-align:left><p>no more than N triggers may be fired
per namespace per minute</p></td><td style=text-align:left><p>per user</p></td><td style=text-align:left><p>number</p></td><td style=text-align:left><p>60</p></td></tr></tbody></table><h3 id=triggers-per-minute-fixed-60>Triggers per minute (Fixed: 60)</h3><ul><li><p>The rate limit N is set to 60 and limits the number of triggers that
may be fired in one minute windows.</p></li><li><p>A user cannot change this limit when creating the trigger.</p></li><li><p>A CLI or API call that exceeds this limit receives an error code
corresponding to HTTP status code <code>429: TOO MANY REQUESTS</code>.</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-5b43e18f4cddb0aabe9809532e2cc2fe>3.1.4 - Rest API</h1><h1 id=using-rest-apis-with-openwhisk-and-nuvoopenserverlesslaris>Using REST APIs with OpenWhisk and NuvoOpenServerlesslaris</h1><p>After your OpenWhisk and OpenServerlesss environment is enabled, you can use
it with your web apps or mobile apps with REST API calls.</p><p>For more details about the APIs for actions, activations, packages,
rules, and triggers, see the <a href="http://petstore.swagger.io/?url=https://raw.githubusercontent.com/openwhisk/openwhisk/master/core/controller/src/main/resources/apiv1swagger.json">OpenWhisk and OpenServerless API
documentation</a>.</p><p>All the capabilities in the system are available through a REST API.
There are collection and entity endpoints for actions, triggers, rules,
packages, activations, and namespaces.</p><p>These are the collection endpoints:</p><pre><code>https://$APIHOST/api/v1/namespaces
https://$APIHOST/api/v1/namespaces/{namespace}/actions
https://$APIHOST/api/v1/namespaces/{namespace}/triggers
https://$APIHOST/api/v1/namespaces/{namespace}/rules
https://$APIHOST/api/v1/namespaces/{namespace}/packages
https://$APIHOST/api/v1/namespaces/{namespace}/activations
https://$APIHOST/api/v1/namespaces/{namespace}/limits
</code></pre><p>The <code>$APIHOST</code> is the OpenWhisk and OpenServerless API hostname (for example,
localhost, 172.17.0.1, and so on). For the <code>{namespace}</code>, the character
<code>_</code> can be used to specify the user’s <em>default namespace</em>.</p><p>You can perform a GET request on the collection endpoints to fetch a
list of entities in the collection.</p><p>There are entity endpoints for each type of entity:</p><pre><code>https://$APIHOST/api/v1/namespaces/{namespace}
https://$APIHOST/api/v1/namespaces/{namespace}/actions/[{packageName}/]{actionName}
https://$APIHOST/api/v1/namespaces/{namespace}/triggers/{triggerName}
https://$APIHOST/api/v1/namespaces/{namespace}/rules/{ruleName}
https://$APIHOST/api/v1/namespaces/{namespace}/packages/{packageName}
https://$APIHOST/api/v1/namespaces/{namespace}/activations/{activationName}
</code></pre><p>The namespace and activation endpoints support only GET requests. The
actions, triggers, rules, and packages endpoints support GET, PUT, and
DELETE requests. The endpoints of actions, triggers, and rules also
support POST requests, which are used to invoke actions and triggers and
enable or disable rules.</p><p>All APIs are protected with HTTP Basic authentication. You can use the
<a href=../tools/admin/nuvadmin>nuvadmin</a> tool to generate a new namespace and
authentication. The Basic authentication credentials are in the <code>AUTH</code>
property in your <code>~/.nuvprops</code> file, delimited by a colon. You can also
retrieve these credentials using the CLI running
<code>ops property get --auth</code>.</p><p>The following is an example that uses the <a href=https://curl.haxx.se>cURL</a>
command tool to get the list of all packages in the <code>whisk.system</code>
namespace:</p><pre><code>curl -u USERNAME:PASSWORD https://$APIHOST/api/v1/namespaces/whisk.system/packages

[
  {
    &quot;name&quot;: &quot;slack&quot;,
    &quot;binding&quot;: false,
    &quot;publish&quot;: true,
    &quot;annotations&quot;: [
      {
        &quot;key&quot;: &quot;description&quot;,
        &quot;value&quot;: &quot;Package that contains actions to interact with the Slack messaging service&quot;
      }
    ],
    &quot;version&quot;: &quot;0.0.1&quot;,
    &quot;namespace&quot;: &quot;whisk.system&quot;
  }
]
</code></pre><p>In this example the authentication was passed using the <code>-u</code> flag, you
can pass this value also as part of the URL as
<code>https://USERNAME:PASSWORD@$APIHOST</code>.</p><p>The OpenWhisk API supports request-response calls from web clients.
OpenWhisk responds to <code>OPTIONS</code> requests with Cross-Origin Resource
Sharing headers. Currently, all origins are allowed (that is,
Access-Control-Allow-Origin is &ldquo;<code>*</code>&rdquo;), the standard set of methods are
allowed (that is, Access-Control-Allow-Methods is
<code>GET, DELETE, POST, PUT, HEAD</code>), and Access-Control-Allow-Headers yields
<code>Authorization, Origin, X-Requested-With, Content-Type, Accept, User-Agent</code>.</p><p><strong>Attention:</strong> Because OpenWhisk and OpenServerless currently supports only
one key per namespace, it is not recommended to use CORS beyond simple
experiments. Use <a href=/docs/reference/references/rest_api/#webactions.adoc>Web Actions</a> to expose your actions
to the public and not use the OpenWhisk and OpenServerless authorization key
for client applications that require CORS.</p><h2 id=using-the-cli-verbose-mode>Using the CLI verbose mode</h2><p>The OpenWhisk and OpenServerless CLI is an interface to the OpenWhisk and
OpenServerless REST API. You can run the CLI in verbose mode with the flag
<code>-v</code>, this will print truncated information about the HTTP request and
response. To print all information use the flag <code>-d</code> for debug.</p><p><strong>Note:</strong> HTTP request and response bodies will only be truncated if
they exceed 1000 bytes.</p><p>Let’s try getting the namespace value for the current user.</p><pre><code>ops namespace list -v

REQUEST:
[GET]  https://$APIHOST/api/v1/namespaces
Req Headers
{
  &quot;Authorization&quot;: [
    &quot;Basic XXXYYYY&quot;
  ],
  &quot;User-Agent&quot;: [
    &quot;OpenWhisk and OpenServerless-CLI/1.0 (2017-08-10T20:09:30+00:00)&quot;
  ]
}
RESPONSE:Got response with code 200
Resp Headers
{
  &quot;Content-Type&quot;: [
    &quot;application/json; charset=UTF-8&quot;
  ]
}
Response body size is 28 bytes
Response body received:
[&quot;john@example.com_dev&quot;]
</code></pre><p>As you can see you the printed information provides the properties of
the HTTP request, it performs a HTTP method <code>GET</code> on the URL
<code>https://$APIHOST/api/v1/namespaces</code> using a User-Agent header
<code>OpenWhisk and OpenServerless-CLI/1.0 (&lt;CLI-Build-version>)</code> and Basic
Authorization header <code>Basic XXXYYYY</code>. Notice that the authorization
value is your base64-encoded OpenWhisk and OpenServerless authorization
string. The response is of content type <code>application/json</code>.</p><h2 id=actions>Actions</h2><p><strong>Note:</strong> In the examples that follow, <code>$AUTH</code> and <code>$APIHOST</code> represent
environment variables set respectively to your OpenWhisk and OpenServerless
authorization key and API host.</p><p>To create or update an action send a HTTP request with method <code>PUT</code> on
the the actions collection. For example, to create a <code>nodejs:6</code> action
with the name <code>hello</code> using a single file content use the following:</p><pre><code>curl -u $AUTH -d '{&quot;namespace&quot;:&quot;_&quot;,&quot;name&quot;:&quot;hello&quot;,&quot;exec&quot;:{&quot;kind&quot;:&quot;nodejs:6&quot;,&quot;code&quot;:&quot;function main(params) { return {payload:\&quot;Hello \&quot;+params.name}}&quot;}}' -X PUT -H &quot;Content-Type: application/json&quot; https://$APIHOST/api/v1/namespaces/_/actions/hello?overwrite=true
</code></pre><p>To perform a blocking invocation on an action, send a HTTP request with
a method <code>POST</code> and body containing the input parameter <code>name</code> use the
following:</p><pre><code>curl -u $AUTH https://$APIHOST/api/v1/namespaces/_/actions/hello?blocking=true \
-X POST -H &quot;Content-Type: application/json&quot; \
-d '{&quot;name&quot;:&quot;John&quot;}'
</code></pre><p>You get the following response:</p><pre><code>{
  &quot;duration&quot;: 2,
  &quot;name&quot;: &quot;hello&quot;,
  &quot;subject&quot;: &quot;john@example.com_dev&quot;,
  &quot;activationId&quot;: &quot;c7bb1339cb4f40e3a6ccead6c99f804e&quot;,
  &quot;publish&quot;: false,
  &quot;annotations&quot;: [{
    &quot;key&quot;: &quot;limits&quot;,
    &quot;value&quot;: {
      &quot;timeout&quot;: 60000,
      &quot;memory&quot;: 256,
      &quot;logs&quot;: 10
    }
  }, {
    &quot;key&quot;: &quot;path&quot;,
    &quot;value&quot;: &quot;john@example.com_dev/hello&quot;
  }],
  &quot;version&quot;: &quot;0.0.1&quot;,
  &quot;response&quot;: {
    &quot;result&quot;: {
      &quot;payload&quot;: &quot;Hello John&quot;
    },
    &quot;success&quot;: true,
    &quot;status&quot;: &quot;success&quot;
  },
  &quot;end&quot;: 1493327653769,
  &quot;logs&quot;: [],
  &quot;start&quot;: 1493327653767,
  &quot;namespace&quot;: &quot;john@example.com_dev&quot;
}
</code></pre><p>If you just want to get the <code>response.result</code>, run the command again
with the query parameter <code>result=true</code></p><pre><code>curl -u $AUTH &quot;https://$APIHOST/api/v1/namespaces/_/actions/hello?blocking=true&amp;result=true&quot; \
-X POST -H &quot;Content-Type: application/json&quot; \
-d '{&quot;name&quot;:&quot;John&quot;}'
</code></pre><p>You get the following response:</p><pre><code>{
  &quot;payload&quot;: &quot;hello John&quot;
}
</code></pre><h2 id=annotations-and-web-actions>Annotations and Web Actions</h2><p>To create an action as a web action, you need to add an
<a href=/docs/reference/references/rest_api/#annotations.adoc>annotation</a> of <code>web-export=true</code> for web actions.
Since web-actions are publicly accessible, you should protect
pre-defined parameters (i.e., treat them as final) using the annotation
<code>final=true</code>. If you create or update an action using the CLI flag
<code>--web true</code> this command will add both annotations <code>web-export=true</code>
and <code>final=true</code>.</p><p>Run the curl command providing the complete list of annotations to set
on the action</p><pre><code>curl -u $AUTH https://$APIHOST/api/v1/namespaces/_/actions/hello?overwrite=true \
-X PUT -H &quot;Content-Type: application/json&quot; \
-d '{&quot;namespace&quot;:&quot;_&quot;,&quot;name&quot;:&quot;hello&quot;,&quot;exec&quot;:{&quot;kind&quot;:&quot;nodejs:6&quot;,&quot;code&quot;:&quot;function main(params) { return {payload:\&quot;Hello \&quot;+params.name}}&quot;},&quot;annotations&quot;:[{&quot;key&quot;:&quot;web-export&quot;,&quot;value&quot;:true},{&quot;key&quot;:&quot;raw-http&quot;,&quot;value&quot;:false},{&quot;key&quot;:&quot;final&quot;,&quot;value&quot;:true}]}'
</code></pre><p>You can now invoke this action as a public URL with no OpenWhisk and
OpenServerless authorization. Try invoking using the web action public URL
including an optional extension such as <code>.json</code> or <code>.http</code> for example
at the end of the URL.</p><pre><code>curl https://$APIHOST/api/v1/web/john@example.com_dev/default/hello.json?name=John

{
  &quot;payload&quot;: &quot;Hello John&quot;
}
</code></pre><p>Note that this example source code will not work with <code>.http</code>, see <a href=webactions.md>web
actions</a> documentation on how to modify.</p><h2 id=sequences>Sequences</h2><p>To create an action sequence, you need to create it by providing the
names of the actions that compose the sequence in the desired order, so
the output from the first action is passed as input to the next action.</p><p>$ ops action create sequenceAction –sequence
/whisk-system/utils/split,/whisk-system/utils/sort</p><p>Create a sequence with the actions <code>/whisk-system/utils/split</code> and
<code>/whisk-system/utils/sort</code>.</p><pre><code>curl -u $AUTH https://$APIHOST/api/v1/namespaces/_/actions/sequenceAction?overwrite=true \
-X PUT -H &quot;Content-Type: application/json&quot; \
-d '{&quot;namespace&quot;:&quot;_&quot;,&quot;name&quot;:&quot;sequenceAction&quot;,&quot;exec&quot;:{&quot;kind&quot;:&quot;sequence&quot;,&quot;components&quot;:[&quot;/whisk.system/utils/split&quot;,&quot;/whisk.system/utils/sort&quot;]},&quot;annotations&quot;:[{&quot;key&quot;:&quot;web-export&quot;,&quot;value&quot;:true},{&quot;key&quot;:&quot;raw-http&quot;,&quot;value&quot;:false},{&quot;key&quot;:&quot;final&quot;,&quot;value&quot;:true}]}'
</code></pre><p>Take into account when specifying the names of the actions, they have to
be full qualified.</p><h2 id=triggers>Triggers</h2><p>To create a trigger, the minimum information you need is a name for the
trigger. You could also include default parameters that get passed to
the action through a rule when the trigger gets fired.</p><p>Create a trigger with name <code>events</code> with a default parameter <code>type</code> with
value <code>webhook</code> set.</p><pre><code>curl -u $AUTH https://$APIHOST/api/v1/namespaces/_/triggers/events?overwrite=true \
-X PUT -H &quot;Content-Type: application/json&quot; \
-d '{&quot;name&quot;:&quot;events&quot;,&quot;parameters&quot;:[{&quot;key&quot;:&quot;type&quot;,&quot;value&quot;:&quot;webhook&quot;}]}'
</code></pre><p>Now whenever you have an event that needs to fire this trigger it just
takes an HTTP request with a method <code>POST</code> using the OpenWhisk and
OpenServerless Authorization key.</p><p>To fire the trigger <code>events</code> with a parameter <code>temperature</code>, send the
following HTTP request.</p><pre><code>curl -u $AUTH https://$APIHOST/api/v1/namespaces/_/triggers/events \
-X POST -H &quot;Content-Type: application/json&quot; \
-d '{&quot;temperature&quot;:60}'
</code></pre><h2 id=rules>Rules</h2><p>To create a rule that associates a trigger with an action, send a HTTP
request with a <code>PUT</code> method providing the trigger and action in the body
of the request.</p><pre><code>curl -u $AUTH https://$APIHOST/api/v1/namespaces/_/rules/t2a?overwrite=true \
-X PUT -H &quot;Content-Type: application/json&quot; \
-d '{&quot;name&quot;:&quot;t2a&quot;,&quot;status&quot;:&quot;&quot;,&quot;trigger&quot;:&quot;/_/events&quot;,&quot;action&quot;:&quot;/_/hello&quot;}'
</code></pre><p>Rules can be enabled or disabled, and you can change the status of the
rule by updating its status property. For example, to disable the rule
<code>t2a</code> send in the body of the request <code>status: "inactive"</code> with a <code>POST</code>
method.</p><pre><code>curl -u $AUTH https://$APIHOST/api/v1/namespaces/_/rules/t2a?overwrite=true \
-X POST -H &quot;Content-Type: application/json&quot; \
-d '{&quot;status&quot;:&quot;inactive&quot;,&quot;trigger&quot;:null,&quot;action&quot;:null}'
</code></pre><h2 id=packages>Packages</h2><p>To create an action in a package you have to create a package first, to
create a package with name <code>iot</code> send an HTTP request with a <code>PUT</code>
method</p><pre><code>curl -u $AUTH https://$APIHOST/api/v1/namespaces/_/packages/iot?overwrite=true \
-X PUT -H &quot;Content-Type: application/json&quot; \
-d '{&quot;namespace&quot;:&quot;_&quot;,&quot;name&quot;:&quot;iot&quot;}'
</code></pre><p>To force delete a package that contains entities, set the force
parameter to true. Failure will return an error either for failure to
delete an action within the package or the package itself. The package
will not be attempted to be deleted until all actions are successfully
deleted.</p><pre><code>curl -u $AUTH https://$APIHOST/api/v1/namespaces/_/packages/iot?force=true \
-X DELETE
</code></pre><h2 id=activations>Activations</h2><p>To get the list of the last 3 activations use a HTTP request with a
<code>GET</code> method, passing the query parameter <code>limit=3</code></p><pre><code>curl -u $AUTH https://$APIHOST/api/v1/namespaces/_/activations?limit=3
</code></pre><p>To get all the details of an activation including results and logs, send
a HTTP request with a <code>GET</code> method passing the activation identifier as
a path parameter</p><pre><code>curl -u $AUTH https://$APIHOST/api/v1/namespaces/_/activations/f81dfddd7156401a8a6497f2724fec7b
</code></pre><h2 id=limits>Limits</h2><p>To get the limits set for a namespace (i.e. invocationsPerMinute,
concurrentInvocations, firesPerMinute, actionMemoryMax, actionLogsMax…)</p><pre><code>curl -u $AUTH https://$APIHOST/api/v1/namespaces/_/limits
</code></pre><p>Note that the default system values are returned if no specific limits
are set for the user corresponding to the authenticated identity.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c7225acdcbc593d8fa87d59944d1fa90>3.1.5 - Runtimes under the hood</h1><h1 id=adding-action-language-runtimes>Adding Action Language Runtimes</h1><p>OpenWhisk and OpenServerless supports <a href=/docs/reference/references/actions-new/#index-runtimes.adoc>several languages and
runtimes</a> but there may be other languages or
runtimes that are important for your organization, and for which you
want tighter integration with the platform.</p><p>The platform is extensible and you can add new languages or runtimes
(with custom packages and third-party dependencies)</p><p>This guide describes the contract a runtime must satisfy. However all
the OpenServerless runtimes are implemented the <a href=/docs/reference/references/actions-new/#actions-actionloop.adoc>using the ActionLoop
Proxy</a>. This proxy is implemented in Go,
already satifies the semantic of a runtime ands makes very easy to build
a new runtime. You just need to provide &ldquo;launcher code&rdquo; in your favorite
programming language and a compilation script (generally written in
python) for the initialization of an action. You are advised to use it
for your own runtimes and use the material of this document as reference
for the behaviour of a runtime.</p><h2 id=runtime-general-requirements>Runtime general requirements</h2><p>The unit of execution for all functions is a <a href=https://docs.docker.com>Docker
container</a> which must implement a specific
<a href=/docs/reference/references/actions-new/##action-interface>Action interface</a> that, in general performs:</p><ol><li><p><strong><a href=/docs/reference/references/actions-new/##initialization>Initialization</a></strong> - accepts an initialization
payload (the code) and prepared for execution,</p></li><li><p><strong><a href=/docs/reference/references/actions-new/##activation>Activation</a></strong> - accepts a runtime payload (the
input parameters) and</p><ul><li><p>prepares the activation context,</p></li><li><p>runs the function,</p></li><li><p>returns the function result,</p></li></ul></li><li><p><strong><a href=/docs/reference/references/actions-new/##logging>Logging</a></strong> - flushes all <code>stdout</code> and <code>stderr</code> logs
and adds a frame marker at the end of the activation.</p></li></ol><p>The specifics of the <a href=/docs/reference/references/actions-new/##action-interface>Action interface</a> and its
functions are shown below.</p><h2 id=the-runtimes-manifest>The runtimes manifest</h2><p>Actions when created specify the desired runtime for the function via a
property called <code>kind</code>. When using the <code>nuv</code> CLI, this is specified as
<code>--kind &lt;runtime-kind></code>. The value is typically a string describing the
language (e.g., <code>nodejs</code>) followed by a colon and the version for the
runtime as in <code>nodejs:20</code> or <code>php:8.1</code>.</p><p>The manifest is a map of runtime family names to an array of specific
kinds. As an example, the following entry add a new runtime family
called <code>nodejs</code> with a single kind <code>nodejs:20</code>.</p><pre><code>{
  &quot;nodejs&quot;: [{
    &quot;kind&quot;: &quot;nodejs:20&quot;,
    &quot;default&quot;: true,
    &quot;image&quot;: {
      &quot;prefix&quot;: &quot;openwhisk&quot;,
      &quot;name&quot;: &quot;action-nodejs-v20&quot;,
      &quot;tag&quot;: &quot;latest&quot;
    }
  }]
}
</code></pre><p>The <code>default</code> property indicates if the corresponding kind should be
treated as the default for the runtime family. The JSON <code>image</code>
structure defines the Docker image name that is used for actions of this
kind (e.g., <code>openwhisk/nodejs10action:latest</code> for the JSON example
above).</p><p>The standard test action is shown below in JavaScript. It should be
adapted for the new language and added to the <a href=../tests/dat/actions/unicode.tests>test artifacts
directory</a> with the name
<code>&lt;runtime-kind>.txt</code> for plain text file or <code>&lt;runtime-kind>.bin</code> for a a
binary file. The <code>&lt;runtime-kind></code> must match the value used for <code>kind</code>
in the corresponding runtime manifest entry, replacing <code>:</code> in the kind
with a <code>-</code>. For example, a plain text function for <code>nodejs:20</code> becomes
<code>nodejs-20.txt</code>.</p><pre><code>function main(args) {
    var str = args.delimiter + &quot; ☃ &quot; + args.delimiter;
    console.log(str);
    return { &quot;winter&quot;: str };
}
</code></pre><p>An action consists of the user function (and its dependencies) along
with a <em>proxy</em> that implements a canonical protocol to integrate with
the OpenWhisk and OpenServerless platform.</p><p>The proxy is a web server with two endpoints.</p><ul><li><p>It listens on port <code>8080</code>.</p></li><li><p>It implements <code>/init</code> to initialize the container.</p></li><li><p>It also implements <code>/run</code> to activate the function.</p></li></ul><p>The proxy also prepares the execution context, and flushes the logs
produced by the function to stdout and stderr.</p><p>The initialization route is <code>/init</code>. It must accept a <code>POST</code> request
with a JSON object as follows:</p><pre><code>{
  &quot;value&quot;: {
    &quot;name&quot; : String,
    &quot;main&quot; : String,
    &quot;code&quot; : String,
    &quot;binary&quot;: Boolean,
    &quot;env&quot;: Map[String, String]
  }
}
</code></pre><ul><li><p><code>name</code> is the name of the action.</p></li><li><p><code>main</code> is the name of the function to execute.</p></li><li><p><code>code</code> is either plain text or a base64 encoded string for binary
functions (i.e., a compiled executable).</p></li><li><p><code>binary</code> is false if <code>code</code> is in plain text, and true if <code>code</code> is
base64 encoded.</p></li><li><p><code>env</code> is a map of key-value pairs of properties to export to the
environment. And contains several properties starting with the
<code>__OW_</code> prefix that are specific to the running action.</p><ul><li><p><code>__OW_API_KEY</code> the API key for the subject invoking the action,
this key may be a restricted API key. This property is absent
unless explicitly
<a href=/docs/reference/references/actions-new/#annotations.adoc#annotations-for-all-actions>requested</a>.</p></li><li><p><code>__OW_NAMESPACE</code> the namespace for the <em>activation</em> (this may
not be the same as the namespace for the action).</p></li><li><p><code>__OW_ACTION_NAME</code> the fully qualified name of the running
action.</p></li><li><p><code>__OW_ACTION_VERSION</code> the internal version number of the running
action.</p></li><li><p><code>__OW_ACTIVATION_ID</code> the activation id for this running action
instance.</p></li><li><p><code>__OW_DEADLINE</code> the approximate time when this initializer will
have consumed its entire duration quota (measured in epoch
milliseconds).</p></li></ul></li></ul><p>The initialization route is called exactly once by the OpenWhisk and
OpenServerless platform, before executing a function. The route should report
an error if called more than once. It is possible however that a single
initialization will be followed by many activations (via <code>/run</code>). If an
<code>env</code> property is provided, the corresponding environment variables
should be defined before the action code is initialized.</p><p><strong>Successful initialization:</strong> The route should respond with <code>200 OK</code> if
the initialization is successful and the function is ready to execute.
Any content provided in the response is ignored.</p><p><strong>Failures to initialize:</strong> Any response other than <code>200 OK</code> is treated
as an error to initialize. The response from the handler if provided
must be a JSON object with a single field called <code>error</code> describing the
failure. The value of the error field may be any valid JSON value. The
proxy should make sure to generate meaningful log message on failure to
aid the end user in understanding the failure.</p><p><strong>Time limit:</strong> Every action in OpenWhisk and OpenServerless has a defined
time limit (e.g., 60 seconds). The initialization must complete within
the allowed duration. Failure to complete initialization within the
allowed time frame will destroy the container.</p><p><strong>Limitation:</strong> The proxy does not currently receive any of the
activation context at initialization time. There are scenarios where the
context is convenient if present during initialization. This will
require a change in the OpenWhisk and OpenServerless platform itself. Note
that even if the context is available during initialization, it must be
reset with every new activation since the information will change with
every execution.</p><p>The proxy is ready to execute a function once it has successfully
completed initialization. The OpenWhisk and OpenServerless platform will
invoke the function by posting an HTTP request to <code>/run</code> with a JSON
object providing a new activation context and the input parameters for
the function. There may be many activations of the same function against
the same proxy (viz. container). Currently, the activations are
guaranteed not to overlap — that is, at any given time, there is at most
one request to <code>/run</code> from the OpenWhisk and OpenServerless platform.</p><p>The route must accept a JSON object and respond with a JSON object,
otherwise the OpenWhisk and OpenServerless platform will treat the activation
as a failure and proceed to destroy the container. The JSON object
provided by the platform follows the following schema:</p><pre><code>{
  &quot;value&quot;: JSON,
  &quot;namespace&quot;: String,
  &quot;action_name&quot;: String,
  &quot;api_host&quot;: String,
  &quot;api_key&quot;: String,
  &quot;activation_id&quot;: String,
  &quot;transaction_id&quot;: String,
  &quot;deadline&quot;: Number
}
</code></pre><ul><li><p><code>value</code> is a JSON object and contains all the parameters for the
function activation.</p></li><li><p><code>namespace</code> is the OpenWhisk and OpenServerless namespace for the action
(e.g., <code>whisk-system</code>).</p></li><li><p><code>action_name</code> is the <a href=reference.md#fully-qualified-names>fully qualified
name</a> of the action.</p></li><li><p><code>activation_id</code> is a unique ID for this activation.</p></li><li><p><code>transaction_id</code> is a unique ID for the request of which this
activation is part of.</p></li><li><p><code>deadline</code> is the deadline for the function.</p></li><li><p><code>api_key</code> is the API key used to invoke the action.</p></li></ul><p>The <code>value</code> is the function parameters. The rest of the properties
become part of the activation context which is a set of environment
variables constructed by capitalizing each of the property names, and
prefixing the result with <code>__OW_</code>. Additionally, the context must define
<code>__OW_API_HOST</code> whose value is the OpenWhisk and OpenServerless API host.
This value is currently provided as an environment variable defined at
container startup time and hence already available in the context.</p><p><strong>Successful activation:</strong> The route must respond with <code>200 OK</code> if the
activation is successful and the function has produced a JSON object as
its result. The response body is recorded as the <a href=actions.md#understanding-the-activation-record>result of the
activation</a>.</p><p><strong>Failed activation:</strong> Any response other than <code>200 OK</code> is treated as an
activation error. The response from the handler must be a JSON object
with a single field called <code>error</code> describing the failure. The value of
the error field may be any valid JSON value. Should the proxy fail to
respond with a JSON object, the OpenWhisk and OpenServerless platform will
treat the failure as an uncaught exception. These two failures modes are
distinguished by the value of the <code>response.status</code> in the activation
record which is <code>application error</code> if the proxy returned an <code>error</code>
object, and <code>action developer error</code> otherwise.</p><p><strong>Time limit:</strong> Every action in OpenWhisk and OpenServerless has a defined
time limit (e.g., 60 seconds). The activation must complete within the
allowed duration. Failure to complete activation within the allowed time
frame will destroy the container.</p><p>The proxy must flush all the logs produced during initialization and
execution and add a frame marker to denote the end of the log stream for
an activation. This is done by emitting the token
<code>XXX_THE_END_OF_A_WHISK_ACTIVATION_XXX</code> as the last log line for the
<code>stdout</code> <em>and</em> <code>stderr</code> streams. Failure to emit this marker will cause
delayed or truncated activation logs.</p><p>The <a href=/docs/reference/references/actions-new/##action-interface>Action interface</a> is enforced via a canonical
test suite which validates the initialization protocol, the runtime
protocol, ensures the activation context is correctly prepared, and that
the logs are properly framed. Your runtime should extend this test
suite, and of course include additional tests as needed.</p><h2 id=runtime-proxy-tests>Runtime proxy tests</h2><p>The tests verify that the proxy can handle the following scenarios:</p><ul><li><p>Test the proxy can handle the identity functions (initialize and
run).</p></li><li><p>Test the proxy can handle pre-defined environment variables as well
as initialization parameters.</p></li><li><p>Test the proxy properly constructs the activation context.</p></li><li><p>Test the proxy can properly handle functions with Unicode
characters.</p></li><li><p>Test the proxy can handle large payloads (more than 1MB).</p></li><li><p>Test the proxy can handle an entry point other than <code>main</code>.</p></li><li><p>Test the proxy does not permit re-initialization.</p></li><li><p>Test the error handling for an action returning an invalid response.</p></li><li><p>Test the proxy when initialized with no content.</p></li></ul><p>The canonical test suite should be extended by the new runtime tests.
Additional tests will be required depending on the feature set provided
by the runtime.</p><p>Since the OpenWhisk and OpenServerless platform is language and runtime
agnostic, it is generally not necessary to add integration tests. That
is the unit tests verifying the protocol are sufficient. However, it may
be necessary in some cases to modify the <code>ops</code> CLI or other OpenWhisk
and OpenServerless clients. In which case, appropriate tests should be added
as necessary. The OpenWhisk and OpenServerless platform will perform a
generic integration test as part of its basic system tests. This
integration test will require a <a href=/docs/reference/references/actions-new/#the-test-action>test function</a> to be
available so that the test harness can create, invoke, and delete the
action.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-81b8ae42271adca707c7d285d1fd091b>3.1.6 - Scheduler</h1><p>OpenServerless Operator offers the possibility to deploy a simple &ldquo;scheduler&rdquo; to invoke repetitive or one-shot OpenWhisk actions. For example, an action executing a SQL script to create a PostgreSQL Database or inserting reference data, or simply an action that sends notifications with an API call every day at the same time.</p><h1 id=how-to-activate-the-scheduler>How to Activate the Scheduler</h1><p>Using the <code>ops</code> CLI, you can enable the scheduler with the following command:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops config <span style=color:#204a87>enable</span> --cron
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># if OpenServerless is not yet deployed</span>
</span></span><span style=display:flex><span>ops setup devcluster
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># alternatively if OpenServerless is already deployed</span>
</span></span><span style=display:flex><span>ops update apply
</span></span></code></pre></div><p>By default, the internal scheduler executes a job every minute that starts searching for OpenWhisk actions with special annotations.</p><h1 id=how-to-deploy-a-repetitive-action>How to Deploy a Repetitive Action</h1><p>Let&rsquo;s assume we want to deploy an OpenWhisk action to be executed every 30 minutes. Suppose it&rsquo;s an action that simply prints something, like this:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>):</span> 
</span></span><span style=display:flex><span>    <span style=color:#204a87>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Hello from a repeated action&#39;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#4e9a06>&#39;body&#39;</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#39;action invoked&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>abd save it to a file called <code>scheduled-action.py</code></p><p>To deploy the action and instruct OpenServerless to execute it every 30 minutes, issue the following command:</p><p><code>ops action create scheduled-action scheduled-action.py -a cron "*/30 * * * *"</code></p><p>So you can create the action in the usual way and at the end add -a cron yourCronExpression.</p><h1 id=how-to-deploy-a-one-shot-execution-action>How to Deploy a One-Shot Execution Action</h1><p>Now suppose we want to execute the same action <code>scheduled-action.py</code> only once.</p><p>To deploy an action and request a single execution automatically via the OpenServerless Scheduler, issue the following command:</p><p><code>ops action create scheduled-action scheduled-action.py -a autoexec true</code></p><p>If we now print activation logs with <code>ops activation poll</code>, we will see our action execution log:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Activation: <span style=color:#4e9a06>&#39;scheduled&#39;</span> <span style=color:#ce5c00;font-weight:700>(</span>ebd532139a464e9d9532139a46ae9d8a<span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>
</span></span><span style=display:flex><span>    <span style=color:#4e9a06>&#34;2024-03-08T07:28:02.050739962Z stdout: Hello from a scheduled action&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><h1 id=remarks>Remarks</h1><p>The Scheduler executes the action according to the following rules:</p><p>Actions are called in a non-blocking fashion. To verify execution and logs, use the command <code>ops activation list</code>.
Actions are invoked without any parameters. It is advised to deploy actions with self-contained parameters.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-9a9f38e443de2df9046eecaddcd64dcb>3.2 - Entities</h1><p>You can find more informations about OpenServerless and OpenWhisk entities
here:</p><ul><li><p><a href=/docs/reference/entities/#actions.adoc>Actions</a></p></li><li><p><a href=/docs/reference/entities/#parameters.adoc>Parameters</a></p></li><li><p><a href=/docs/reference/entities/#annotations.adoc>Annotations</a></p></li><li><p><a href=/docs/reference/entities/#scheduler.adoc>Scheduler</a></p></li><li><p><a href=/docs/reference/entities/#webactions.adoc>Web Actions</a></p></li><li><p><a href=/docs/reference/entities/#packages.adoc>Packages</a></p></li><li><p><a href=/docs/reference/entities/#feeds.adoc>Feeds</a></p></li></ul></div><div class=td-content><h1 id=pg-81c0ecd9c622d63e01ce626c30f315ba>3.2.1 - Actions</h1><div class=lead>What Actions are and how to create and execute them</div><h2 id=actions>Actions</h2><p>Actions are stateless functions that run on the OpenWhisk and
OpenServerless platform. For example, an action can be used to detect
the faces in an image, respond to a database change, respond to an API
call, or post a Tweet. In general, an action is invoked in response to
an event and produces some observable output.</p><p>An action may be created from a function programmed using a number of
<a href=/docs/reference/index-runtimes>supported languages and
runtimes</a>, or from a
binary-compatible executable.</p><ul><li><p>The OpenServerless CLI makes it easy to create and invoke actions.
Instructions for configuring and using the CLI are available
<a href=/docs/cli/>here</a>.</p></li><li><p>You can also use the <a href=/docs/reference/rest_api/>REST
API</a>.</p></li></ul><p>While the actual function code will be specific to a <a href=/docs/reference/index-runtimes/>language and
runtime</a>, the operations to
create, invoke and manage an action are the same regardless of the
implementation choice.</p><p>We recommend that you review <a href=/docs/reference/entities/actions/#../../cli/index.adoc>the cli</a> and read
<a href=/docs/reference/entities/actions/#../../tutorial/index.adoc>the tutorial</a> before moving on to advanced
topics.</p><h3 id=what-you-need-to-know-about-actions>What you need to know about actions</h3><ul><li><p>Functions should be stateless, or <em>idempotent</em>. While the system
does not enforce this property, there is no guarantee that any state
maintained by an action will be available across invocations. In
some cases, deliberately leaking state across invocations may be
advantageous for performance, but also exposes some risks.</p></li><li><p>An action executes in a sandboxed environment, namely a container.
At any given time, a single activation will execute inside the
container. Subsequent invocations of the same action may reuse a
previous container, and there may exist more than one container at
any given time, each having its own state.</p></li><li><p>Invocations of an action are not ordered. If the user invokes an
action twice from the command line or the REST API, the second
invocation might run before the first. If the actions have side
effects, they might be observed in any order.</p></li><li><p>There is no guarantee that actions will execute atomically. Two
actions can run concurrently and their side effects can be
interleaved. OpenWhisk and OpenServerless does not ensure any
particular concurrent consistency model for side effects. Any
concurrency side effects will be implementation-dependent.</p></li><li><p>Actions have two phases: an initialization phase, and a run phase.
During initialization, the function is loaded and prepared for
execution. The run phase receives the action parameters provided at
invocation time. Initialization is skipped if an action is
dispatched to a previously initialized container — this is referred
to as a <em>warm start</em>. You can tell if an invocation was a warm
activation or a cold one requiring initialization by inspecting the
activation record.</p></li><li><p>An action runs for a bounded amount of time. This limit can be
configured per action, and applies to both the initialization and
the execution separately. If the action time limit is exceeded
during the initialization or run phase, the activation’s response
status is <em>action developer error</em>.</p></li></ul><h3 id=accessing-action-metadata-within-the-action-body>Accessing action metadata within the action body</h3><p>The action environment contains several properties that are specific to
the running action. These allow the action to programmatically work with
OpenWhisk and OpenServerless assets via the REST API, or set an internal
alarm when the action is about to use up its allotted time budget. The
properties are accessible via the system environment for all supported
runtimes: Node.js, Python, Swift, Java and Docker actions when using the
OpenWhisk and OpenServerless Docker skeleton.</p><ul><li><p><code>__OW_API_HOST</code> the API host for the OpenWhisk and OpenServerless
deployment running this action.</p></li><li><p><code>__OW_API_KEY</code> the API key for the subject invoking the action, this
key may be a restricted API key. This property is absent unless
requested with the annotation explicitly
<a href=/docs/reference/entities/actions/#../../reference/annotations/index.adoc#annotations-for-all-actions><code>provide-api-key</code></a></p></li><li><p><code>__OW_NAMESPACE</code> the namespace for the <em>activation</em> (this may not be
the same as the namespace for the action).</p></li><li><p><code>__OW_ACTION_NAME</code> the fully qualified name of the running action.</p></li><li><p><code>__OW_ACTION_VERSION</code> the internal version number of the running
action.</p></li><li><p><code>__OW_ACTIVATION_ID</code> the activation id for this running action
instance.</p></li><li><p><code>__OW_DEADLINE</code> the approximate time when this action will have
consumed its entire duration quota (measured in epoch milliseconds).</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-0fbd1ebffcee5d3c07d1d8080f65183d>3.2.2 - Web Actions</h1><h1 id=web-actions>Web Actions</h1><p>Web actions are OpenWhisk and OpenServerless actions annotated to quickly
enable you to build web based applications. This allows you to program
backend logic which your web application can access anonymously without
requiring an OpenWhisk and OpenServerless authentication key. It is up to the
action developer to implement their own desired authentication and
authorization (i.e. OAuth flow).</p><p>Web action activations will be associated with the user that created the
action. This actions defers the cost of an action activation from the
caller to the owner of the action.</p><p>Let’s take the following JavaScript action <code>hello.js</code>,</p><pre><code>$ cat hello.js
function main({name}) {
  var msg = 'you did not tell me who you are.';
  if (name) {
    msg = `hello ${name}!`
  }
  return {body: `&lt;html&gt;&lt;body&gt;&lt;h3&gt;${msg}&lt;/h3&gt;&lt;/body&gt;&lt;/html&gt;`}
}
</code></pre><p>You may create a <em>web action</em> <code>hello</code> in the package <code>demo</code> for the
namespace <code>guest</code> using the CLI’s <code>--web</code> flag with a value of <code>true</code> or
<code>yes</code>:</p><pre><code>$ ops package create demo
ok: created package demo

$ ops action create demo/hello hello.js --web true
ok: created action demo/hello

$ ops action get demo/hello --url
ok: got action hello
https://${APIHOST}/api/v1/web/guest/demo/hello
</code></pre><p>Using the <code>--web</code> flag with a value of <code>true</code> or <code>yes</code> allows an action
to be accessible via REST interface without the need for credentials. A
web action can be invoked using a URL that is structured as follows:</p><pre><code>https://{APIHOST}/api/v1/web/{QUALIFIED ACTION NAME}.{EXT}`
</code></pre><p>The fully qualified name of an action consists of three parts: the
namespace, the package name, and the action name.</p><p><em>The fully qualified name of the action must include its package name,
which is <code>default</code> if the action is not in a named package.</em></p><p>An example is <code>guest/demo/hello</code>. The last part of the URI called the
<code>extension</code> which is typically <code>.http</code> although other values are
permitted as described later. The web action API path may be used with
<code>curl</code> or <code>wget</code> without an API key. It may even be entered directly in
your browser.</p><p>Try opening:</p><pre><code>https://${APIHOST}/api/v1/web/guest/demo/hello.http?name=Jane
</code></pre><p>in your web browser. Or try invoking the action via <code>curl</code>:</p><pre><code>curl https://${APIHOST}/api/v1/web/guest/demo/hello.http?name=Jane
</code></pre><p>Here is an example of a web action that performs an HTTP redirect:</p><pre><code>function main() {
  return {
    headers: { location: 'http://openwhisk.org' },
    statusCode: 302
  }
}
</code></pre><p>Or sets a cookie:</p><pre><code>function main() {
  return {
    headers: {
      'Set-Cookie': 'UserID=Jane; Max-Age=3600; Version=',
      'Content-Type': 'text/html'
    },
    statusCode: 200,
    body: '&lt;html&gt;&lt;body&gt;&lt;h3&gt;hello&lt;/h3&gt;&lt;/body&gt;&lt;/html&gt;' }
}
</code></pre><p>Or sets multiple cookies:</p><pre><code>function main() {
  return {
    headers: {
      'Set-Cookie': [
        'UserID=Jane; Max-Age=3600; Version=',
        'SessionID=asdfgh123456; Path = /'
      ],
      'Content-Type': 'text/html'
    },
    statusCode: 200,
    body: '&lt;html&gt;&lt;body&gt;&lt;h3&gt;hello&lt;/h3&gt;&lt;/body&gt;&lt;/html&gt;' }
}
</code></pre><p>Or returns an <code>image/png</code>:</p><pre><code>function main() {
    let png = &lt;base 64 encoded string&gt;
    return { headers: { 'Content-Type': 'image/png' },
             statusCode: 200,
             body: png };
}
</code></pre><p>Or returns <code>application/json</code>:</p><pre><code>function main(params) {
    return {
        statusCode: 200,
        headers: { 'Content-Type': 'application/json' },
        body: params
    };
}
</code></pre><p>The default content-type for an HTTP response is <code>application/json</code> and
the body may be any allowed JSON value. The default content-type may be
omitted from the headers.</p><p>It is important to be aware of the <a href=/docs/reference/entities/webactions/#reference.adoc>response size
limit</a> for actions since a response that exceeds the
predefined system limits will fail. Large objects should not be sent
inline through OpenWhisk and OpenServerless, but instead deferred to an
object store, for example.</p><h2 id=handling-http-requests-with-actions>Handling HTTP requests with actions</h2><p>An OpenWhisk and OpenServerless action that is not a web action requires both
authentication and must respond with a JSON object. In contrast, web
actions may be invoked without authentication, and may be used to
implement HTTP handlers that respond with <em>headers</em>, <em>statusCode</em>, and
<em>body</em> content of different types. The web action must still return a
JSON object, but the OpenWhisk and OpenServerless system (namely the
<code>controller</code>) will treat a web action differently if its result includes
one or more of the following as top level JSON properties:</p><ol><li><p><code>headers</code>: a JSON object where the keys are header-names and the
values are string, number, or boolean values for those headers
(default is no headers). To send multiple values for a single
header, the header’s value should be a JSON array of values.</p></li><li><p><code>statusCode</code>: a valid HTTP status code (default is 200 OK if body is
not empty otherwise 204 No Content).</p></li><li><p><code>body</code>: a string which is either plain text, JSON object or array,
or a base64 encoded string for binary data (default is empty
response).</p></li></ol><p>The <code>body</code> is considered empty if it is <code>null</code>, the empty string <code>""</code> or
undefined.</p><p>The controller will pass along the action-specified headers, if any, to
the HTTP client when terminating the request/response. Similarly the
controller will respond with the given status code when present. Lastly,
the body is passed along as the body of the response. If a
<code>content-type header</code> is not declared in the action result’s <code>headers</code>,
the body is interpreted as <code>application/json</code> for non-string values, and
<code>text/html</code> otherwise. When the <code>content-type</code> is defined, the
controller will determine if the response is binary data or plain text
and decode the string using a base64 decoder as needed. Should the body
fail to decoded correctly, an error is returned to the caller.</p><h2 id=http-context>HTTP Context</h2><p>All web actions, when invoked, receives additional HTTP request details
as parameters to the action input argument. They are:</p><ol><li><p><code>__ow_method</code> (type: string): the HTTP method of the request.</p></li><li><p><code>__ow_headers</code> (type: map string to string): the request headers.</p></li><li><p><code>__ow_path</code> (type: string): the unmatched path of the request
(matching stops after consuming the action extension).</p></li><li><p><code>__ow_user</code> (type: string): the namespace identifying the OpenWhisk
and OpenServerless authenticated subject.</p></li><li><p><code>__ow_body</code> (type: string): the request body entity, as a base64
encoded string when content is binary or JSON object/array, or plain
string otherwise.</p></li><li><p><code>__ow_query</code> (type: string): the query parameters from the request
as an unparsed string.</p></li></ol><p>A request may not override any of the named <code>__ow_</code> parameters above;
doing so will result in a failed request with status equal to 400 Bad
Request.</p><p>The <code>__ow_user</code> is only present when the web action is <a href=/docs/reference/entities/webactions/#annotations.adoc#annotations-specific-to-web-actions>annotated to
require
authentication</a>
and allows a web action to implement its own authorization policy. The
<code>__ow_query</code> is available only when a web action elects to handle the
<a href=/docs/reference/entities/webactions/##raw-http-handling>“raw” HTTP request</a>. It is a string containing the
query parameters parsed from the URI (separated by <code>&</code>). The <code>__ow_body</code>
property is present either when handling “raw” HTTP requests, or when
the HTTP request entity is not a JSON object or form data. Web actions
otherwise receive query and body parameters as first class properties in
the action arguments with body parameters taking precedence over query
parameters, which in turn take precedence over action and package
parameters.</p><h2 id=additional-features>Additional features</h2><p>Web actions bring some additional features that include:</p><ol><li><p><code>Content extensions</code>: the request must specify its desired content
type as one of <code>.json</code>, <code>.html</code>, <code>.http</code>, <code>.svg</code> or <code>.text</code>. This is
done by adding an extension to the action name in the URI, so that
an action <code>/guest/demo/hello</code> is referenced as
<code>/guest/demo/hello.http</code> for example to receive an HTTP response
back. For convenience, the <code>.http</code> extension is assumed when no
extension is detected.</p></li><li><p><code>Query and body parameters as input</code>: the action receives query
parameters as well as parameters in the request body. The precedence
order for merging parameters is: package parameters, binding
parameters, action parameters, query parameter, body parameters with
each of these overriding any previous values in case of overlap . As
an example <code>/guest/demo/hello.http?name=Jane</code> will pass the argument
<code>{name: "Jane"}</code> to the action.</p></li><li><p><code>Form data</code>: in addition to the standard <code>application/json</code>, web
actions may receive URL encoded from data
<code>application/x-www-form-urlencoded data</code> as input.</p></li><li><p><code>Activation via multiple HTTP verbs</code>: a web action may be invoked
via any of these HTTP methods: <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>PATCH</code>, and
<code>DELETE</code>, as well as <code>HEAD</code> and <code>OPTIONS</code>.</p></li><li><p><code>Non JSON body and raw HTTP entity handling</code>: A web action may
accept an HTTP request body other than a JSON object, and may elect
to always receive such values as opaque values (plain text when not
binary, or base64 encoded string otherwise).</p></li></ol><p>The example below briefly sketches how you might use these features in a
web action. Consider an action <code>/guest/demo/hello</code> with the following
body:</p><pre><code>function main(params) {
    return { response: params };
}
</code></pre><p>This is an example of invoking the web action using the <code>.json</code>
extension, indicating a JSON response.</p><pre><code>$ curl https://${APIHOST}/api/v1/web/guest/demo/hello.json
{
  &quot;response&quot;: {
    &quot;__ow_method&quot;: &quot;get&quot;,
    &quot;__ow_headers&quot;: {
      &quot;accept&quot;: &quot;*/*&quot;,
      &quot;connection&quot;: &quot;close&quot;,
      &quot;host&quot;: &quot;172.17.0.1&quot;,
      &quot;user-agent&quot;: &quot;curl/7.43.0&quot;
    },
    &quot;__ow_path&quot;: &quot;&quot;
  }
}
</code></pre><p>You can supply query parameters.</p><pre><code>$ curl https://${APIHOST}/api/v1/web/guest/demo/hello.json?name=Jane
{
  &quot;response&quot;: {
    &quot;name&quot;: &quot;Jane&quot;,
    &quot;__ow_method&quot;: &quot;get&quot;,
    &quot;__ow_headers&quot;: {
      &quot;accept&quot;: &quot;*/*&quot;,
      &quot;connection&quot;: &quot;close&quot;,
      &quot;host&quot;: &quot;172.17.0.1&quot;,
      &quot;user-agent&quot;: &quot;curl/7.43.0&quot;
    },
    &quot;__ow_path&quot;: &quot;&quot;
  }
}
</code></pre><p>You may use form data as input.</p><pre><code>$ curl https://${APIHOST}/api/v1/web/guest/demo/hello.json -d &quot;name&quot;:&quot;Jane&quot;
{
  &quot;response&quot;: {
    &quot;name&quot;: &quot;Jane&quot;,
    &quot;__ow_method&quot;: &quot;post&quot;,
    &quot;__ow_headers&quot;: {
      &quot;accept&quot;: &quot;*/*&quot;,
      &quot;connection&quot;: &quot;close&quot;,
      &quot;content-length&quot;: &quot;10&quot;,
      &quot;content-type&quot;: &quot;application/x-www-form-urlencoded&quot;,
      &quot;host&quot;: &quot;172.17.0.1&quot;,
      &quot;user-agent&quot;: &quot;curl/7.43.0&quot;
    },
    &quot;__ow_path&quot;: &quot;&quot;
  }
}
</code></pre><p>You may also invoke the action with a JSON object.</p><pre><code>$ curl https://${APIHOST}/api/v1/web/guest/demo/hello.json -H 'Content-Type: application/json' -d '{&quot;name&quot;:&quot;Jane&quot;}'
{
  &quot;response&quot;: {
    &quot;name&quot;: &quot;Jane&quot;,
    &quot;__ow_method&quot;: &quot;post&quot;,
    &quot;__ow_headers&quot;: {
      &quot;accept&quot;: &quot;*/*&quot;,
      &quot;connection&quot;: &quot;close&quot;,
      &quot;content-length&quot;: &quot;15&quot;,
      &quot;content-type&quot;: &quot;application/json&quot;,
      &quot;host&quot;: &quot;172.17.0.1&quot;,
      &quot;user-agent&quot;: &quot;curl/7.43.0&quot;
    },
    &quot;__ow_path&quot;: &quot;&quot;
  }
}
</code></pre><p>You see above that for convenience, query parameters, form data, and
JSON object body entities are all treated as dictionaries, and their
values are directly accessible as action input properties. This is not
the case for web actions which opt to instead handle HTTP request
entities more directly, or when the web action receives an entity that
is not a JSON object.</p><p>Here is an example of using a “text” content-type with the same example
shown above.</p><pre><code>$ curl https://${APIHOST}/api/v1/web/guest/demo/hello.json -H 'Content-Type: text/plain' -d &quot;Jane&quot;
{
  &quot;response&quot;: {
    &quot;__ow_method&quot;: &quot;post&quot;,
    &quot;__ow_headers&quot;: {
      &quot;accept&quot;: &quot;*/*&quot;,
      &quot;connection&quot;: &quot;close&quot;,
      &quot;content-length&quot;: &quot;4&quot;,
      &quot;content-type&quot;: &quot;text/plain&quot;,
      &quot;host&quot;: &quot;172.17.0.1&quot;,
      &quot;user-agent&quot;: &quot;curl/7.43.0&quot;
    },
    &quot;__ow_path&quot;: &quot;&quot;,
    &quot;__ow_body&quot;: &quot;Jane&quot;
  }
}
</code></pre><h2 id=content-extensions>Content extensions</h2><p>A content extension is generally required when invoking a web action;
the absence of an extension assumes <code>.http</code> as the default. The fully
qualified name of the action must include its package name, which is
<code>default</code> if the action is not in a named package.</p><h2 id=protected-parameters>Protected parameters</h2><p>Action parameters are protected and treated as immutable. Parameters are
automatically finalized when enabling web actions.</p><pre><code>$ ops action create /guest/demo/hello hello.js \
      --parameter name Jane \
      --web true
</code></pre><p>The result of these changes is that the <code>name</code> is bound to <code>Jane</code> and
may not be overridden by query or body parameters because of the final
annotation. This secures the action against query or body parameters
that try to change this value whether by accident or intentionally.</p><h2 id=securing-web-actions>Securing web actions</h2><p>By default, a web action can be invoked by anyone having the web
action’s invocation URL. Use the <code>require-whisk-auth</code> <a href=/docs/reference/entities/webactions/#annotations.adoc#annotations-specific-to-web-actions>web action
annotation</a> to
secure the web action. When the <code>require-whisk-auth</code> annotation is set
to <code>true</code>, the action will authenticate the invocation request’s Basic
Authorization credentials to confirm they represent a valid OpenWhisk
and OpenServerless identity. When set to a number or a case-sensitive string,
the action’s invocation request must include a <code>X-Require-Whisk-Auth</code>
header having this same value. Secured web actions will return a
<code>Not Authorized</code> when credential validation fails.</p><p>Alternatively, use the <code>--web-secure</code> flag to automatically set the
<code>require-whisk-auth</code> annotation. When set to <code>true</code> a random number is
generated as the <code>require-whisk-auth</code> annotation value. When set to
<code>false</code> the <code>require-whisk-auth</code> annotation is removed. When set to any
other value, that value is used as the <code>require-whisk-auth</code> annotation
value.</p><pre><code>ops action update /guest/demo/hello hello.js --web true --web-secure my-secret
</code></pre><p>or</p><pre><code>ops action update /guest/demo/hello hello.js --web true -a require-whisk-auth my-secret

curl https://${APIHOST}/api/v1/web/guest/demo/hello.json?name=Jane -X GET -H &quot;X-Require-Whisk-Auth: my-secret&quot;
</code></pre><p>It’s important to note that the owner of the web action owns all of the
web action’s activations records and will incur the cost of running the
action in the system regardless of how the action was invoked.</p><h2 id=disabling-web-actions>Disabling web actions</h2><p>To disable a web action from being invoked via web API
(<code>https://APIHOST/api/v1/web/</code>), pass a value of <code>false</code> or <code>no</code> to the
<code>--web</code> flag while updating an action with the CLI.</p><pre><code>ops action update /guest/demo/hello hello.js --web false
</code></pre><h2 id=raw-http-handling>Raw HTTP handling</h2><p>A web action may elect to interpret and process an incoming HTTP body
directly, without the promotion of a JSON object to first class
properties available to the action input (e.g., <code>args.name</code> vs parsing
<code>args.__ow_query</code>). This is done via a <code>raw-http</code>
<a href=/docs/reference/entities/webactions/#annotations.adoc>annotation</a>. Using the same example show earlier,
but now as a “raw” HTTP web action receiving <code>name</code> both as a query
parameters and as JSON value in the HTTP request body:</p><pre><code>$ curl https://${APIHOST}/api/v1/web/guest/demo/hello.json?name=Jane -X POST -H &quot;Content-Type: application/json&quot; -d '{&quot;name&quot;:&quot;Jane&quot;}'
{
  &quot;response&quot;: {
    &quot;__ow_method&quot;: &quot;post&quot;,
    &quot;__ow_query&quot;: &quot;name=Jane&quot;,
    &quot;__ow_body&quot;: &quot;eyJuYW1lIjoiSmFuZSJ9&quot;,
    &quot;__ow_headers&quot;: {
      &quot;accept&quot;: &quot;*/*&quot;,
      &quot;connection&quot;: &quot;close&quot;,
      &quot;content-length&quot;: &quot;15&quot;,
      &quot;content-type&quot;: &quot;application/json&quot;,
      &quot;host&quot;: &quot;172.17.0.1&quot;,
      &quot;user-agent&quot;: &quot;curl/7.43.0&quot;
    },
    &quot;__ow_path&quot;: &quot;&quot;
  }
}
</code></pre><h3 id=enabling-raw-http-handling>Enabling raw HTTP handling</h3><p>Raw HTTP web actions are enabled via the <code>--web</code> flag using a value of
<code>raw</code>.</p><pre><code>ops action create /guest/demo/hello hello.js --web raw
</code></pre><h3 id=disabling-raw-http-handling>Disabling raw HTTP handling</h3><p>Disabling raw HTTP can be accomplished by passing a value of <code>false</code> or
<code>no</code> to the <code>--web</code> flag.</p><pre><code>ops update create /guest/demo/hello hello.js --web false
</code></pre><h3 id=decoding-binary-body-content-from-base64>Decoding binary body content from Base64</h3><p>When using raw HTTP handling, the <code>__ow_body</code> content will be encoded in
Base64 when the request content-type is binary. Below are functions
demonstrating how to decode the body content in Node, Python, and PHP.
Simply save a method shown below to file, create a raw HTTP web action
utilizing the saved artifact, and invoke the web action.</p><h4 id=node>Node</h4><pre><code>function main(args) {
    decoded = new Buffer(args.__ow_body, 'base64').toString('utf-8')
    return {body: decoded}
}
</code></pre><h4 id=python>Python</h4><pre><code>def main(args):
    try:
        decoded = args['__ow_body'].decode('base64').strip()
        return {&quot;body&quot;: decoded}
    except:
        return {&quot;body&quot;: &quot;Could not decode body from Base64.&quot;}
</code></pre><h4 id=php>PHP</h4><pre><code>&lt;?php

function main(array $args) : array
{
    $decoded = base64_decode($args['__ow_body']);
    return [&quot;body&quot; =&gt; $decoded];
}
</code></pre><p>As an example, save the Node function as <code>decode.js</code> and execute the
following commands:</p><pre><code>$ ops action create decode decode.js --web raw
ok: created action decode
$ curl -k -H &quot;content-type: application&quot; -X POST -d &quot;Decoded body&quot; https://${APIHOST}/api/v1/web/guest/default/decodeNode.json
{
  &quot;body&quot;: &quot;Decoded body&quot;
}
</code></pre><h2 id=options-requests>Options Requests</h2><p>By default, an OPTIONS request made to a web action will result in CORS
headers being automatically added to the response headers. These headers
allow all origins and the options, get, delete, post, put, head, and
patch HTTP verbs. In addition, the header
<code>Access-Control-Request-Headers</code> is echoed back as the header
<code>Access-Control-Allow-Headers</code> if it is present in the HTTP request.
Otherwise, a default value is generated as shown below.</p><pre><code>Access-Control-Allow-Origin: *
Access-Control-Allow-Methods: OPTIONS, GET, DELETE, POST, PUT, HEAD, PATCH
Access-Control-Allow-Headers: Authorization, Origin, X-Requested-With, Content-Type, Accept, User-Agent
</code></pre><p>Alternatively, OPTIONS requests can be handled manually by a web action.
To enable this option add a <code>web-custom-options</code> annotation with a value
of <code>true</code> to a web action. When this feature is enabled, CORS headers
will not automatically be added to the request response. Instead, it is
the developer’s responsibility to append their desired headers
programmatically. Below is an example of creating custom responses to
OPTIONS requests.</p><pre><code>function main(params) {
  if (params.__ow_method == &quot;options&quot;) {
    return {
      headers: {
        'Access-Control-Allow-Methods': 'OPTIONS, GET',
        'Access-Control-Allow-Origin': 'example.com'
      },
      statusCode: 200
    }
  }
}
</code></pre><p>Save the above function to <code>custom-options.js</code> and execute the following
commands:</p><pre><code>$ ops action create custom-option custom-options.js --web true -a web-custom-options true
$ curl https://${APIHOST}/api/v1/web/guest/default/custom-options.http -kvX OPTIONS
&lt; HTTP/1.1 200 OK
&lt; Server: nginx/1.11.13
&lt; Content-Length: 0
&lt; Connection: keep-alive
&lt; Access-Control-Allow-Methods: OPTIONS, GET
&lt; Access-Control-Allow-Origin: example.com
</code></pre><h2 id=web-actions-in-shared-packages>Web Actions in Shared Packages</h2><p>A web action in a shared (i.e., public) package is accessible as a web
action either directly via the package’s fully qualified name, or via a
package binding. It is important to note that a web action in a public
package will be accessible for all bindings of the package even if the
binding is private. This is because the web action annotation is carried
on the action and cannot be overridden. If you do not wish to expose a
web action through your package bindings, then you should clone-and-own
the package instead.</p><p>Action parameters are inherited from its package, and the binding if
there is one. You can make package parameters
<a href=/docs/reference/entities/webactions/#annotations.adoc#protected-parameters>immutable</a> by defining their
values through a package binding.</p><h2 id=error-handling>Error Handling</h2><p>When an OpenWhisk and OpenServerless action fails, there are two different
failure modes. The first is known as an <em>application error</em> and is
analogous to a caught exception: the action returns a JSON object
containing a top level <code>error</code> property. The second is a <em>developer
error</em> which occurs when the action fails catastrophically and does not
produce a response (this is similar to an uncaught exception). For web
actions, the controller handles application errors as follows:</p><ol><li><p>The controller projects an <code>error</code> property from the response
object.</p></li><li><p>The controller applies the content handling implied by the action
extension to the value of the <code>error</code> property.</p></li></ol><p>Developers should be aware of how web actions might be used and generate
error responses accordingly. For example, a web action that is used with
the <code>.http</code> extension should return an HTTP response, for example:
<code>{error: { statusCode: 400 }</code>. Failing to do so will in a mismatch
between the implied content-type from the extension and the action
content-type in the error response. Special consideration must be given
to web actions that are sequences, so that components that make up a
sequence can generate adequate errors when necessary.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-134f790c8d9ec8048316409a5842a9e7>3.2.3 - Parameters</h1><p>When working with serverless actions, data is supplied by adding
parameters to the actions; these are in the parameter declared as an
argument to the main serverless function. All data arrives this way and
the values can be set in a few different ways. The first option is to
supply parameters when an action or package is created (or updated).
This approach is useful for data that stays the same on every execution,
equivalent to environment variables on other platforms, or for default
values that might be overridden at invocation time. The second option is
to supply parameters when the action is invoked - and this approach will
override any parameters already set.</p><p>This page outlines how to configure parameters when deploying packages
and actions, and how to supply parameters when invoking an action. There
is also information on how to use a file to store the parameters and
pass the filename, rather than supplying each parameter individually on
the command-line.</p><h1 id=passing-parameters-to-an-action-at-invoke-time>Passing parameters to an action at invoke time</h1><p>Parameters can be passed to the action when it is invoked. These
examples use JavaScript but all <a href=/docs/reference/entities/parameters/#index-runtimes.adoc>the other
languages</a> work the same way.</p><ol><li>Use parameters in the action. For example, create ‘hello.js’ file
with the following content:</li></ol><pre><code>function main(params) {
    return {payload:  'Hello, ' + params.name + ' from ' + params.place};
}
</code></pre><p>The input parameters are passed as a JSON object parameter to the <code>main</code>
function. Notice how the <code>name</code> and <code>place</code> parameters are retrieved
from the <code>params</code> object in this example.</p><ol><li>Update the action so it is ready to use:</li></ol><pre><code>ops action update hello hello.js
</code></pre><ol><li>Parameters can be provided explicitly on the command-line, or by
supplying a file containing the desired parameters</li></ol><p>To pass parameters directly through the command-line, supply a key/value
pair to the <code>--param</code> flag:
<code>ops action invoke --result hello --param name Dorothy --param place Kansas</code></p><p>This produces the result:</p><pre><code>{
    &quot;payload&quot;: &quot;Hello, Dorothy from Kansas&quot;
}
</code></pre><p>Notice the use of the <code>--result</code> option: it implies a blocking
invocation where the CLI waits for the activation to complete and then
displays only the result. For convenience, this option may be used
without <code>--blocking</code> which is automatically inferred.</p><p>Additionally, if parameter values specified on the command-line are
valid JSON, then they will be parsed and sent to your action as a
structured object. For example, if we update our hello action to:</p><pre><code>function main(params) {
    return {payload:  'Hello, ' + params.person.name + ' from ' + params.person.place};
}
</code></pre><p>Now the action expects a single <code>person</code> parameter to have fields <code>name</code>
and <code>place</code>. If we invoke the action with a single <code>person</code> parameter
that is valid JSON:</p><pre><code>ops action invoke --result hello -p person '{&quot;name&quot;: &quot;Dorothy&quot;, &quot;place&quot;: &quot;Kansas&quot;}'
</code></pre><p>The result is the same because the CLI automatically parses the <code>person</code>
parameter value into the structured object that the action now expects:
<code>json { "payload": "Hello, Dorothy from Kansas" }</code></p><h1 id=setting-default-parameters-on-an-action>Setting default parameters on an action</h1><p>Actions can be invoked with multiple named parameters. Recall that the
<code>hello</code> action from the previous example expects two parameters: the
<em>name</em> of a person, and the <em>place</em> where they’re from.</p><p>Rather than pass all the parameters to an action every time, you can
bind certain parameters. The following example binds the <em>place</em>
parameter so that the action defaults to the place “Kansas”:</p><ol><li>Update the action by using the <code>--param</code> option to bind parameter
values, or by passing a file that contains the parameters to
<code>--param-file</code> (for examples of using files, see the section on
<a href=/docs/reference/entities/parameters/##working-with-parameter-files>working with parameter files</a>).</li></ol><p>To specify default parameters explicitly on the command-line, provide a
key/value pair to the <code>param</code> flag:</p><pre><code>ops action update hello --param place Kansas
</code></pre><ol><li>Invoke the action, passing only the <code>name</code> parameter this time.</li></ol><pre><code>ops action invoke --result hello --param name Dorothy

{
    &quot;payload&quot;: &quot;Hello, Dorothy from Kansas&quot;
}
</code></pre><p>Notice that you did not need to specify the <code>place</code> parameter when you
invoked the action. Bound parameters can still be overwritten by
specifying the parameter value at invocation time.</p><ol><li>Invoke the action, passing both <code>name</code> and <code>place</code> values, and
observe the output:</li></ol><pre><code>ops action invoke --result hello --param name Dorothy --param place &quot;Washington, DC&quot;

{
    &quot;payload&quot;: &quot;Hello, Dorothy from Washington, DC&quot;
}
</code></pre><p>Despite a parameter set on the action when it was created/updated, this
is overridden by a parameter that was supplied when invoking the action.</p><h1 id=setting-default-parameters-on-a-package>Setting default parameters on a package</h1><p>Parameters can be set at the package level, and these will serve as
default parameters for actions unless:</p><ul><li><p>The action itself has a default parameter.</p></li><li><p>The action has a parameter supplied at invoke time, which will
always be the “winner” where more than one parameter is available.</p></li></ul><p>The following example sets a default parameter of <code>name</code> on the <code>MyApp</code>
package and shows an action making use of it.</p><ol><li>Create a package with a parameter set:</li></ol><pre><code>ops package update MyApp --param name World
</code></pre><ol><li>Create an action in this package:</li></ol><pre><code>   function main(params) {
       return {payload: &quot;Hello, &quot; + params.name};
   }

ops action update MyApp/hello hello.js
</code></pre><ol><li>Invoke the action, and observe the default package parameter in use:</li></ol><pre><code>ops action invoke --result MyApp/hello

   {
       &quot;payload&quot;: &quot;Hello, World&quot;
   }
</code></pre><p># Working with parameter files</p><p>It’s also possible to put parameters into a file in JSON format, and
then pass the parameters in by supplying the filename with the
<code>param-file</code> flag. This works for both packages and actions when
creating/updating them, and when invoking actions.</p><ol><li>As an example, consider the very simple <code>hello</code> example from
earlier. Using <code>hello.js</code> with this content:</li></ol><pre><code>function main(params) {
    return {payload:  'Hello, ' + params.name + ' from ' + params.place};
}
</code></pre><ol><li>Update the action with the updated contents of <code>hello.js</code>:</li></ol><pre><code>ops action update hello hello.js
</code></pre><ol><li>Create a parameter file called <code>parameters.json</code> containing
JSON-formatted parameters:</li></ol><pre><code>{
    &quot;name&quot;: &quot;Dorothy&quot;,
    &quot;place&quot;: &quot;Kansas&quot;
}
</code></pre><ol><li>Use the <code>parameters.json</code> filename when invoking the action, and
observe the output</li></ol><pre><code>ops action invoke --result hello --param-file parameters.json

{
    &quot;payload&quot;: &quot;Hello, Dorothy from Kansas&quot;
}
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-1a65c20d0a8a7e9ac6e3d7ebb32079cf>3.2.4 - Packages</h1><h1 id=using-and-creating-packages>Using and creating packages</h1><p>In OpenWhisk and OpenServerless, you can use packages to bundle together a
set of related actions, and share them with others.</p><p>A package can include <em>actions</em> and <em>feeds</em>. - An action is a piece of
code that runs on OpenWhisk. For example, the Cloudant
package includes actions to read and write records to a Cloudant
database. - A feed is used to configure an external event source to fire
trigger events. For example, the Alarm package includes a feed that can
fire a trigger at a specified frequency.</p><p>Every OpenWhisk and OpenServerless entity, including packages, belongs in a
<em>namespace</em>, and the fully qualified name of an entity is
<code>/namespaceName[/packageName]/entityName</code>. Refer to the <a href=/docs/reference/entities/packages/#reference.adoc#openwhisk-entities>naming
guidelines</a> for more information.</p><p>The following sections describe how to browse packages and use the
triggers and feeds in them. In addition, if you are interested in
contributing your own packages to the catalog, read the sections on
creating and sharing packages.</p><h2 id=browsing-packages>Browsing packages</h2><p>Several packages are registered with OpenWhisk and OpenServerless. You can
get a list of packages in a namespace, list the entities in a package,
and get a description of the individual entities in a package.</p><ol><li>Get a list of packages in the <code>/nuvolaris</code> namespace.</li></ol><pre><code>$ ops package list /nuvolaris

packages
/nuvolaris/openai                                       private
/nuvolaris/mastrogpt                                    private
/nuvolaris/examples                                     private
</code></pre><ol><li>Get a list of entities in the <code>/nuvolaris/openai</code> package.</li></ol><pre><code>$ ops package get --summary /nuvolaris/openai
package /nuvolaris/openai
   (parameters: none defined)
 action /nuvolaris/openai/models
   (parameters: none defined)
 action /nuvolaris/openai/chat
   (parameters: none defined)
</code></pre><p><strong>Note</strong>: Parameters listed under the package with a prefix <code>*</code> are
predefined, bound parameters. Parameters without a <code>*</code> are those listed
under the <a href=/docs/reference/entities/packages/#annotations.adoc>annotations</a> for each entity. Furthermore,
any parameters with the prefix <code>**</code> are finalized bound parameters. This
means that they are immutable, and cannot be changed by the user. Any
entity listed under a package inherits specific bound parameters from
the package. To view the list of known parameters of an entity belonging
to a package, you will need to run a <code>get --summary</code> of the individual
entity.</p><ol><li>Get a description of the <code>/nuvolaris/openai/chat</code> action.</li></ol><pre><code>$ ops action get --summary /nuvolaris/openai/chat
action /nuvolaris/openai/chat: Returns a result based on parameters OPENAI_API_HOST and OPENAI_API_KEY
   (parameters: **OPENAI_API_HOST, **OPENAI_API_KEY)
</code></pre><p><em>NOTE</em>: Notice that the parameters listed for the action <code>read</code> were
expanded upon from the action summary compared to the package summary
above. To see the official bound parameters for actions and triggers
listed under packages, run an individual get summary for the particular
entity.</p><h2 id=creating-a-package>Creating a package</h2><p>A package is used to organize a set of related actions and feeds. It
also allows for parameters to be shared across all entities in the
package.</p><p>To create a custom package with a simple action in it, try the following
example:</p><ol><li>Create a package called <code>custom</code>.</li></ol><pre><code>$ ops package create custom
ok: created package custom
</code></pre><ol><li>Get a summary of the package.</li></ol><pre><code>$ ops package get --summary custom
package /myNamespace/custom
   (parameters: none defined)
</code></pre><p>Notice that the package is empty.</p><ol><li>Create a file called <code>identity.js</code> that contains the following
action code. This action returns all input parameters.</li></ol><pre><code>function main(args) { return args; }
</code></pre><ol><li>Create an <code>identity</code> action in the <code>custom</code> package.</li></ol><pre><code>$ ops action create custom/identity identity.js
ok: created action custom/identity
</code></pre><p>Creating an action in a package requires that you prefix the action name
with a package name. Package nesting is not allowed. A package can
contain only actions and can’t contain another package.</p><ol><li>Get a summary of the package again.</li></ol><pre><code>$ ops package get --summary custom
package /myNamespace/custom
  (parameters: none defined)
 action /myNamespace/custom/identity
  (parameters: none defined)
</code></pre><p>You can see the <code>custom/identity</code> action in your namespace now.</p><ol><li>Invoke the action in the package.</li></ol><pre><code>$ ops action invoke --result custom/identity
{}
</code></pre><p>You can set default parameters for all the entities in a package. You do
this by setting package-level parameters that are inherited by all
actions in the package. To see how this works, try the following
example:</p><ol><li>Update the <code>custom</code> package with two parameters: <code>city</code> and
<code>country</code>.</li></ol><pre><code>$ ops package update custom --param city Austin --param country USA
ok: updated package custom
</code></pre><ol><li>Display the parameters in the package and action, and see how the
<code>identity</code> action in the package inherits parameters from the
package.</li></ol><pre><code>$ ops package get custom
ok: got package custom
...
&quot;parameters&quot;: [
    {
        &quot;key&quot;: &quot;city&quot;,
        &quot;value&quot;: &quot;Austin&quot;
    },
    {
        &quot;key&quot;: &quot;country&quot;,
        &quot;value&quot;: &quot;USA&quot;
    }
]
...

$ ops action get custom/identity
ok: got action custom/identity
...
&quot;parameters&quot;: [
    {
        &quot;key&quot;: &quot;city&quot;,
        &quot;value&quot;: &quot;Austin&quot;
    },
    {
        &quot;key&quot;: &quot;country&quot;,
        &quot;value&quot;: &quot;USA&quot;
    }
]
...
</code></pre><ol><li>Invoke the identity action without any parameters to verify that the
action indeed inherits the parameters.</li></ol><pre><code>$ ops action invoke --result custom/identity
{
    &quot;city&quot;: &quot;Austin&quot;,
    &quot;country&quot;: &quot;USA&quot;
}
</code></pre><ol><li>Invoke the identity action with some parameters. Invocation
parameters are merged with the package parameters; the invocation
parameters override the package parameters.</li></ol><pre><code>$ ops action invoke --result custom/identity --param city Dallas --param state Texas
{
    &quot;city&quot;: &quot;Dallas&quot;,
    &quot;country&quot;: &quot;USA&quot;,
    &quot;state&quot;: &quot;Texas&quot;
}
</code></pre><h2 id=sharing-a-package>Sharing a package</h2><p>After the actions and feeds that comprise a package are debugged and
tested, the package can be shared with all OpenWhisk and OpenServerless
users. Sharing the package makes it possible for the users to bind the
package, invoke actions in the package, and author OpenWhisk and
OpenServerless rules and sequence actions.</p><ol><li>Share the package with all users:</li></ol><pre><code>$ ops package update custom --shared yes
ok: updated package custom
</code></pre><ol><li>Display the <code>publish</code> property of the package to verify that it is
now true.</li></ol><pre><code>$ ops package get custom
ok: got package custom
...
&quot;publish&quot;: true,
...
</code></pre><p>Others can now use your <code>custom</code> package, including binding to the
package or directly invoking an action in it. Other users must know the
fully qualified names of the package to bind it or invoke actions in it.
Actions and feeds within a shared package are <em>public</em>. If the package
is private, then all of its contents are also private.</p><ol><li>Get a description of the package to show the fully qualified names
of the package and action.</li></ol><pre><code>$ ops package get --summary custom
package /myNamespace/custom: Returns a result based on parameters city and country
   (parameters: *city, *country)
 action /myNamespace/custom/identity
   (parameters: none defined)
</code></pre><p>In the previous example, you’re working with the <code>myNamespace</code>
namespace, and this namespace appears in the fully qualified name.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-edfa631df9f2b93b7371eb7b774a35b8>3.2.5 - Feeds</h1><h1 id=implementing-feeds>Implementing feeds</h1><p>OpenWhisk and OpenServerless support an open API, where any user can expose
an event producer service as a <strong>feed</strong> in a <strong>package</strong>. This section
describes architectural and implementation options for providing your
own feed.</p><p>This material is intended for advanced OpenWhisk and OpenServerless users who
intend to publish their own feeds. Most OpenWhisk and OpenServerless users
can safely skip this section.</p><h1 id=feed-architecture>Feed Architecture</h1><p>There are at least 3 architectural patterns for creating a feed:
<strong>Hooks</strong>, <strong>Polling</strong> and <strong>Connections</strong>.</p><h2 id=hooks>Hooks</h2><p>In the <em>Hooks</em> pattern, we set up a feed using a
<a href=https://en.wikipedia.org/wiki/Webhook>webhook</a> facility exposed by
another service. In this strategy, we configure a webhook on an external
service to POST directly to a URL to fire a trigger. This is by far the
easiest and most attractive option for implementing low-frequency feeds.</p><h2 id=polling>Polling</h2><p>In the <code>Polling</code> pattern, we arrange for an OpenWhisk and OpenServerless
<em>action</em> to poll an endpoint periodically to fetch new data. This
pattern is relatively easy to build, but the frequency of events will of
course be limited by the polling interval.</p><h2 id=connections>Connections</h2><p>In the <code>Connections</code> pattern, we stand up a separate service somewhere
that maintains a persistent connection to a feed source. The connection
based implementation might interact with a service endpoint via long
polling, or to set up a push notification.</p><h1 id=difference-between-feed-and-trigger>Difference between Feed and Trigger</h1><p>Feeds and triggers are closely related, but technically distinct
concepts.</p><ul><li><p>OpenWhisk and OpenServerless process <strong>events</strong> which flow into the
system.</p></li><li><p>A <strong>trigger</strong> is technically a name for a class of events. Each
event belongs to exactly one trigger; by analogy, a trigger
resembles a <em>topic</em> in topic-based pub-sub systems. A <strong>rule</strong> <em>T →
A</em> means &ldquo;whenever an event from trigger <em>T</em> arrives, invoke action
<em>A</em> with the trigger payload.</p></li><li><p>A <strong>feed</strong> is a stream of events which all belong to some trigger
<em>T</em>. A feed is controlled by a <strong>feed action</strong> which handles
creating, deleting, pausing, and resuming the stream of events which
comprise a feed. The feed action typically interacts with external
services which produce the events, via a REST API that manages
notifications.</p></li></ul><h1 id=implementing-feed-actions>Implementing Feed Actions</h1><p>The <em>feed action</em> is a normal OpenWhisk and OpenServerless <em>action</em>, but it
should accept the following parameters: * <strong>lifecycleEvent</strong>: one of
‘CREATE’, ‘READ’, ‘UPDATE’, ‘DELETE’, ‘PAUSE’, or ‘UNPAUSE’. *
<strong>triggerName</strong>: the fully-qualified name of the trigger which contains
events produced from this feed. * <strong>authKey</strong>: the Basic auth
credentials of the OpenWhisk and OpenServerless user who owns the trigger
just mentioned.</p><p>The feed action can also accept any other parameters it needs to manage
the feed. For example the cloudant changes feed action expects to
receive parameters including <em>`dbname&rsquo;</em>, <em>`username&rsquo;</em>, etc.</p><p>When the user creates a trigger from the CLI with the <strong>–feed</strong>
parameter, the system automatically invokes the feed action with the
appropriate parameters.</p><p>For example, assume the user has created a <code>mycloudant</code> binding for the
<code>cloudant</code> package with their username and password as bound parameters.
When the user issues the following command from the CLI:</p><p><code>ops trigger create T --feed mycloudant/changes -p dbName myTable</code></p><p>then under the covers the system will do something equivalent to:</p><p><code>ops action invoke mycloudant/changes -p lifecycleEvent CREATE -p triggerName T -p authKey &lt;userAuthKey> -p password &lt;password value from mycloudant binding> -p username &lt;username value from mycloudant binding> -p dbName mytype</code></p><p>The feed action named <em>changes</em> takes these parameters, and is expected
to take whatever action is necessary to set up a stream of events from
Cloudant, with the appropriate configuration, directed to the trigger
<em>T</em>.</p><p>For the Cloudant <em>changes</em> feed, the action happens to talk directly to
a <em>cloudant trigger</em> service we’ve implemented with a connection-based
architecture. We’ll discuss the other architectures below.</p><p>A similar feed action protocol occurs for <code>ops trigger delete</code>,
<code>ops trigger update</code> and <code>ops trigger get</code>.</p><h1 id=implementing-feeds-with-hooks>Implementing Feeds with Hooks</h1><p>It is easy to set up a feed via a hook if the event producer supports a
webhook/callback facility.</p><p>With this method there is <em>no need</em> to stand up any persistent service
outside of OpenWhisk and OpenServerless. All feed management happens
naturally though stateless OpenWhisk and OpenServerless <em>feed actions</em>, which
negotiate directly with a third part webhook API.</p><p>When invoked with <code>CREATE</code>, the feed action simply installs a webhook
for some other service, asking the remote service to POST notifications
to the appropriate <code>fireTrigger</code> URL in OpenWhisk and OpenServerless.</p><p>The webhook should be directed to send notifications to a URL such as:</p><pre><code>POST /namespaces/{namespace}/triggers/{triggerName}
</code></pre><p>The form with the POST request will be interpreted as a JSON document
defining parameters on the trigger event. OpenWhisk and OpenServerless rules
pass these trigger parameters to any actions to fire as a result of the
event.</p><h1 id=implementing-feeds-with-polling>Implementing Feeds with Polling</h1><p>It is possible to set up an OpenWhisk and OpenServerless <em>action</em> to poll a
feed source entirely within OpenWhisk and OpenServerless, without the need to
stand up any persistent connections or external service.</p><p>For feeds where a webhook is not available, but do not need high-volume
or low latency response times, polling is an attractive option.</p><p>To set up a polling-based feed, the feed action takes the following
steps when called for <code>CREATE</code>:</p><ol><li><p>The feed action sets up a periodic trigger (<em>T</em>) with the desired
frequency, using the <code>whisk.system/alarms</code> feed.</p></li><li><p>The feed developer creates a <code>pollMyService</code> action which simply
polls the remote service and returns any new events.</p></li><li><p>The feed action sets up a <em>rule</em> <em>T → pollMyService</em>.</p></li></ol><p>This procedure implements a polling-based trigger entirely using
OpenWhisk and OpenServerless actions, without any need for a separate
service.</p><h1 id=implementing-feeds-via-connections>Implementing Feeds via Connections</h1><p>The previous 2 architectural choices are simple and easy to implement.
However, if you want a high-performance feed, there is no substitute for
persistent connections and long-polling or similar techniques.</p><p>Since OpenWhisk and OpenServerless actions must be short-running, an action
cannot maintain a persistent connection to a third party . Instead, we
must stand up a separate service (outside of OpenWhisk and OpenServerless)
that runs all the time. We call these <em>provider services</em>. A provider
service can maintain connections to third party event sources that
support long polling or other connection-based notifications.</p><p>The provider service should provide a REST API that allows the OpenWhisk
and OpenServerless <em>feed action</em> to control the feed. The provider service
acts as a proxy between the event provider and OpenWhisk and OpenServerless –
when it receives events from the third party, it sends them on to
OpenWhisk and OpenServerless by firing a trigger.</p><p>The connection-based architecture is the highest performance option, but
imposes more overhead on operations compared to the polling and hook
architectures.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-38495e8c2bc869b2620d6c789f0e418f>3.2.6 - Annotations</h1><h1 id=annotations>Annotations</h1><p>OpenWhisk and OpenServerless actions, triggers, rules and packages
(collectively referred to as assets) may be decorated with
<code>annotations</code>. Annotations are attached to assets just like parameters
with a <code>key</code> that defines a name and <code>value</code> that defines the value. It
is convenient to set them from the command line interface (CLI) via
<code>--annotation</code> or <code>-a</code> for short.</p><p>Rationale: Annotations were added to OpenWhisk and OpenServerless to allow
for experimentation without making changes to the underlying asset
schema. We had, until the writing of this document, deliberately not
defined what <code>annotations</code> are permitted. However as we start to use
annotations more heavily to impart semantic changes, it’s important that
we finally start to document them.</p><p>The most prevalent use of annotations to date is to document actions and
packages. You’ll see many of the packages in the OpenWhisk and OpenServerless
catalog carry annotations such as a description of the functionality
offered by their actions, which parameters are required at package
binding time, and which are invoke-time parameters, whether a parameter
is a “secret” (e.g., password), or not. We have invented these as
needed, for example to allow for UI integration.</p><p>Here is a sample set of annotations for an <code>echo</code> action which returns
its input arguments unmodified (e.g.,
<code>function main(args) { return args }</code>). This action may be useful for
logging input parameters for example as part of a sequence or rule.</p><pre><code>ops action create echo echo.js \
    -a description 'An action which returns its input. Useful for logging input to enable debug/replay.' \
    -a parameters  '[{ &quot;required&quot;:false, &quot;description&quot;: &quot;Any JSON entity&quot; }]' \
    -a sampleInput  '{ &quot;msg&quot;: &quot;Five fuzzy felines&quot;}' \
    -a sampleOutput '{ &quot;msg&quot;: &quot;Five fuzzy felines&quot;}'
</code></pre><p>The annotations we have used for describing packages are:</p><ul><li><p><code>description</code>: a pithy description of the package</p></li><li><p><code>parameters</code>: an array describing parameters that are scoped to the
package (described further below)</p></li></ul><p>Similarly, for actions:</p><ul><li><p><code>description</code>: a pithy description of the action</p></li><li><p><code>parameters</code>: an array describing actions that are required to
execute the action</p></li><li><p><code>sampleInput</code>: an example showing the input schema with typical
values</p></li><li><p><code>sampleOutput</code>: an example showing the output schema, usually for
the <code>sampleInput</code></p></li></ul><p>The annotations we have used for describing parameters include:</p><ul><li><p><code>name</code>: the name of the parameter</p></li><li><p><code>description</code>: a pithy description of the parameter</p></li><li><p><code>doclink</code>: a link to further documentation for parameter (useful for
OAuth tokens for example)</p></li><li><p><code>required</code>: true for required parameters and false for optional ones</p></li><li><p><code>bindTime</code>: true if the parameter should be specified when a package
is bound</p></li><li><p><code>type</code>: the type of the parameter, one of <code>password</code>, <code>array</code> (but
may be used more broadly)</p></li></ul><p>The annotations are <em>not</em> checked. So while it is conceivable to use the
annotations to infer if a composition of two actions into a sequence is
legal, for example, the system does not yet do that.</p><p>The following annotations on an action are available.</p><ul><li><code>provide-api-key</code>: This annotation may be attached to actions which
require an API key, for example to make REST API calls to the
OpenWhisk and OpenServerless host. For newly created actions, if not
specified, it defaults to a false value. For existing actions, the
absence of this annotation, or its presence with a value that is not
<em>falsy</em> (i.e., a value that is different from zero, null, false, and
the empty string) will cause an API key to be present in the <a href=/docs/reference/entities/annotations/#actions.adoc#accessing-action-metadata-within-the-action-body>action
execution
context</a>.</li></ul><h1 id=annotations-specific-to-web-actions>Annotations specific to web actions</h1><p>Web actions are enabled with explicit annotations which decorate
individual actions. The annotations only apply to the <a href=/docs/reference/entities/annotations/#webactions.adoc>web
actions</a> API, and must be present and explicitly set
to <code>true</code> to have an affect. The annotations have no meaning otherwise
in the system. The annotations are:</p><ul><li><p><code>web-export</code>: Makes its corresponding action accessible to REST
calls <em>without</em> authentication. We call these <a href=/docs/reference/entities/annotations/#webactions.adoc><em>web
actions</em></a> because they allow one to use OpenWhisk
and OpenServerless actions from a browser for example. It is important to
note that the <em>owner</em> of the web action incurs the cost of running
them in the system (i.e., the <em>owner</em> of the action also owns the
activations record). The rest of the annotations described below
have no effect on the action unless this annotation is also set.</p></li><li><p><code>final</code>: Makes all of the action parameters that are already defined
immutable. A parameter of an action carrying the annotation may not
be overridden by invoke-time parameters once the parameter has a
value defined through its enclosing package or the action
definition.</p></li><li><p><code>raw-http</code>: When set, the HTTP request query and body parameters are
passed to the action as reserved properties.</p></li><li><p><code>web-custom-options</code>: When set, this annotation enables a web action
to respond to OPTIONS requests with customized headers, otherwise a
<a href=/docs/reference/entities/annotations/#webactions.adoc#options-requests>default CORS response</a> applies.</p></li><li><p><code>require-whisk-auth</code>: This annotation protects the web action so
that it is only invoked by requests that provide appropriate
authentication credentials. When set to a boolean value, it controls
whether or not the request’s Basic Authentication value (i.e. Whisk
auth key) will be authenticated - a value of <code>true</code> will
authenticate the credentials, a value of <code>false</code> will invoke the
action without any authentication. When set to a number or a string,
this value must match the request’s <code>X-Require-Whisk-Auth</code> header
value. In both cases, it is important to note that the <em>owner</em> of
the web action will still incur the cost of running them in the
system (i.e., the <em>owner</em> of the action also owns the activations
record).</p></li></ul><h1 id=annotations-specific-to-activations>Annotations specific to activations</h1><p>The system decorates activation records with annotations as well. They
are:</p><ul><li><p><code>path</code>: the fully qualified path name of the action that generated
the activation. Note that if this activation was the result of an
action in a package binding, the path refers to the parent package.</p></li><li><p><code>binding</code>: the entity path of the package binding. Note that this is
only present for actions in a package binding.</p></li><li><p><code>kind</code>: the kind of action executed, and one of the support
OpenWhisk and OpenServerless runtime kinds.</p></li><li><p><code>limits</code>: the time, memory and log limits that this activation were
subject to.</p></li></ul><p>Additionally for sequence related activations, the system will generate
the following annotations:</p><ul><li><p><code>topmost</code>: this is only present for an outermost sequence action.</p></li><li><p><code>causedBy</code>: this is only present for actions that are contained in a
sequence.</p></li></ul><p>Lastly, and in order to provide you with some performance transparency,
activations also record:</p><ul><li><p><code>waitTime</code>: the time spent waiting in the internal OpenWhisk and
OpenServerless system. This is roughly the time spent between the
controller receiving the activation request and when the invoker
provisioned a container for the action.</p></li><li><p><code>initTime</code>: the time spent initializing the function. If this value
is present, the action required initialization and represents a cold
start. A warm activation will skip initialization, and in this case,
the annotation is not generated.</p></li></ul><p>An example of these annotations as they would appear in an activation
record is shown below.</p><pre><code>&quot;annotations&quot;: [
  {
    &quot;key&quot;: &quot;path&quot;,
    &quot;value&quot;: &quot;guest/echo&quot;
  },
  {
    &quot;key&quot;: &quot;waitTime&quot;,
    &quot;value&quot;: 66
  },
  {
    &quot;key&quot;: &quot;kind&quot;,
    &quot;value&quot;: &quot;nodejs:6&quot;
  },
  {
    &quot;key&quot;: &quot;initTime&quot;,
    &quot;value&quot;: 50
  },
  {
    &quot;key&quot;: &quot;limits&quot;,
    &quot;value&quot;: {
      &quot;logs&quot;: 10,
      &quot;memory&quot;: 256,
      &quot;timeout&quot;: 60000
    }
  }
]
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-7c3791c874a67812e76da777841eec4d>3.3 - Runtimes</h1><p>This document is still 🚧 <strong>work in progress</strong> 🚧</p><p>The programming languages currently directly supported by OpenServerless are:</p><ul><li><p><a href=/docs/reference/runtimes/#actions-nodejs.adoc>🚧 Node</a></p></li><li><p><a href=/docs/reference/runtimes/#actions-python.adoc>🚧 Python</a></p></li><li><p><a href=/docs/reference/runtimes/#actions-go.adoc>🚧 Go</a></p></li><li><p><a href=/docs/reference/runtimes/#actions-java.adoc>🚧 Java</a></p></li><li><p><a href=/docs/reference/runtimes/#actions-php.adoc>🚧 PHP</a></p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-fd53f7b5e98190bcc94d79b123790625>3.4 - Tasks</h1><p>Type <code>ops &lt;task></code> to see usage and subtasks.</p><h2 id=openserverless-tasks>OpenServerless Tasks:</h2><pre tabindex=0><code>  config      Manage the Apache OpenServerless configuration
  setup       Setup the Apache OpenServerless platform on multiple environments
  debug       Debug utilities for the Apache OpenServerless platform
  util        Utilities
</code></pre><h2 id=openwhisk-tasks>OpenWhisk Tasks:</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>  action      Manage actions
</span></span><span style=display:flex><span>  invoke      Invoke an action (pass parameters with &lt;key&gt;=&lt;value&gt;)
</span></span><span style=display:flex><span>  url         Get the url of an action
</span></span><span style=display:flex><span>  activations Manage activations
</span></span><span style=display:flex><span>  logs        Show logs of activations
</span></span><span style=display:flex><span>  result      Show results of activations
</span></span><span style=display:flex><span>  package     Manage packages
</span></span><span style=display:flex><span>  trigger     Manage triggers
</span></span><span style=display:flex><span>  rule        Manage rules for triggers
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-b92302ba4aa446aa810640c0f09ead94>3.4.1 - config</h1><p><code>ops config</code></p><pre tabindex=0><code class=language-Usage: data-lang=Usage:>  config (enable|disable) [--all] [--redis] [--mongodb] [--minio] [--cron] [--static] [--postgres] [--prometheus] [--slack] [--mail] [--affinity] [--tolerations] [--quota]  
  config apihost (&lt;apihost&gt;|auto) [--tls=&lt;email&gt;] [--protocol=&lt;http/https&gt;|auto]
  config runtimes [&lt;runtimesjson&gt;]  
  config slack [--apiurl=&lt;slackapiurl&gt;] [--channel=&lt;slackchannel&gt;]
  config mail  [--mailuser=&lt;mailuser&gt;] [--mailpwd=&lt;mailpwd&gt;] [--mailfrom=&lt;mailfrom&gt;] [--mailto=&lt;mailto&gt;]
  config volumes [--couchdb=&lt;couchdb&gt;] [--kafka=&lt;kafka&gt;] [--pgvol=&lt;postgres&gt;] [--storage=&lt;storage&gt;] [--alerting=&lt;alerting&gt;] [--zookeeper=&lt;zookeeper&gt;] [--redisvol=&lt;redis&gt;] [--mongogb=&lt;mongodb&gt;]
  config controller [--javaopts=&lt;javaopts&gt;] [--loglevel=&lt;loglevel&gt;] [--replicas=&lt;replicas&gt;]
  config invoker [--javaopts=&lt;javaopts&gt;] [--poolmemory=&lt;poolmemory&gt;] [--timeoutsrun=&lt;timeoutsrun&gt;] [--timeoutslogs=&lt;timeoutslogs&gt;] [--loglevel=&lt;loglevel&gt;] [--replicas=&lt;replicas&gt;]
  config limits [--time=&lt;time&gt;] [--memory=&lt;memory&gt;] [--sequencelength=&lt;sequencelength&gt;] [--perminute=&lt;perminute&gt;] [--concurrent=&lt;concurrent&gt;] [--triggerperminute=&lt;triggerperminute&gt;] [--activation_max_payload=&lt;activation_max_payload&gt;]
  config storage [--class=&lt;storage_class&gt;] [--provisioner=&lt;storage_provisioner&gt;]
  config postgres [--failover] [--backup] [--schedule=&lt;cron_expression&gt;] [--replicas=&lt;replicas&gt;]
  config minio [--s3] [--console]  
  config aws [--access=&lt;access&gt;] [--secret=&lt;secret&gt;] [--region=&lt;region&gt;] [--image=&lt;image&gt;] [--vm=&lt;vm&gt;] [--vmuser=&lt;vmuser&gt;] [--disk=&lt;disk&gt;] [--key=&lt;key&gt;] 
  config eks [--access=&lt;access&gt;] [--secret=&lt;secret&gt;] [--region=&lt;region&gt;] [--name=&lt;name&gt;] [--count=&lt;count&gt;] [--vm=&lt;vm&gt;] [--disk=&lt;disk&gt;] [--key=&lt;key&gt;] [--kubever=&lt;kubever&gt;]
  config gcloud [--project=&lt;project&gt;] [--region=&lt;region&gt;] [--vm=&lt;vm&gt;] [--disk=&lt;disk&gt;] [--key=&lt;key&gt;] [--image=&lt;image&gt;]
  config gke [--name=&lt;name&gt;] [--project=&lt;project&gt;] [--region=&lt;region&gt;] [--count=&lt;count&gt;] [--vm=&lt;vm&gt;] [--disk=&lt;disk&gt;]
  config aks [--name=&lt;name&gt;] [--region=&lt;region&gt;] [--count=&lt;count&gt;]  [--vm=&lt;vm&gt;] [--disk=&lt;disk&gt;] [--key=&lt;key&gt;]
  config (status|export|reset)
  config use [&lt;n&gt;] [--delete] [--rename=&lt;rename&gt;]
  config minimal  
</code></pre><pre tabindex=0><code>  config apihost          configure the apihost (auto: auto assign) and enable tls
  config runtime          show the current runtime.json or import the &lt;runtime-json&gt; if provided
  config enable           enable OpenServerless services to install
  config disable          disable OpenServerless services to install
  config slack            configure Alert Manager over a given slack channel
  config mail             configure Alert Manager over a gmail account
  config volumes          configure the volume size distinguished in 3 categories (openwhisk couchdb &amp; kafka, database, minio storage, alerting)
  config controller       configure Openwhisk enterprise controller java options
  config invoker          configure Openwhisk enterprise invoker options
  config limits           configure Openwhisk actions limits
  config storage          allows to customize storage persistence class and provider
  config postgres         allows to customize enterprise options for nuvolaris default postgres deployment  
  config aws              configure Amazon Web Service (AWS) credentials and parameters
  config gcloud           configure Google Cloud credentials and parameters
  config eks              configure Amazon EKS Kubernetes Cluster
  config aks              configure Azure AKS Kubernetest Cluster
  config gke              configure Google Cloud GKE Kubernetest Cluster
  config reset            reset configuration
  config status           show current configuration
  config export           export all the variables
  config use              use a different kubernetes cluster among those you created
  config minimal          shortcut for ops config enabling only redis,mongodb,minio,cron,static,postgres
</code></pre><pre tabindex=0><code>  --all                 select all services
  --redis               select redis
  --mongodb             select mongodb (FerretDB Proxy)
  --minio               select minio
  --cron                select cron
  --static              select static
  --postgres            select postgres
  --tls=&lt;email&gt;         enable tls with let&#39;s encrypt, contact email required
  --access=&lt;access&gt;     specify access key
  --secret=&lt;secret&gt;     specify secret key  
  --name=&lt;name&gt;         specify name
  --region=&lt;region&gt;     specify region (AWS) location (Azure) or zone (GKE)
  --count=&lt;count&gt;       specify node count
  --vm=&lt;vm&gt;             specify vm type
  --disk=&lt;disk&gt;         specify disk size
  --key=&lt;key&gt;           specify ssh key name
  --kubever=&lt;kubever&gt;   specify kubernetes version
  --delete              delete the selected kubeconfig
  --image=&lt;image&gt;       specify gcp image type (default to ubuntu-minimal-2204-lts. Passing ubuntu-minimal-2204-lts-arm64 will create ARM based VM)
  --prometheus          select monitoring via Prometheus
  --slack               select alert manager module over slack channel
  --mail                select alert manager module over mail channel using a gmail account
  --affinity            select pod affinity for multinode enterprise deployment. In such case load will be splitted between node labeled with nuvolaris-role in core or invoker
  --tolerations         select pod tolerations for multinode enterprise deployment.
  --failover            select failover support on components supporting it as postgres
  --backup              select automatic backup on components support it as postgres
  --s3                  activate s3 compatible ingress on components supporting it
  --console             activate a s3console ingress on components supporting it (Currently MINIO)
  --quota               select quota checker module
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-c8a38269aa9c696d7d5b83c75c4d0ee0>3.4.2 - setup</h1><p>ops ent setup</p><pre tabindex=0><code>  setup devcluster [--uninstall|--status] 
  setup cluster [&lt;context&gt;] [--uninstall|--status]
  setup server &lt;server&gt; [&lt;user&gt;] [--uninstall|--status]
  setup status
  setup uninstall
  setup prereq
</code></pre><pre tabindex=0><code>  setup cluster       deploy Apache OpenServerless in the Kubernetes cluster using the &lt;context&gt;, default the current
  setup devcluster    deploy Apache OpenServerless in a devcluster created locally
                      you need Docker Desktop available with at least 6G of memory assigned
  setup server        create a Kubernetes in server &lt;server&gt; and deploy Apache OpenServerless
                      the server must be accessible with ssh using the &lt;user&gt; with sudo power, default root
  setup status        show the status of the last installation
  setup uninstall     uninstall the last installation
  setup prereq        validate current configuration
</code></pre><pre tabindex=0><code>  --uninstall         execute an uninstall instead of an installation 
  --status            show the status instead of an installation 
</code></pre><pre tabindex=0><code>  kubernetes          kubernetes subcommands
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-c808ce38575e73f72835d7ed02b03780>3.5 - Tools</h1><p>Available tool (embedded commands) in <code>ops</code>:</p></div><div class=td-content><h1 id=pg-27ce85a78a48fecdeaa223d6b60b9bb9>3.5.1 - base64</h1><p><code>base64</code> utility acts as a base64 decoder when passed the <code>--decode</code> (or -d) flag and as a base64 encoder
otherwise. As a decoder it only accepts raw base64 input and as an encoder it does not produce the framing
lines.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>  ops -base64 [options] &lt;string&gt;
</span></span></code></pre></div><h2 id=options>Options</h2><pre tabindex=0><code>  -h, --help             Display this help message
  -e, --encode &lt;string&gt;  Encode a string to base64
  -d, --decode &lt;string&gt;  Decode a base64 string
</code></pre><h2 id=examples>Examples</h2><h3 id=encoding>Encoding</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops -base64 -e <span style=color:#4e9a06>&#34;OpenServerless is wonderful&#34;</span>
</span></span></code></pre></div><p>This will output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>T3BlblNlcnZlcmxlc3MgaXMgd29uZGVyZnVs
</span></span></code></pre></div><h3 id=decoding>Decoding</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops -base64 -d <span style=color:#4e9a06>&#34;T3BlblNlcnZlcmxlc3MgaXMgd29uZGVyZnVs&#34;</span>
</span></span></code></pre></div><p>This will output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>OpenServerless is wonderful
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-7932ac2b4477bd1e28e9f99cc6850ede>3.5.2 - datefmt</h1><p>Print date with different formats. If no time stamp or date strings are given, uses current time</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>  ops -datefmt [options] [arguments]
</span></span></code></pre></div><h2 id=options>Options</h2><pre tabindex=0><code>    -h, --help		 print this help info
    -t, --timestamp	 unix timestamp to format (default: current time)
    -s, --str 	  	 date string to format
    --if			 input format to use with input date string (via --str)
    -f, --of		 output format to use (default: UnixDate)
</code></pre><p>Possible formats (they follows the standard naming of go time formats, with the addition of &lsquo;Millisecond&rsquo; and &lsquo;ms&rsquo;):</p><ul><li>Layout</li><li>ANSIC</li><li>UnixDate</li><li>RubyDate</li><li>RFC822</li><li>RFC822Z</li><li>RFC850</li><li>RFC1123</li><li>RFC1123Z</li><li>RFC3339</li><li>RFC3339Nano</li><li>Kitchen</li><li>Stamp</li><li>StampMilli</li><li>StampMicro</li><li>StampNano</li><li>DateTime</li><li>DateOnly</li><li>TimeOnly</li><li>Milliseconds</li><li>ms</li></ul><h2 id=example>Example</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ ops -datefmt -f DateTime
</span></span><span style=display:flex><span>2024-08-11 03:00:34
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-771bb4a3c7333d06a601254ab63e20cb>3.5.3 - echoif</h1><p><code>echoif</code> is a utility that echoes the value of <code>&lt;a></code> if the exit code of the previous command is 0,
echoes the value of <code>&lt;b></code> otherwise</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>    ops -echoif &lt;a&gt; &lt;b&gt;
</span></span></code></pre></div><h2 id=example>Example</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>$(</span> <span style=color:#204a87>exit</span> <span style=color:#0000cf;font-weight:700>1</span> <span style=color:#204a87;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span> ops -echoif <span style=color:#4e9a06>&#34;0&#34;</span> <span style=color:#4e9a06>&#34;1&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#0000cf;font-weight:700>1</span>
</span></span></code></pre></div><p>or</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>$(</span> <span style=color:#204a87>exit</span> <span style=color:#0000cf;font-weight:700>0</span> <span style=color:#204a87;font-weight:700>)</span><span style=color:#000;font-weight:700>;</span> ops -echoif <span style=color:#4e9a06>&#34;0&#34;</span> <span style=color:#4e9a06>&#34;1&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#0000cf;font-weight:700>0</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-7d915f0d4d6c781752d0a371929c3352>3.5.4 - echoifempty</h1><p><code>echoifempty</code> is a utility that echoes the value of <code>&lt;a></code> if <code>&lt;str></code> is empty, echoes the value of <code>&lt;b></code> otherwise.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>    ops -echoifempty &lt;str&gt; &lt;a&gt; &lt;b&gt;
</span></span></code></pre></div><h2 id=example>Example</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  ops -echoifempty <span style=color:#4e9a06>&#34;not empty string&#34;</span> <span style=color:#4e9a06>&#34;string is empty&#34;</span> <span style=color:#4e9a06>&#34;string is not empty&#34;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-86190bc978c4d2adda8dc9db5be23f15>3.5.5 - echoifexists</h1><p>echoifexists is a utility that echoes the value of <code>&lt;a></code> if <code>&lt;file></code> exists, echoes the value of <code>&lt;b></code> otherwise.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>    ops -echoifexists &lt;file&gt; &lt;a&gt; &lt;b&gt;
</span></span></code></pre></div><h2 id=example>Example</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>  ops -echoifexists <span style=color:#4e9a06>&#34;exists&#34;</span> <span style=color:#4e9a06>&#34;doesn&#39;t exists&#34;</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-957dcc702a96e2e23e576c933d3bc8b5>3.5.6 - empty</h1><p><code>empty</code> creates an empty file - returns error if it already exists.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>    ops -empty &lt;filename&gt;
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-8d2457cb6ed9caebbffb74a82bdb3d4a>3.5.7 - executable</h1><p><code>executable</code> make a file executable: on Unix-like systems it will do a chmod u+x.
On Windows systems it will rename the file to .exe if needed.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>    ops -executable &lt;filename&gt;
</span></span></code></pre></div><h2 id=example>Example</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops -executable kind
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-28776d09d77edb2f29290aa0d0317d1c>3.5.8 - extract</h1><p>Extract one single file from a .zip .tar, .tgz, .tar.gz, tar.bz2, tar.gz.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>    ops -extract file.(zip|tgz|tar[.gz|.bz2|.xz]) target
</span></span></code></pre></div><h2 id=example>Example</h2><p>Extract file named <code>single.pdf</code> from <code>archive.zip</code> archive.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops -extract archive.zip single.pdf
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-54aadb1a1239626b6e9e5e5d76e6f9ab>3.5.9 - filetype</h1><p>Show extension and MIME type of a file.
Supported types are documented <a href="https://github.com/h2non/filetype?tab=readme-ov-file#supported-types">here</a></p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>    ops -filetype [-h] [-e] [-m] FILE
</span></span></code></pre></div><h2 id=options>Options</h2><pre tabindex=0><code>-h  shows this help
-e  show file standard extension
-m  show file mime type
</code></pre><h2 id=examples>Examples</h2><h3 id=file-mime-type>File Mime type</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops -filetype -m <span style=color:#4e9a06>`</span>which ops<span style=color:#4e9a06>`</span>
</span></span></code></pre></div><p>This will output the ops executable type:
<code>application/x-mach-binary</code> or <code>application/x-executable</code></p></div><div class=td-content style=page-break-before:always><h1 id=pg-7a204ccf058880671046a598c0ab9206>3.5.10 - needupdate</h1><p>Check if a semver version A > semver version B.
Exits with 0 if greater, 1 otherwise.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>    ops -needupdate &lt;versionA&gt; &lt;versionB&gt;
</span></span></code></pre></div><h2 id=options>Options</h2><pre tabindex=0><code>    -h, --help		 print this help info
</code></pre><h2 id=examples>Examples</h2><h3 id=update-is-needed>Update is needed</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops -needupdate 1.0.1 1.0.0<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>echo</span> <span style=color:#000>$?</span>
</span></span></code></pre></div><p>This will output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>0
</span></span></code></pre></div><h3 id=update-is-not-needed>Update is not needed</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops -needupdate 1.0.0 1.0.1<span style=color:#000;font-weight:700>;</span> <span style=color:#204a87>echo</span> <span style=color:#000>$?</span>
</span></span></code></pre></div><p>This will output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>1
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-4d4e8dd2805d9c72fdcd8875d523b6fc>3.5.11 - opspath</h1><p>Join a relative path to the path from where <code>ops</code> was executed.
This command is useful when creating custom tasks ( e.g. an ops plugin).</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>    ops -opspath &lt;path&gt;
</span></span></code></pre></div><p>Options:</p><pre tabindex=0><code>-h, --help  print this help info
</code></pre><h2 id=examples>Examples</h2><h3 id=you-are-executing-in-directory-homeusermycustomdir>You are executing in directory <code>/home/user/my/custom/dir</code></h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops -opspath my-file.txt
</span></span></code></pre></div><p>This will output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>/home/user/my/custom/dir/my-file.txt
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-a11b9684bbdd698277d71db79d0dc3cd>3.5.12 - random</h1><p>Generate random numbers, strings and uuids</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>    ops -random [options]
</span></span></code></pre></div><h2 id=options>Options</h2><pre tabindex=0><code>-h, --help  shows this help
-u, --uuid  generates a random uuid v4
--int  &lt;max&gt; [min] generates a random non-negative integer between min and max (default min=0)
--str  &lt;len&gt; [&lt;characters&gt;] generates an alphanumeric string of length &lt;len&gt; from the set of &lt;characters&gt; provided (default &lt;characters&gt;=a-zA-Z0-9)
</code></pre><h2 id=examples>Examples</h2><h3 id=random-uuid-v4>Random uuid v4:</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops -random -u                 
</span></span></code></pre></div><p>This will output something like:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>5b2c45ef-7d15-4a15-84c6-29144393b621
</span></span></code></pre></div><h3 id=random-integer-between-max-and-min>Random integer between max and min</h3><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops -random --int <span style=color:#0000cf;font-weight:700>100</span> <span style=color:#0000cf;font-weight:700>60</span>
</span></span></code></pre></div><p>This will output something like:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>78
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-58f2e7983aeaee9bfd09b58381094395>3.5.13 - remove</h1><p>Remove a file</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>    ops -remove &lt;filename&gt;
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-15cce568fc445c0f72c6689d934503aa>3.5.14 - rename</h1><p>Rename a file</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>    ops -rename &lt;source&gt; &lt;destination&gt;
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-6d3b138f9ac0461dca4dfebacf8d9216>3.5.15 - retry</h1><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>    ops -retry [options] task [task options]
</span></span></code></pre></div><h2 id=options>Options</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>-h, --help	Print help message
</span></span><span style=display:flex><span>-t, --tries=#	Set max retries: Default 10
</span></span><span style=display:flex><span>-m, --max=secs	Maximum time to run (set to 0 to disable): Default 60 seconds
</span></span><span style=display:flex><span>-v, --verbose	Verbose output
</span></span></code></pre></div><h2 id=example>Example</h2><p>Retry two times to get the ops action list</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops -retry -t <span style=color:#0000cf;font-weight:700>2</span> ops action list
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-ac2f82cf229777ff21bbd04ac5673bbe>3.5.16 - sh</h1><p><code>sh</code> is the mvdan shell using the ops environment.</p><p>Without args, starts an interactive shell. Otherwise execute the script specified on command line.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage: 
</span></span><span style=display:flex><span>    ops sh [&lt;script&gt;|-h|--help]
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-d6d15458a9b424af5a6956daea9d60e6>3.5.17 - urlenc</h1><p>urlencode parameters using the default & separator (or a specific one using -s flag).
Optionally, encode the values retrieving them from environment variables.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>    ops -urlenc [-e] [-s &lt;string&gt;] [parameters]
</span></span></code></pre></div><h2 id=options>Options</h2><pre tabindex=0><code>-e    Encode parameter values from environment variables
-h    Show help
-s string  Separator for concatenating the parameters (default &#34;&amp;&#34;)
</code></pre><h2 id=examples>Examples</h2><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops -urlenc <span style=color:#000>a</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>1</span> <span style=color:#000>b</span><span style=color:#ce5c00;font-weight:700>=</span><span style=color:#0000cf;font-weight:700>2</span>
</span></span></code></pre></div><p>This will output:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>a%3D1&amp;b%3D2
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-1db8dce395fca4dfad1747b8a6b9b05e>3.5.18 - validate</h1><p>Check if a value is valid according to the given constraints.
If -e is specified, the value is retrieved from the environment variable with the given name.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>Usage:
</span></span><span style=display:flex><span>ops -validate [-e] [-m | -n | -r &lt;regex&gt;] &lt;value&gt; [&lt;message&gt;]
</span></span></code></pre></div><h2 id=options>Options:</h2><pre tabindex=0><code>-e    Retrieve value from the environment variable with the given name.
-h    Print this help message.
-m    Check if the value is a valid email address.
-n    Check if the value is a number.
-r string Check if the value matches the given regular expression.
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-273a1d3f87830cbffaaf95a64d1ab7e6>4 - Installation</h1><div class=lead>How to and where install OpenServerless</div><h2 id=installation>Installation</h2><h3 id=overview>Overview</h3><p>If you are in hurry and you think this guide is TL;DR (too long, don’t
read), please read at least our <a href=/docs/installation/quickstart/>Quick Start</a>
single page installation guide.</p><p>It gives you an overview of the installation process, omitting some more
advanced details. It can be enough to get you started and install
OpenServerless.</p><p>Once you want to know more, you can come back.</p><p>If you instead want the read the full documentation first, please read
on.</p><h3 id=steps-to-follow>Steps to follow</h3><p>OpenServerless can be installed in many environments, using our powerful
command line interface <code>ops</code>.</p><p>So you should start downloading the CLI <a href=/docs/installation/download/>from this
page</a>.</p><p>Once you installed <code>ops</code>, before installing you need to <a href=/docs/installation/prereq/>check the
prerequisites</a> for the installation, and satisfy
them</p><p>If the the prerequisites are OK, you can make your choices of what you
want to <a href=/docs/installation/configure/>Configure</a> your OpenServerless
installation.</p><p>Finally, once you have:</p><ol><li><p>downloaded <code>ops</code></p></li><li><p>satisfied the prerequisites</p></li><li><p>configured your installation</p></li></ol><p>you can choose where to install, either:</p><ul><li><p>in your <a href=/docs/installation/install/local/>Local machine</a></p></li><li><p>in a <a href=/docs/installation/install/server/>Linux server</a></p></li><li><p>in a <a href=/docs/installation/install/cluster/>Kubernetes cluster</a></p></li></ul><h3 id=post-installation>Post Installation</h3><p>After the installation, you can change later the configuration and
update the system.</p><h3 id=support>Support</h3><p>If you have issues, please check:</p><ul><li><p>the <a href=/docs/installation/debug/>Troubleshooting</a> page</p></li><li><p>our <a href=http://nuvolaris.discourse.group>Discussion forum</a></p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-8c3f05165c53384fa59c1453a0fb9b64>4.1 - Quick Start</h1><div class=lead>Fast path to install a self-hosted OpenServerless</div><h2 id=quick-start>Quick Start</h2><p>This is a quick start guide to the installation process, targeting
experienced users in a hurry.</p><p>It provides a high-level overview of the installation process, omitting
advanced of details. The missing pieces are covered in the rest of the
documentation.</p><p>Of course, if this guide is not enough and things fail, you can always
apply the rule: &ldquo;if everything fails, read the manual&rdquo;.</p><h2 id=prerequisites>Prerequisites</h2><p>Start ensuring the prerequsites are satisfied:</p><ul><li><p><a href=/docs/installation/download/>Download and install</a> <code>ops</code>, the
OpenServerless CLI, picking version suitable for your environment.
We support 64-bit versions of recent Windows, MacOS and major Linux
distributions.</p></li><li><p>Check that ops is correctly installed: open the terminal and write:</p><p>ops -info</p></li><li><p>Configure the services you want to enable. By default,
OpenServerless will install only the serverless engine, accessible
in http with no services enabled.</p></li></ul><p>If you want to enable all the services, use:</p><pre><code>ops config enable --all
</code></pre><p>otherwise pick the services you want, among <code>--redis</code>, <code>--mongodb</code>,
<code>--minio</code>, <code>--cron</code>, <code>--postgres</code>. Note that <code>--mongodb</code> is actually
<a href=https://www.ferretdb.com/>FerretDB</a> and requires Postgres which is
implicitly also enabled. More details <a href=/docs/installation/configure/>here</a>.</p><p>Now, choose where to install OpenServerless.</p><p>Your options are:</p><ul><li><p><a href=/docs/installation/quickstart/#locally>locally</a> in your workstation;</p></li><li><p>in a Linux <a href=/docs/installation/quickstart/#server>server</a> in your intranet</p></li><li><p>in a Linux <a href=/docs/installation/quickstart/#internet-server>server</a> available on Internet</p></li><li><p>in a Kubernetes <a href=/docs/installation/quickstart/#cluster>cluster</a> in your intranet</p></li><li><p>in <a href=/docs/installation/quickstart/#cloud-cluster>cloud</a>, where you can provision a Kubernetes
cluster</p></li></ul><h2 id=local-installation>Local Installation</h2><p>If you have a <strong>decent</strong> workstation (with at least 16GB of memory)
running a <strong>recent</strong> <strong>64-bit</strong> operating system, you can install
<a href=https://www.docker.com/products/docker-desktop/>Docker Desktop</a> and
then install OpenServerless in it. Once you have:</p><ol><li><p>installed the CLI</p></li><li><p>configured the services</p></li><li><p>installed Docker Desktop</p></li></ol><p>Make sure Docker Desktop its running before the next operation. Install OpenServerless and its services in Docker with just this
command:</p><pre><code>ops setup devcluster
</code></pre><p>Once it is installed, you can proceed to read the
<a href=/docs/installation/quickstart/#../../tutorial/index.adoc>tutorial</a> to learn how to code with it.</p><p>NOTE: At least 16GB of memory is ideal, but if you know what you’re
doing and can tolerate inefficiency, you can install with less using:</p><pre><code>export PREFL_NO_MEM_CHECK=1
export PLEFL_NO_CPU_CHECK=1
</code></pre><h2 id=internet-server-configuration>Internet Server Configuration</h2><p>If you have access to a server on the Internet, you will know its <strong>IP
address</strong>.</p><p>Many cloud providers also give you a DNS name usually derived by the IP
and very hard to remember such as
<code>ec2-12-34-56-78.us-west-2.compute.amazonaws.com</code>.</p><p>Once you got the IP address and the DNS name, you can give to your
server a bettername <a href=https://en.wikipedia.org/wiki/List_of_managed_DNS_providers>using a domain name
provider</a>.
We cannot give here precise instructions as there are many DNS providers
and each has different rules to do the setup. Check with your chosen
domain name provider.</p><p>If you have this name, configure it and enable DNS with:</p><pre><code>ops config apihost &lt;dns-name&gt; --tls=&lt;email-address&gt;
</code></pre><style>blockquote.warning{border-color:#b91900!important}blockquote.important{border-color:#e7c416!important}</style><blockquote class=important><p class=quote-title>❗ <strong>IMPORTANT</strong></p><p>Replace the <code>&lt;dns-name></code> with the actual DNS name, without using prefixes like <code>http://</code> or suffixes like <code>:443</code>. Also,
replace <email-address>` with your actual email address.</p></blockquote><p>then proceed with the server installation.</p><h2 id=server-installation>Server Installation</h2><p>Once you got access to a Linux server with:</p><ol><li><p>An IP address or DNS name, referred to as <code>&lt;server></code></p></li><li><p>Passwordless access with <code>ssh</code> to a Linux user <code>&lt;user></code></p></li><li><p>At least 8GB of memory and 50GB of disk space available</p></li><li><p>The user <code>&lt;user></code> has passwordless <code>sudo</code> rights</p></li><li><p>The firewall that allows traffic to ports 80, 443 and 6443</p></li><li><p><strong>Without</strong> any Docker or Kubernetes installed</p></li><li><p><strong>Without</strong> any Web server or Web application installed</p></li></ol><p>then you can install OpenServerless in it.</p><p>The server can be physical or virtual. We need Kubernetes in it but the
installer takes care of installing also a flavor of Kubernetes,
<a href=https://k3s.io>K3S</a>, courtesy of
<a href=https://github.com/alexellis/k3sup>K3Sup</a>.</p><p>To install OpenServerless, first check you have access to the server
with:</p><pre><code>ssh &lt;user&gt;@&lt;server&gt; sudo hostname
</code></pre><p>You should see no errors and read the internal hostname of your server.</p><p>If you do not receive errors, you can proceed to install OpenServerless
with this command:</p><pre><code>ops setup server &lt;server&gt; &lt;user&gt;
</code></pre><style>blockquote.warning{border-color:#b91900!important}blockquote.important{border-color:#e7c416!important}</style><blockquote class=important><p class=quote-title>❗ <strong>IMPORTANT</strong></p><p>Replace in the commands <code>&lt;server></code> with the address of your server, and
<code>&lt;user></code> with the actual user to use in your server. The <code>&lt;server></code> can
be the same as <code>&lt;dns-name></code> you have configured in the previous
paragraph, if you did so, or simply the IP address of a server on your
intranet.</p></blockquote><p>Now wait until the installation completes. Once it is installed, you can
proceed to read the <a href=/docs/installation/quickstart/#tutorial:index.adoc>tutorial</a> to learn how to
code with it.</p><h2 id=cloud-cluster-provisioning>Cloud Cluster Provisioning</h2><p>If you have access to a cloud provider, you can set up a Kubernetes
cluster in it. The Kubernetes cluster needs to satisfy certain
<a href=/docs/installation/quickstart/#../prereq/kubernetes/cluster/index.adoc>prerequisites</a> to be able to
install OpenServerless with no issues.</p><p>We provide the support to easily configure and install a compliant
Kubernetes cluster for the following clouds:</p><ul><li><p><a href=/docs/installation/quickstart/#aws>Amazon AWS</a></p></li><li><p><a href=/docs/installation/quickstart/#azure>Microsoft Azure</a></p></li><li><p><a href=/docs/installation/quickstart/#gcloud>Google Cloud</a></p></li></ul><p>At the end of the installation you will have available and accessible a
Kubernetes Cluster able to install OpenServerless, so proceed with a
<a href=/docs/installation/quickstart/#cluster>cluster installation</a>.</p><h3 id=amazon-aws>Amazon AWS</h3><p>Configure and install an Amazon EKS cluster on Amazon AWS with:</p><pre><code>ops config eks
ops cloud eks create
</code></pre><p>then <a href=/docs/installation/quickstart/#cluster>install the cluster</a>.</p><h3 id=azure-aks>Azure AKS</h3><p>Configure and install an Azure AKS cluster on Microsoft Azure with:</p><pre><code>ops config aks
ops cloud aks create
</code></pre><p>then <a href=/docs/installation/quickstart/#cluster>install the cluster</a>.</p><h3 id=google-cloud-gke>Google Cloud GKE</h3><p>Configure and install a Google Cloud GKE with:</p><pre><code>ops config gke
ops cloud gke create
</code></pre><p>then <a href=/docs/installation/quickstart/#cluster>install the cluster</a>.</p><h2 id=cluster-install>Cluster Install</h2><p>In short, if you have access to kubernetes cluster, you can install
OpenServerless with:</p><pre><code>ops setup cluster
</code></pre><p>For a slightly longer discussion, checking prerequisites before
installing, read on.</p><h3 id=prerequisites-to-install>Prerequisites to install</h3><p>If you have access to a Kubernetes cluster with:</p><ol><li><p>Access to the <code>cluster-admin</code> role</p></li><li><p>Block storage configured as the default storage class</p></li><li><p>The <code>nginx-ingress</code> installed</p></li><li><p>Knowledge of the IP address of your <code>nginx-ingress</code> controller</p></li></ol><p>you can install OpenServerless in it. You can read <a href=/docs/installation/quickstart/#../prereq/kubernetes/cluster/index.adoc>more details
here</a>.</p><p>You can get this access either by provisioning a Kubernetes cluster in
<a href=/docs/installation/quickstart/#cloud-cluster>cloud</a> or getting access to it from your system
administrator.</p><p>Whatever the way you get access to your Kubernetes cluster, you will end
up with a configuration file which is usually stored in a file named
<code>.kube/config</code> in your home directory. This file will give access to the
Kubernetes cluster to install OpenServerless.</p><h3 id=performing-the-installation>Performing the installation</h3><p>To install, first, verify you have actually access to the Kubernetes
cluster, by running this command:</p><pre><code>ops debug kube info
</code></pre><p>You should get information about your cluster, something like this:</p><p>Kubernetes control plane is running at
<code>\https://api.nuvolaris.osh.n9s.cc:6443</code></p><p>Now you can finally install OpenServerless with the command:</p><pre><code>ops setup cluster
</code></pre><p>Wait until the process is complete and if there are no errors,
OpenServerless is installed and ready to go.</p><p>Once it is installed, you can proceed to read the
<a href=/docs/installation/quickstart/#../../tutorial/index.adoc>Tutorial</a> to learn how to code with it.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-1642ee41003decf99634e3d9c714851c>4.2 - Download</h1><div class=lead>Download OpenServerless with ops CLI</div><h2 id=download-and-install-ops>Download and Install <code>ops</code></h2><h3 id=what-is-ops>What is <code>ops</code>?</h3><p>As you can guess it helps with operations: ops is the <strong>OP</strong>en<strong>S</strong>erverless CLI.</p><p>It is a task executor on steroids.</p><ul><li>it embeds task, wsk and a lot of other utility commands (check with ops -help)</li><li>automatically download and update command line tools, prerequisites and tasks</li><li>taskfiles are organized in commands and subcommands, hierarchically and are powered by docopt</li><li>it supports plugins</li></ul><p>The predefined set of tasks are all you need to install and manage an OpenServerless cluster.</p><h3 id=download-links>Download links</h3><p>You can install OpenServerless using its Command Line Interface, <code>ops</code>.</p><style>blockquote.warning{border-color:#b91900!important}blockquote.important{border-color:#e7c416!important}</style><blockquote class=warning><p class=quote-title>⚠ <strong>WARNING</strong></p><p>Since we are in a preview phase, this is not an official link approved by the Apache Software Foundation.</p></blockquote><p>Quick install in Linux, MacOS and Windows with WSL or GitBash:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -sL bit.ly/get-ops <span style=color:#000;font-weight:700>|</span> bash
</span></span></code></pre></div><p>Quick install in Windows with PowerShell</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#204a87>irm </span><span style=color:#000>bit</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ly</span><span style=color:#000;font-weight:700>/</span><span style=color:#204a87>get-ops</span><span style=color:#000>-exe</span> <span style=color:#000;font-weight:700>|</span> <span style=color:#204a87>iex
</span></span></span></code></pre></div><h3 id=after-the-installation>After the installation</h3><p>Once installed, in the first run <code>ops</code> will tell to update the tasks
executing:</p><p><code>ops -update</code></p><p>This command updates the OpenServerless &ldquo;tasks&rdquo; (its internal logic) to the
latest version. This command should be also executed frequently, as the
tasks are continuously evolving and expanding.</p><p><code>ops</code> will suggest when to update them (at least once a day).</p><p>You normally just need to update the tasks but sometimes you also need
to update <code>ops</code> itself. The system will detect when it is the case and
tell you what to do.</p><h3 id=where-to-find-more-details>Where to find more details:</h3><p>For more details, please visit the Github page of <a href=https://github.com/apache/openserverless-cli>Openserverless Cli</a></p></div><div class=td-content style=page-break-before:always><h1 id=pg-d88677d4167778f5d3ca8a81629227c5>4.3 - Prerequisites</h1><h2 id=prerequisites-to-install-openserverless>Prerequisites to install OpenServerless</h2><p>This page lists the prerequisites to install OpenServerless in various
environments.</p><p>You can install OpenServerless:</p><ul><li><p>for <strong>development</strong> in a <a href=/docs/installation/prereq/#single-node-development-installation>single node</a> environment,
either in your local machine or in a Linux server.</p></li><li><p>for <strong>production</strong>, in a <a href=/docs/installation/prereq/#multi-node-production-installation>multi node</a> environment
provided by a Kubernetes cluster.</p></li></ul><h3 id=single-node-development-installation>Single Node development installation</h3><p>For <strong>development</strong> purposes, you can install a single node
OpenServerless deployment in the following environments as soon as the
following requirements are satisfied:</p><ul><li><p>To install in your <a href=/docs/installation/install/local/>local machine</a>, you need
<a href=/docs/installation/prereq/docker/>Docker Desktop</a></p></li><li><p>To install in a <strong>single node</strong>
<a href=/docs/installation/install/server/>Linux server</a>, you need a server with <a href=/docs/installation/prereq/server/>passwordless ssh access and sudo</a>.</p></li></ul><p>Our installer can automatically install a Kubernetes environment, using
<a href=https://k3s.io>K3S</a>, but if you prefer you can install a single-node
Kubernetes instance by yourself.</p><p>If you choose to install Kubernetes on your server, we provide support
for:</p><ul><li><p><a href=/docs/installation/prereq/k3s/>SuSE K3S</a></p></li><li><p><a href=/docs/installation/prereq/mk8s>Canonical MicroK8S</a></p></li></ul><h3 id=multi-node-production-installation>Multi Node production installation</h3><p>For <strong>production</strong> purposes, you need a multi-node Kubernetes cluster
that satisfies <a href=/docs/installation/prereq/kubernetes/>those requirements</a>,
accessible with its <code>kubeconfig</code> file.</p><p>If you have such a cluster, you can install
<a href=/docs/installation/install/cluster/>OpenServerless in a Kubernetes cluster</a></p><p>If you do not have a cluster and you need to setup one, we provide
support for provisioning a suitable cluster that satisfied our
requirements for the following Kubernetes environments:</p><ul><li><p><a href=/docs/installation/prereq/kubernetes/eks/>EKS in Amazon AWS</a></p></li><li><p><a href=/docs/installation/prereq/kubernetes/aks/>AKS in Microsoft Azure</a></p></li><li><p><a>GKE in Google Cloud</a></p></li><li><p><a>RedHat OpenShift</a></p></li></ul><p>Once you have a suitable Kubernetes cluster, you can proceed
<a href=/docs/installation/install/>installing OpenServerless</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-0224021be1c39f3dd5683066e33d007c>4.3.1 - Local Docker</h1><div class=lead>Install OpenServerless with Docker locally</div><h2 id=prerequisites-to-install-openserverless-with-docker>Prerequisites to install OpenServerless with Docker</h2><p>You can install OpenServerless on your local machine using Docker. This
page lists the prerequisits.</p><p>First and before all you need a computer with at least 16 GB of memory
and 30GB of available space.</p><blockquote><p>❗ <strong>IMPORTANT</strong></p><p>8GB are definitely <strong>not enough</strong> to run OpenServerless on your local
machine.</p></blockquote><p>Furthermore, you need to install Docker. Let’s see the which one to
install and configure if you have:</p><ol><li><a href=/docs/installation/prereq/docker/#windows>Windows</a></li><li><a href=/docs/installation/prereq/docker/#macos>MacOS</a></li><li><a href=/docs/installation/prereq/docker/#linux>Linux</a></li></ol><h3 id=windows>Windows</h3><p>You require the 64 bit edition in Intel Architecture of a recent version
of Windows (at least version 10). The installer <code>ops</code> does not run on 32
bit versions nor in the ARM architecture.</p><p>Download and install <a href=https://www.docker.com/products/docker-desktop/>Docker
Desktop</a> for Windows.</p><p>Once installed, you can proceed
<a href=/docs/installation/configure/>configuring OpenServerless</a> for the
installation.</p><h3 id=macos>MacOS</h3><p>You require a recent version of MacOS (at least version 11.xb BigSur).
The installer <code>ops</code> is available both for Intel and ARM.</p><p>Download and install <a href=https://www.docker.com/products/docker-desktop/>Docker
Desktop</a> for MacOS.</p><p>Since MacOS uses a virtual machine for Docker with a constrained memory.
you also need also to reserve at least 8GB.</p><blockquote><p>❗ <strong>IMPORTANT</strong></p><p>On MacOS, Docker defaults to 2GB memoery and they are definitely <strong>not enough</strong> to run
OpenServerless on your local machine.</p></blockquote><p><img src=/docs/installation/images/install_docker_desktop.png></p><p>Instructions to increase the memory reserved to Docker Desktopo on
MacOS:</p><ul><li><p>click on the Docker Desktop icon in the menu</p></li><li><p>select Preferences</p></li><li><p>click on Resources</p></li><li><p><em>increase the reserved memory up to (at least) 8GB</em></p></li><li><p>click on <code>Apply & Restart</code></p></li></ul><p>Once installed, you can proceed
<a href=/docs/installation/configure/>configuring OpenServerless</a> for the installation.</p><h3 id=linux>Linux</h3><p>Docker Desktop is available also on Linux, however we advice to install
instead the <a href=https://docs.docker.com/engine/install/#server>Server Docker
Engine</a></p><p>On Linux, the Docker Engine for the server does not run in a virtual
machine, so it is faster and uses less memory.</p><p>Once installed, you can proceed
<a href=/docs/installation/configure/>configuring OpenServerless</a> for the installation.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-b0ef4b2e79b17c0bf42df9cbc4da7029>4.3.2 - Linux Server</h1><div class=lead>Install OpenServerless in a Linux server</div><h2 id=prerequisites-to-install-openserverless-in-a-linux-server>Prerequisites to install OpenServerless in a Linux server</h2><p>You can install OpenServerless on any server either in your intranet or
on in Internet running a Linux distribution, with the following
requirements:</p><ol><li><p>You know the <strong>IP address or DNS name</strong> of the server on Internet or
in your Intranet.</p></li><li><p>The server requires at least 8GB of memory and 30GB of disk space
available.</p></li><li><p>It should be running a Linux distribution <a href=https://docs.k3s.io/installation/requirements>supported by
K3S</a>.</p></li><li><p>You must open the firewall to access ports 80, 443 and 6443 (for
K3S) or 16443 (for MicroK8S) from your machine.</p></li><li><p>You have to install a
<a href=/docs/installation/prereq/server/generic/#ssh>public ssh key</a> to access it
without a password.</p></li><li><p>You have to configure
<a href=/docs/installation/prereq/server/generic/#sudo>sudo</a> to execute root
commands without a password.</p></li></ol><p>You can:</p><ul><li><p>get a server on any cloud provider or even install by yourself and
then <a href=/docs/installation/prereq/server/generic/>configure it</a></p></li><li><p>provision such a server with <code>ops</code>
<a href=/docs/installation/prereq/server/aws/>on Amazon Web Services</a></p></li><li><p>provision such a server with <code>ops</code> on
<a>on Google Cloud Platform</a></p></li></ul><p>Once you have such a server you can optionally (it is not required)
install <a href=/docs/installation/prereq/server/k3s/>K3S</a> or
<a href=/docs/installation/prereq/server/mk8s/>MicroK8S</a> in it.</p><p>Once you have configured you server, you can proceed
<a href=/docs/installation/configure/>configuring OpenServerless</a> for the installation.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c8f8a7091cc35f968fc5e121e51c459b>4.3.2.1 - SSH and Sudo</h1><div class=lead>General prerequisites to install OpenServerless</div><h2 id=configure-a-generic-linux-server-to-install-openserverless>Configure a generic Linux server to install OpenServerless</h2><p>If you have access to a generic Linux server, to be able to install
OpenServerless it needs to:</p><ol><li><p>be accessible without a password with <code>ssh</code></p></li><li><p>be able to run root commands without a password with <code>sudo</code></p></li><li><p>open the ports 80, 443 and 6443 or 16443</p></li></ol><p>If your server does not already satisfy those requirements, read below
for information how to create a <a href=/docs/installation/prereq/server/generic/#sshkey>sshkey</a>,
<a href=/docs/installation/prereq/server/generic/#sudo>configure sudo</a> and <a href=/docs/installation/prereq/server/generic/#firewall>open the firewall</a></p><h3 id=sshkey>Installing a public SSH key</h3><p>To connect to a server without a password using <code>openssh</code> (used by the
installer), you need a couple of files called <strong>ssh keys</strong>.</p><p>You can generate them on the command line using this command:</p><pre><code>ssh-keygen
</code></pre><p>It will create a couple of files, typically called:</p><ul><li><p><code>~/.ssh/id_rsa</code></p></li><li><p><code>~/.ssh/id_rsa.pub</code></p></li></ul><p>where <code>~</code> is your home directory.</p><p>You have to keep secret the <code>id_rsa</code> file because it is the private key
and contains the information to identify you uniquely. Think to is as
your password.</p><p>You can copy the <code>id_rsa.pub</code> in the server or even share it publicly,
as it is the public key. Think to it as your login name, and adding this
file to the server adds you to the users who can login into it.</p><p>Once you have generated the public key, access your server, then edit
the file <code>~/.ssh/authorized_keys</code> adding the public key to it.</p><p>It is just one line, contained in the <code>id_rsa.pub</code> file.</p><p>Create the file if it does not exist. Append the line to the file (as a
single line) if it already exists. Do not remove other lines if you do
not want to remove access to other users.</p><h3 id=sudo>Configure Sudo</h3><p>You normally access Linux servers using a user that is <strong>not</strong> <code>root</code>
(the system administrator with unlimited power on the system).</p><p>Depending on the system, the user to use to access be <code>ubuntu</code>,
<code>ec2-user</code>, <code>admin</code> or something else entirely. However if you have
access to the server, the information of which user to use should have
been provided, including a way to access to the <code>root</code> user.</p><p>You need to give this user the right to execute commands as <code>root</code>
without a password, and you do this by configuring the command <code>sudo</code>.</p><p>You usually have either access to root with the <code>su</code> command, or you can
execute <code>sudo</code> with a password.</p><p>Type either <code>su</code> or <code>sudo bash</code> to become root and edit the file
<code>/etc/sudoers</code> adding the following line:</p><pre><code>&lt;user&gt; ALL=(ALL) NOPASSWD:ALL
</code></pre><p>where <code>&lt;user></code> is the user you use to log into the system.</p><h3 id=firewall>Open the firewall</h3><p>You need to open the following ports in the firewall of the server:</p><ul><li><p>443 for HTTPS</p></li><li><p>80 for HTTP and provisioning certificates</p></li><li><p>6443 (K3S) or 16443 (MicroK8S) for Kubernetes</p></li></ul><p>For information on how to open the firewall, please consult the
documentation of your cloud provider or contact your system
administrator, as there are no common procedures and they depends on the
cloud provider.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-7de93c022dce0399d0fb529ba96bc7e6>4.3.2.2 - Server on AWS</h1><div class=lead>Prerequisites to install OpenServerless in AWS</div><h2 id=provision-a-linux-server-in-amazon-web-services>Provision a Linux server in Amazon Web Services</h2><p>You can provision a server suitable to install OpenServerless in cloud
provider <a href=https://aws.amazon.com/>Amazon Web Services</a>
<a href=/docs/installation/prereq/server/aws/#download.adoc>ops</a> as follows:</p><ol><li><p>install <code>aws</code>, the <a href=/docs/installation/prereq/server/aws/#install-cli>AWS CLI</a></p></li><li><p>get <a href=/docs/installation/prereq/server/aws/#get-credentials>Access and Secret Key</a></p></li><li><p><a href=/docs/installation/prereq/server/aws/#configure>configure AWS</a></p></li><li><p><a href=/docs/installation/prereq/server/aws/#provision>provision a server</a></p></li><li><p>retrieve the <a href=/docs/installation/prereq/server/aws/#retrieve-ip>ip address</a> to configure a DNS name</p></li></ol><p>Once you have a Linux server up and running you can proceed
<a href=/docs/installation/configure/>configuring</a> and
<a href=/docs/installation/install/cluster/>installing OpenServerless</a>.</p><h3 id=install-cli>Installing the AWS CLI</h3><p>Our cli <code>ops</code> uses under the hood the <a href=https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html>AWS CLI version
2</a>,
so you need to dowload and install it <a href=https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html>following those
instructions</a>.</p><p>Once installed, ensure it is available on the terminal executing the
following command:</p><pre><code>aws --version
</code></pre><p>you should receive something like this:</p><pre><code>aws-cli/2.9.4 Python/3.9.11 Linux/5.19.0-1025-aws exe/x86_64.ubuntu.22 prompt/off
</code></pre><p>Ensure the version is at least 2.</p><h3 id=get-credentials>Getting the Access and Secret key</h3><p>Next step is to retrieve credentials, in the form of an access key and a
secret key.</p><p>So you need to:</p><ul><li>access the AWS console
<a href=https://repost.aws/knowledge-center/create-access-key>following those instructions</a>
create an access key and secret key;</li><li>give to the credentials the minimum required permissions
<a href=https://eksctl.io/usage/minimum-iam-policies/>as described here</a> to build an
EKS cluster.</li></ul><p>You will end up with a couple of string as follows:</p><pre><code>Sample AWS Access Key ID: AKIAIOSFODNN7EXAMPLE Sample AWS Secret Access
Key: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
</code></pre><p>Take note of them as you need them for configuring out CLI.</p><h3 id=configure>Configure AWS to provision a server</h3><p>Before you can provision a Linux server you have to configure AWS typing
the command:</p><pre><code>ops config aws
</code></pre><p>The system will then ask the following questions:</p><pre><code>*** Please, specify AWS Access Id and press enter.
AKIAIOSFODNN7EXAMPLE

*** Please, specify AWS Secret Key and press enter.
wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
*** Please, specify AWS Region to use and press enter.
To get a list of valid values use:
  aws ec2 describe-regions --output table

Just press enter for default [us-east-1]:

*** Please, specify AWS public SSH key  and press enter.
If you already have a public SSH key in AWS, provide its name here.
If you do not have it, generate a key pair with the following command:
  ssh-keygen
The public key defaults to ~/.ssh/id_rsa.pub and you can import with:
  aws ec2 import-key-pair --key-name nuvolaris-key --public-key-material --region=&lt;your-region&gt; fileb://~/.ssh/id_rsa.pub

Just press enter for default [devkit-74s]:

*** Please, specify AWS Image to use for VMs and press enter.
The suggested image is an Ubuntu 22 valid only for us-east-1
Please check AWS website for alternative images in other zones

Just press enter for default [ami-052efd3df9dad4825]:

*** Please, specify AWS Default user for image to use for VMs and press enter.
Default user to access the selected image.

Just press enter for default [ubuntu]:

*** Please, specify AWS Instance type to use for VMs and press enter.
The suggested instance type has 8GB and 2vcp
To get a list of valid values, use:
aws ec2 describe-instance-types --query 'InstanceTypes[].InstanceType' --output table

Just press enter for default [t3a.large]:

*** Please, specify AWS Disk Size to use for VMs and press enter.
Just press enter for default [100]:
</code></pre><h3 id=provision>Provision a server</h3><p>You can provision one or more servers using <code>ops</code>. The servers will use
the parameters you have just configured.</p><p>You can create a new server with:</p><pre><code>ops cloud aws vm-create &lt;server-name&gt;
</code></pre><blockquote><p>❗ <strong>IMPORTANT</strong></p><p>Replace <code>&lt;server-name></code> with a name you choose, for example
<code>ops-server</code></p></blockquote><p>The command will create a new server in AWS with the parameters you
specified in configuration.</p><p>You can also:</p><ol><li><p>list servers you created with <code>ops cloud aws vm-list</code></p></li><li><p>delete a server you created and you do not need anymore with
<code>ops cloud aws vm-delete &lt;server-name></code></p></li></ol><h3 id=retrieve-ip>Retrieve IP</h3><p>The server will be provisioned with an IP address assigned by AWS.</p><p>You can read the IP address of your server with</p><pre><code>ops cloud aws vm-getip &lt;server-name&gt;
</code></pre><p>You need this IP when <a href=/docs/installation/configure/dns/>configuring a DNS name</a> for
the server.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-3a59e283e51e41b6d5b36b0ca31c690c>4.3.2.3 - Server on Azure</h1><div class=lead>Prerequisites to install OpenServerless in Azure</div><h2 id=provision-a-linux-server-in-azure-cloud-platform>Provision a Linux server in Azure Cloud Platform</h2><p>You can provision a server suitable to install OpenServerless in cloud
provider <a href=https://azure.microsoft.com/>Azure</a>
<a href=/docs/installation/prereq/server/azure/#download.adoc>ops</a> as follows:</p><ol><li><p>install <code>az</code>, the <a href=/docs/installation/prereq/server/azure/#install-cli>Azure CLI</a></p></li><li><p>get <a href=/docs/installation/prereq/server/azure/#connect-subscription>Access and Secret Key</a></p></li><li><p><a href=/docs/installation/prereq/server/azure/#configure>configure Azure</a></p></li><li><p><a href=/docs/installation/prereq/server/azure/#provision>provision a server</a></p></li><li><p>retrieve the <a href=/docs/installation/prereq/server/azure/#retrieve-ip>ip address</a> to configure a DNS name</p></li></ol><p>Once you have a Linux server up and running you can proceed
<a href=/docs/installation/configure/>configuring</a> and
<a href=/docs/installation/install/cluster/>installing OpenServerless</a>.</p><h3 id=install-cli>Installing the Azure CLI</h3><p>Our cli <code>ops</code> uses under the hood the <a href=https://learn.microsoft.com/en-us/cli/azure>az</a>,
command so you need to dowload and install it <a href=https://learn.microsoft.com/en-us/cli/azure/install-azure-cli>following those
instructions</a>.</p><p>Once installed, ensure it is available on the terminal executing the
following command:</p><pre><code>az version
</code></pre><p>you should receive something like this:</p><pre><code>{
    &quot;azure-cli&quot;: &quot;2.64.0&quot;,
    &quot;azure-cli-core&quot;: &quot;2.64.0&quot;,
    &quot;azure-cli-telemetry&quot;: &quot;1.1.0&quot;,
    &quot;extensions&quot;: {
        &quot;ssh&quot;: &quot;2.0.5&quot;
    }
}
</code></pre><p>Ensure the version is at least 2.64.0</p><h3 id=connect-subscription>Connect a subscription</h3><p>Next step is to connect <code>az</code> to a valid Azure subscription. Azure
supports <a href=https://learn.microsoft.com/en-us/cli/azure/authenticate-azure-cli>several authentication methods</a>: check
which one you prefer.</p><p>The easiest is the one described in <a href=https://learn.microsoft.com/en-us/cli/azure/authenticate-azure-cli-interactively>Sign in interactively</a>:</p><p>az login</p><p>This will open a browser and you will asked to login to you azure account. Once logged in, the <code>az</code> command will be
automatically connected to the choosen subscription.</p><p>To check if the <code>az</code> command is properly connected to your subscription, check the output of this command:</p><pre tabindex=0><code>   $ az account list --query &#34;[].{subscriptionId: id, name: name, user: user.name}&#34; --output table

   SubscriptionId                        Name                         User
   ------------------------------------  ---------------------------  -------------------------
   xxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxxx  Microsoft Azure Sponsorship  openserverless@apache.org
</code></pre><h3 id=configure>Configuring Azure to provision a server</h3><p>Before you can provision a Linux server you have to configure Openserverless for Azure typing
the command:</p><pre><code>ops config azcloud
</code></pre><p>The system will then ask the following questions:</p><pre tabindex=0><code>   *** Please, specify Azure Project Id and press enter.
   Azure Project Id: openserverless-k3s
   *** Please, specify Azure Zone and press enter.
   To get a list of valid values use:
      az account list-locations -o table
   
   Just press enter for default [eastus]:
   Azure Zone:

   *** Please, specify Azure virtual machine type and press enter.
   To get a list of valid values, use:
     az vm list-sizes --location &lt;location&gt; -o table
   where &lt;location&gt; is your current location.
   
   Just press enter for default [Standard_B4ms]:
   Azure virtual machine type:
   
   *** Please, specify Azure vm disk size in gigabyte and press enter.
   Just press enter for default [50]:
   Azure vm disk size in gigabyte:
   
   *** Please, specify Azure Cloud public SSH key and press enter.
   If you already have a public SSH key provide its path here. If you do not have it, generate a key pair with the following command:
     ssh-keygen
   The public key defaults to ~/.ssh/id_rsa.pub.
   
   Just press enter for default [~/.ssh/id_rsa.pub]:
   Azure Cloud public SSH key:
   
   *** Please, specify Azure Cloud VM image and press enter.
   Just press enter for default [Ubuntu2204]:
   Azure Cloud VM image:
</code></pre><h3 id=provision>Provision a server</h3><p>You can provision one or more servers using <code>ops</code>. The servers will use
the parameters you have just configured.</p><p>You can create a new server with:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>    ops cloud azcloud vm-create &lt;server-name&gt;
</span></span></code></pre></div><style>blockquote.warning{border-color:#b91900!important}blockquote.important{border-color:#e7c416!important}</style><blockquote class=important><p class=quote-title>❗ <strong>IMPORTANT</strong></p><p>Replace <code>&lt;server-name></code> with a name you choose, for example
<code>ops-server</code></p></blockquote><p>The command will create a new server in Azure Cloud with the parameters
you specified in configuration.</p><p>You can also:</p><ol><li><p>list servers you created with <code>ops cloud azcloud vm-list</code></p></li><li><p>delete a server you created and you do not need anymore with
<code>ops cloud azcloud vm-delete &lt;server-name></code></p></li></ol><h3 id=retrieve-ip>Retrieve IP</h3><p>The server will be provisioned with an IP address assigned by Azure
Cloud.</p><p>You can read the IP address of your server with</p><pre><code>ops cloud azcloud vm-getip &lt;server-name&gt;
</code></pre><p>You need this IP when <a href=/docs/installation/configure/dns/>configuring a DNS name</a> for
the server.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8e157365d16cb8fe54ef2c7d50505022>4.3.2.4 - Install K3S</h1><div class=lead>Prerequisites to install OpenServerless in K3S</div><h2 id=install-k3s-in-a-server>Install K3S in a server</h2><p>You can install OpenServerless as <a href=/docs/installation/prereq/server/k3s/#../../../install/server/index.adoc>described
here</a>, and you do not need to
install any Kubernetes in it, as it is installed as part of the
procedure. In this case it installs <a href=https://k3s.io>K3S</a>.</p><p>Or you can <a href=/docs/installation/prereq/server/k3s/#installing-k3s>install K3S in advance</a>, and then proceed
<a href=/docs/installation/prereq/server/k3s/#../../../configure/index.adoc>configuring</a> and then installing
OpenServerless <a href=/docs/installation/prereq/server/k3s/#../../../install/cluster/index.adoc>as in any other Kubernetes
cluster</a>.</p><h3 id=installing-k3s>Installing K3S in a server</h3><p>Before installing ensure you have <a href=/docs/installation/prereq/server/k3s/#../../../prereq/index.adoc>satified the
prerequisites</a>, most notably:</p><ol><li><p>you know the <strong>IP address or DNS name</strong></p></li><li><p>your server operating system satisfies the <a href=https://docs.k3s.io/installation/requirements>K3S
requirements</a></p></li><li><p>you have passwordless access with ssh</p></li><li><p>you have a user with passwordless sudo rights</p></li><li><p>you have opened the port 6443 in the firewall</p></li></ol><p>Then you can use the following subcommand to install in the server:</p><pre><code>ops cloud k3s create &lt;server&gt; [&lt;username&gt;]
</code></pre><p>where <code>&lt;server></code> is the <strong>IP address or DNS name</strong> to access the server,
and the optional <code>&lt;username></code> is the user you use to access the server:
if <username>is not specified, the <code>root</code> username will be used.</p><p>Those pieces of information should have been provided when provisioning
the server.</p><blockquote><p>❗ <strong>IMPORTANT</strong></p><p>If you installed a Kubernetes cluster in the server this way, you should
proceed installing OpenServerless as in
<a href=/docs/installation/install/cluster/>a Kubernetes cluster</a>, <strong>not</strong>
as a server.</p></blockquote><p>The installation retrieves also a Kubernetes configuration file, so you
can proceed to installing it without any other step involved.</p><h3 id=additional-commands>Additional Commands</h3><p>In addition to <code>create</code> the following subcommands are also available:</p><ul><li><p><code>ops cloud k3s delete &lt;server> [&lt;username>]</code>:
uninstall K3S from the server</p></li><li><p><code>ops cloud k3s kubeconfig &lt;server> [&lt;username>]</code>:
retrieve the kubeconfig from the K3S server</p></li><li><p><code>ops cloud k3s info</code>: some information about the server</p></li><li><p><code>ops cloud k3s status</code>: status of the server</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-b4e9b33b69177f5f056217b0d67c2031>4.3.2.5 - Install MicroK8S</h1><div class=lead>Prerequisites to install OpenServerless in K8S</div><h2 id=install-microk8s-in-a-server>Install MicroK8S in a server</h2><p>You can install OpenServerless as
<a href=/docs/installation/install/server/>described here</a> and you do not need to
install any Kubernetes in it, as it is installed as part of the procedure. In
this case it installs K3S.</p><p>But you can <a href=/docs/installation/prereq/server/mk8s/#install-k8s>install MicroK8S</a> instead, if you
prefer. Check here for <a href=https://microk8s.io/>informations about MicroK8S</a>.</p><p>If you install MicroK8S in your server, you can then proceed
<a href=/docs/installation/configure/>configuring</a> and then installing OpenServerless
<a href=/docs/installation/install/cluster/>as in any other Kubernetes cluster</a>.</p><h3 id=install-k8s>Installing MicroK8S in a server</h3><p>Before installing ensure you have
<a href=/docs/installation/prereq/server/>satisfied the prerequisites</a>, most notably:</p><ol><li><p>you know the <strong>IP address or DNS name</strong></p></li><li><p>you have passwordless access with ssh</p></li><li><p>you have an user with passwordless sudo rights</p></li><li><p>you have opened the port <strong>16443</strong> in the firewall</p></li></ol><p>Furthermore, since MicroK8S is installed using <code>snap</code>, you also need to
<a href=https://snapcraft.io/docs/installing-snapd>install <code>snap</code></a>.</p><blockquote><p>💡 <strong>NOTE</strong></p><p>While <code>snap</code> is available for many linux distributions, it is typically
pre-installed and well supported in in Ubuntu and its derivatives. So we
recommend MicroK8S only if you are actually using an Ubuntu-like Linux
distribution.</p></blockquote><p>If you system is suitable to run MicroK8S you can use the following
subcommand to install in the server:</p><pre><code>ops cloud mk8s create SERVER=&lt;server&gt; USERNAME=&lt;username&gt;
</code></pre><p>where <code>&lt;server></code> is <strong>IP address or DNS name</strong> to access the server, and
<code>&lt;username></code> is the user you use to access the server.</p><p>Those informations should have been provided when provisioning the
server.</p><blockquote><p>❗ <strong>IMPORTANT</strong></p><p>If you installed a Kubernetes cluster in the server in this way, you
should proceed installing OpenServerless as in
<a href=/docs/installation/install/cluster/>a Kubernetes cluster</a>, <strong>not</strong> as a server.</p></blockquote><p>The installation retrieves also a kubernets configuration file so you
can proceed to installing it without any other step involved.</p><h3 id=additional-commands>Additional Commands</h3><p>In addition to <code>create</code> you have available also the following
subcommands:</p><ul><li><p><code>ops cloud mk8s delete SERVER=&lt;server> USERNAME=&lt;username></code>:
uninstall K3S from the server</p></li><li><p><code>ops cloud mk8s kubeconfig SERVER=&lt;server> USERNAME=&lt;username></code>:
retrieve the kubeconfig from the MicroK8S server</p></li><li><p><code>ops cloud mk8s info</code>: informations about the server</p></li><li><p><code>ops cloud mk8s status</code>: status of the server</p></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-f32ce604d7868701850b6029ab564835>4.3.3 - Kubernetes Cluster</h1><div class=lead>Install OpenServerless in a Kubernetes cluster</div><h2 id=prerequisites-to-install-openserverless-in-a-kubernetes-cluster>Prerequisites to install OpenServerless in a Kubernetes cluster</h2><p>You can install OpenServerless in any Kubernetes cluster which
<a href=/docs/installation/prereq/kubernetes/cluster/>satisfy some requirements</a>.</p><p>Kubernetes clusters are available pre-built from a variety of cloud
providers. We provide with our <code>ops</code> tool the commands to install a
Kubernetes cluster ready for OpenServerless in the following
environments:</p><ul><li><p><a href=/docs/installation/prereq/kubernetes/eks/>Amazon EKS</a></p></li><li><p><a href=/docs/installation/prereq/kubernetes/aks/>Azure AKS</a></p></li><li><p><a>Google GKE</a></p></li><li><p><a>RedHat OpenShift</a></p></li></ul><p>You can also provision a suitable cluster by yourself, in any cloud or
on premises, ensuring the prerequites are satisfied.</p><p>Once provisioned, you will receive a configuration file to access the
cluster, called <code>kubeconfig</code>.</p><p>This file should be placed in <code>~/.kube/config</code> to give access to the
cluster</p><p>If you have this file, you can check if you have access to the cluster
with the command:</p><pre><code>ops debug kube info
</code></pre><p>You should see something like this:</p><pre><code>Kubernetes control plane is running at https://xxxxxx.yyy.us-east-1.eks.amazonaws.com
</code></pre><p>Once you have got access to the Kubernetes cluster, either installing
one with out commands or provisioning one by yourself, you can proceed
<a href=/docs/installation/configure/>configuring the installation</a> and then
<a href=/docs/installation/install/cluster/>installing OpenServerless</a> in the
cluster.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-1fd119711d8fba54dc56350b34daad88>4.3.3.1 - Amazon EKS</h1><div class=lead>Prerequisites for Amazon EKS</div><h2 id=prerequisites-to-install-openserverless-in-an-amazon-eks-cluster>Prerequisites to install OpenServerless in an Amazon EKS Cluster</h2><p><a href=https://aws.amazon.com/eks/>Amazon EKS</a> is a pre-built Kubernetes
cluster offered by the cloud provider <a href=https://aws.amazon.com/>Amazon Web
Services</a>.</p><p>You can create an EKS Cluster in Amazon AWS for installing using
OpenServerless using <a href=/docs/installation/download/>ops</a> as follows:</p><ol><li><p>install <code>aws</code>, the <a href=/docs/installation/prereq/kubernetes/eks/#install-cli>AWS CLI</a></p></li><li><p>get <a href=/docs/installation/prereq/kubernetes/eks/#get-credentials>Access and Secret Key</a></p></li><li><p><a href=/docs/installation/prereq/kubernetes/eks/#configure>configure EKS</a></p></li><li><p><a href=/docs/installation/prereq/kubernetes/eks/#provision>provision EKS</a></p></li><li><p>optionally, retrieve the <a href=/docs/installation/prereq/kubernetes/eks/#retrieve-lb>load balancer address</a> to
configure a DNS name</p></li></ol><p>Once you have EKS up and running you can proceed
<a href=/docs/installation/prereq/kubernetes/eks/#configure.adoc>configuring</a> and <a href=/docs/installation/prereq/kubernetes/eks/#install-cluster.adoc>installing
OpenServerless</a>.</p><h3 id=install-cli>Installing the AWS CLI</h3><p>Our cli <code>ops</code> uses under the hood the <a href=https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-getting-started.html>AWS CLI version
2</a>,
so you need to dowload and install it <a href=https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html>following those
instructions</a>.</p><p>Once installed, ensure it is available on the terminal executing the
following command:</p><pre><code>aws --version
</code></pre><p>you should receive something like this:</p><pre><code>aws-cli/2.9.4 Python/3.9.11 Linux/5.19.0-1025-aws exe/x86_64.ubuntu.22 prompt/off
</code></pre><p>Ensure the version is at least 2.</p><h3 id=get-credentials>Getting the Access and Secret key</h3><p>Next step is to retrieve credentials, in the form of an access key and a
secret key.</p><p>So you need to: * access the AWS console <a href=https://repost.aws/knowledge-center/create-access-key>following those
instructions</a>
create an access key and secret key, * give to the credentials the
minimum required permissions <a href=https://eksctl.io/usage/minimum-iam-policies/>as described
here</a> to build an EKS
cluster.</p><p>You will end up with a couple of string as follows:</p><pre><code>Sample AWS Access Key ID: AKIAIOSFODNN7EXAMPLE Sample AWS Secret Access
Key: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
</code></pre><p>Take note of them as you need them for configuring out CLI.</p><h3 id=configure>Configuring Amazon EKS</h3><p>Once you have the access and secret key you can configure EKS with the
command <code>ops config eks</code> answering to all the questions, as in the
following example:</p><pre><code>$ ops config eks
*** Please, specify AWS Access Id and press enter.
AKIAIOSFODNN7EXAMPLE
*** Please, specify AWS Secret Key and press enter.
wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY
*** Please, specify AWS Region to use and press enter.
To get a list of valid values use:
  aws ec2 describe-regions --output table

Just press enter for default [us-east-2]:

*** Please, specify AWS public SSH key  and press enter.
If you already have a public SSH key in AWS, provide its name here.
If you do not have it, generate a key pair with the following command:
  ssh-keygen
The public key defaults to ~/.ssh/id_rsa.pub and you can import with:
  aws ec2 import-key-pair --key-name nuvolaris-key --public-key-material --region=&lt;your-region&gt; fileb://~/.ssh/id_rsa.pub

Just press enter for default [nuvolaris-key]:

*** Please, specify EKS Name for Cluster and Node Group and press enter.
Just press enter for default [nuvolaris]:

*** Please, specify EKS region and press enter.
To get a list of valid values use:
  aws ec2 describe-regions --output table

Just press enter for default [us-east-1]:

*** Please, specify EKS number of worker nodes and press enter.
Just press enter for default [3]:

*** Please, specify EKS virtual machine type and press enter.
To get a list of valid values, use:
  aws ec2 describe-instance-types --query 'InstanceTypes[].InstanceType' --output table

Just press enter for default [m5.xlarge]:

*** Please, specify EKS disk size in gigabyte and press enter.
Just press enter for default [50]:

*** Please, specify EKS Kubernetes Version and press enter.
Just press enter for default [1.25]:
</code></pre><h3 id=provision>Provisioning Amazon EKS</h3><p>Once you have configured it, you can create the EKS cluster with the
command:</p><pre><code>ops cloud eks create
</code></pre><p>It will take around 20 minutes to be ready. Please be patient.</p><p>At the end of the process, you will have access directly to the created
Kubernetes cluster for installation.</p><h3 id=retrieve-lb>Retrieving the Load Balancer DNS name</h3><p>Once the cluster is up and running, you need to retrieve the DNS name of
the load balancer.</p><p>You can read this with the command:</p><pre><code>ops cloud eks lb
</code></pre><p>Take note of the result as it is required for
<a href=/docs/installation/configure/dns/>configuring a dns name</a> for your cluster.</p><h3 id=additional-commands>Additional Commands</h3><p>You can delete the created cluster with: <code>ops cloud eks delete</code></p><p>You can extract again the cluster configuration, if you lose it,
reconfiguring the cluster and then using the command
<code>ops cloud eks kubeconfig</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c5304e0f61e6fb87af4b9940c2922fec>4.3.3.2 - Azure AKS</h1><div class=lead>Prerequisites for Azure AKS</div><h2 id=prerequisites-to-install-openserverless-in-an-azure-aks-cluster>Prerequisites to install OpenServerless in an Azure AKS Cluster</h2><p><a href=https://aws.amazon.com/eks/>Azure AKS</a> is a pre-built Kubernetes
cluster offered by the cloud provider <a href=https://azure.microsoft.com/>Microsoft Azure</a>.</p><p>You can create an AKS Cluster in Microsoft Azure for installing using
OpenServerless using <a href=/docs/installation/prereq/kubernetes/aks/#download.adoc>ops</a> as follows:</p><ol><li><p>install <code>az</code>, the <a href=/docs/installation/prereq/kubernetes/aks/#install-cli>Azure CLI</a></p></li><li><p><a href=/docs/installation/prereq/kubernetes/aks/#configure>configure AKS</a></p></li><li><p><a href=/docs/installation/prereq/kubernetes/aks/#provision>provision AKS</a></p></li><li><p>optionally, retrieve the <a href=/docs/installation/prereq/kubernetes/aks/#retrieve-lb>load balancer address</a> to
configure a DNS name</p></li></ol><p>Once you have AKS up and running you can proceed
<a href=/docs/installation/prereq/kubernetes/aks/#configure.adoc>configuring</a> and <a href=/docs/installation/prereq/kubernetes/aks/#install-cluster.adoc>installing
OpenServerless</a>.</p><h3 id=install-cli>Installing the Azure CLI</h3><p>Our CLI <code>ops</code> uses under the hood the <a href=https://learn.microsoft.com/en-us/cli/azure/>Azure
CLI</a>, so you need to
dowload and install it
<a href=https://learn.microsoft.com/en-us/cli/azure/install-azure-cli>following those instructions</a>.</p><p>Once installed, ensure it is available on the terminal executing the
following command:</p><pre><code>az version
</code></pre><p>you should receive something like this:</p><pre><code>{
  &quot;azure-cli&quot;: &quot;2.51.0&quot;,
  &quot;azure-cli-core&quot;: &quot;2.51.0&quot;,
  &quot;azure-cli-telemetry&quot;: &quot;1.1.0&quot;,
  &quot;extensions&quot;: {}
}
</code></pre><h3 id=configure>Configuring Azure AKS</h3><p>Before provisioning your AKS cluster you need to configure AKS with the
command <code>ops config aks</code> answering to all the questions, as in the
following example:</p><pre><code>$ ops config aks
*** Please, specify AKS Name for Cluster and Resource Group and press enter.
Just press enter for default [nuvolaris]:

*** Please, specify AKS number of worker nodes and press enter.
Just press enter for default [3]:

*** Please, specify AKS location and press enter.
To get a list of valid values use:
  az account list-locations -o table

Just press enter for default [eastus]:

*** Please, specify AKS virtual machine type and press enter.
To get a list of valid values use:
  az vm list-sizes --location &lt;location&gt; -o table
where &lt;location&gt; is your current location.

Just press enter for default [Standard_B4ms]:

*** Please, specify AKS disk size in gigabyte and press enter.
Just press enter for default [50]:

*** Please, specify AKS public SSH key in AWS and press enter.
If you already have a public SSH key provide its path here. If you do not have it, generate a key pair with the following command:
  ssh-keygen
The public key defaults to ~/.ssh/id_rsa.pub.

Just press enter for default [~/.ssh/id_rsa.pub]:
</code></pre><h3 id=provision>Provisioning Azure AKS</h3><p>Once you have configured it, you can create the AKS cluster with the
command:</p><pre><code>ops cloud aks create
</code></pre><p>It will take around 10 minutes to be ready. Please be patient.</p><p>At the end of the process, you will have access directly to the created
Kubernetes cluster for installation.</p><h3 id=retrieve-lb>Retrieving the Load Balancer DNS name</h3><p>Once the cluster is up and running, you need to retrieve the DNS name of
the load balancer.</p><p>You can read this with the command:</p><pre><code>ops cloud aks lb
</code></pre><p>Take note of the result as it is required for
<a href=/docs/installation/configure/dns/>configuring a dns name</a> for your cluster.</p><h3 id=additional-commands>Additional Commands</h3><p>You can delete the created cluster with: <code>ops cloud aks delete</code></p><p>You can extract again the cluster configuration, if you lose it,
reconfiguring the cluster and then using the command
<code>nuv cloud aks kubeconfig</code>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e0ed70c138e5d50c8207cdcc1a07f4e0>4.3.3.3 - Generic Kubernetes</h1><div class=lead>Prerequisites for all Kubernetes</div><h2 id=kubernetes-cluster-requirements>Kubernetes Cluster requirements</h2><p>OpenServerless installs in any Kubernetes cluster which satisfies the
following requirements:</p><ul><li><p><code>cluster-admin</code> access</p></li><li><p>at least 3 worker nodes with 4GB of memory each</p></li><li><p>support for block storage configured as default storage class</p></li><li><p>support for LoadBalancer services</p></li><li><p>the <a href=https://github.com/kubernetes/ingress-nginx>nginx ingress</a>
already installed</p></li><li><p>the <a href=https://cert-manager.io/>cert manager</a> already installed</p></li></ul><p>Once you have such a cluster, you need to retrieve the IP address of the
Load Balancer associated with the Nginx Ingress. In the default
installation, it is installed in the namespace <code>nginx-ingress</code> and it is
called <code>ingress-nginx-controller</code>.</p><p>In the default installation you can read the IP address with the
following command:</p><pre><code>kubectl -n ingress-nginx get svc ingress-nginx-controller
</code></pre><p>If you have installed it in some other namespace or with another name,
change the command accordingly.</p><p>The result should be something like this:</p><pre><code>NAME                       TYPE           CLUSTER-IP   EXTERNAL-IP    PORT(S)                      AGE
ingress-nginx-controller   LoadBalancer   10.0.9.99    20.62.156.19   80:30898/TCP,443:31451/TCP   4d1h
</code></pre><p>Take note of the value under <strong>EXTERNAL-IP</strong> as you need it in the next
step of installation, <a href=/docs/installation/configure/dns/>configuring DNS</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-f6b9a66f9506e4a7437691a389daca4f>4.4 - Configure OpenServerless</h1><h2 id=configuring-openserverless-installation>Configuring OpenServerless Installation</h2><p>This section guides configuring the OpenServerless installation.</p><p>Note that you can also skip this configuration, and install
OpenServerless without any configuration.</p><p>Once you configure the installation, you can proceed to
<a href=/docs/installation/install/>Install OpenServerless</a>.</p><p>You can then reconfigure the system later.</p><h3 id=minimal-configuration>Minimal Configuration</h3><p>Without any configuration, you get a minimal OpenServerless:</p><ul><li><p>only the serverless engine, no extra services</p></li><li><p>accessible is only in <code>http</code></p></li></ul><p>You can:</p><ul><li><p><a href=/docs/installation/configure/dns/>configure a DNS name or wildcard</a> for your server
or cluster, thus enabling SSL and static publishing.</p></li><li><p><a href=/docs/installation/configure/services/>enable some or all</a> of the integrated
services:</p><ul><li><p><a href=/docs/installation/configure/services/#static>Static</a>, publishing of static
content</p></li><li><p><a href=/docs/installation/configure/services/#redis>REDIS</a>, a powerful key-value store</p></li><li><p><a href=/docs/installation/configure/services/#minio>MinIO</a>, an object storage</p></li><li><p><a href=/docs/installation/configure/services/#postgres>Postgres</a>, a powerful SQL
database</p></li><li><p><a href=/docs/installation/configure/services/#ferretdb>FerretDB</a> a NO-SQL, MongoDB
compatible adapter for Postgres</p></li></ul></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-be207599c3aa71cb110feb062b890918>4.4.1 - DNS and SSL</h1><div class=lead>Configuring DNS and SSL</div><h2 id=dns-and-ssl>Configuring DNS and SSL</h2><p>You can use OpenServerless as just as a serverless engine, and use the
default IP or DNS provided when provisioned your server or cluster. If
you do so, only http is avaialble, and it is not secure.</p><p>If you want your server or cluster is available with a well-known
internet name, you can associate the <strong>IP address</strong> or the &ldquo;ugly&rdquo;
default DNS name of serveres or clusters to a DNS name of your choice,
to use it also to publish the static front-end of your server.</p><p>Furthermore, once you decided for a DNS name for your server, you can
enable the provisioning of an SSL certificate so you server will be
accessible with <code>https</code>.</p><p>In order to configure the DNS and the SSL the steps are:</p><ol><li><p><a href=/docs/installation/configure/dns/#ip-or-dns>retrieve the IP address or the the DNS name</a> of your
server or cluster</p></li><li><p><a href=/docs/installation/configure/dns/#register-dns>register a DNS name</a> of your choice with your
registration name provider</p></li><li><p><a href=/docs/installation/configure/dns/#configure-apihost>configure OpenServerless</a> so he knows of the DNS and
SSL and can use it</p></li></ol><h3 id=ip-or-dns>Retrieving the IP address or the DNS name</h3><p>If OpenServerless is installed in your local machine with Docker, cannot
configure any DNS nor SSL, so you can proceed <a href=/docs/installation/configure/services/>configuring the
services</a>.</p><p>If OpenServerless is installed in a single server, after you
<a href=/docs/installation/prereq/server/>satisfied the server prerequisites</a> you will
know the <strong>IP address or DNS name of you server</strong>.</p><p>If OpenServerless is installed in a Kubernetes cluster, after you
<a href=/docs/installation/prereq/server/>satisfied the server cluster</a> prerequisites
you know either the <strong>IP address or the DNS name of the load balancer</strong>.</p><h3 id=register-dns>Register a DNS name or wildcard</h3><p>Using the address of your server or cluster, you need either to
configure a DNS name your already own or <a href=https://www.icann.org/en/accredited-registrars>contact a domain name
registrar</a> to register a
new DNS name dedicated to your server or cluster.</p><p>You need at least one DNS name in a domain you control, for example
<code>nuvolaris.example.com</code> that points to you IP or address.</p><p>Note that:</p><ul><li><p>If you have an IP address to your load balancer you need to
configure an <code>A</code> record mapping <code>nuvolaris.example.com</code> to the IP
address of your server.</p></li><li><p>If you have a DNS name to your load balancer, you need to configure
a <code>CNAME</code> record mapping <code>nuvolaris.example.com</code> to the DNS name of
your server.</p></li></ul><blockquote><p>💡 <strong>NOTE</strong></p><p>If you are registering a dedicated domain name for your cluster, you are
advised to register wildcard name (<code>*</code>) for every domain name in
<code>example.com</code> will resolve to your server.</p></blockquote><p>Registering a wildcard is required to get a different website for for
multiple users.</p><h3 id=configure-apihost>Configure OpenServerless to use your DNS and and enable SSL</h3><p>Once you registrered a single DNS (for example <code>openserverless.example.com</code>)
or a wildcard DNS name (for example <code>*.example.com</code>) you can communicate
to the installer what is the main DNS name of your cluster or server, as
it is not able to detect it automatically. We call this the <code>&lt;apihost></code></p><blockquote><p>💡 <strong>NOTE</strong></p><p>If you have registered a single DNS name, like <code>openserverless.example.com</code>
use this name as <code>&lt;apihost></code>.</p><p>If you have registered a wildcard DNS name, you have to choose a DNS
name to be used as <code>&lt;apihost></code>.</p><p>We recommended you use a name starting with <code>api</code> since to avoid
clashes, user and domain names starting with <code>api</code> are reserved. So if
you have a <code>*.example.com</code> wildcard DNS available, use <code>api.example.com</code>
as your <code>&lt;apihost></code></p></blockquote><p>Once you decided what is your API host, you can configure this as
follows:</p><pre><code>ops config apihost &lt;apihost&gt;
</code></pre><p>This configuration will assign a well know DNS name as access point of
your OpenServerless cluster. However note it does <strong>NOT</strong> enable SSL.
Accessing to your cluster will happen using HTTP.</p><p>Since requests contain sensitive information like security keys, this is
<strong>highly insecure</strong>. You hence do this only for development or testing
but <strong>never</strong> for production.</p><p>Once you have a DNS name, enabling <code>https</code> is pretty easy, since we can
do it automatically using the free service <code>Let's Encrypt</code>. We have
however to provide a valid email address <code>&lt;email></code>.</p><p>Once you know your <code>&lt;apihost></code> and the <code>&lt;email></code> to receive
communications from Let’s Encrypt (mostly, when a domain name is
invalidated and needs to be renewed), you can configure your apihost and
enable SSL as follows:</p><pre><code>ops config apihost &lt;apihost&gt; --tls=&lt;email&gt;
</code></pre><p>Of course, replace the <code>&lt;apihost></code> with the actual DNS name you
registered, and <code>&lt;email></code> with your email address</p></div><div class=td-content style=page-break-before:always><h1 id=pg-29e1dfdb1ff6aee88ce1de74e2c1f27d>4.4.2 - Services</h1><div class=lead>Configure OpenServerless services</div><h2 id=configuring-openserverless-services>Configuring OpenServerless services</h2><p>After you satisfied the <a href=/docs/installation/configure/services/#../../prereq/index.adoc>prerequisites</a> and
before you actually <a href=/docs/installation/configure/services/#../../install/index.adoc>install</a> OpenServerless, you
have to select which services you want to install:</p><ul><li><p><a href=/docs/installation/configure/services/#static>Static</a>, publishing of static assets</p></li><li><p><a href=/docs/installation/configure/services/#redis>Redis</a>, a storage service</p></li><li><p><a href=/docs/installation/configure/services/#minio>MinIO</a> an object storage service</p></li><li><p><a href=/docs/installation/configure/services/#postgres>Postgres</a> a relational SQL database</p></li><li><p><a href=/docs/installation/configure/services/#ferretdb>FerretDB</a> A MongoDB-compatible adapter for Postgres</p></li></ul><p>You can enable all the services with:</p><pre><code>ops config enable --all
</code></pre><p>or disable all of them with:</p><pre><code>ops config disable --all
</code></pre><p>Or select the services you want, as follows.</p><h3 id=static>Static Asset Publishing</h3><p>The static service allows you to publish static asset.</p><blockquote><p>💡 <strong>NOTE</strong></p><p>you need to setup a <a href=/docs/installation/configure/dns/#register-dns>a wildcard DNS name</a>
to be able to access them from Internet.</p></blockquote><p>You can enable the Static service with:</p><pre><code>ops config enable --static
</code></pre><p>and disable it with:</p><pre><code>ops config disable --static
</code></pre><h3 id=redis>Redis</h3><p><a href=https://redis.io>Redis</a>, is a fast, in-memory key-value store, usually
used as cache, but also in some cases as a (non-relational) database.</p><p>Enable REDIS:</p><pre><code>ops config enable --redis
</code></pre><p>Disable REDIS:</p><pre><code>ops config disable --redis
</code></pre><h3 id=minio>MinIO</h3><p><a href=https://min.io>MinIO</a> is an object storage service</p><p>Enable minio:</p><pre><code>ops config enable --minio
</code></pre><p>Disable minio:</p><pre><code>ops config disable --minio
</code></pre><h3 id=postgres>Postgres</h3><p><a href=https://www.postgresql.org>Postgres</a> is an SQL (relational) database.</p><p>Enable postgres:</p><pre><code>ops config enable --postgres
</code></pre><p>Disable postgres:</p><pre><code>ops config disable --postgres
</code></pre><h3 id=ferret>FerretDB</h3><p><a href=https://www.ferretdb.io>FerretDB</a> is a MongoDB-compatible adapter for
Postgres. It created a document-oriented database service on top of
Postgres.</p><blockquote><p>💡 <strong>NOTE</strong></p><p>Since FerretDB uses Postgres as its storage, if you enable it, also the
service Postgresql will be enabled as it is required.</p></blockquote><p>Enable MongoDB api with FerretDB:</p><pre><code>ops config enable --mongodb
</code></pre><p>Disable MongoDB api with FerretDB:</p><pre><code>ops config disable --mongodb
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-234d738d46569ad9a8a7ae7fed565a21>4.5 - Install OpenServerless</h1><h2 id=installation-overview>Installation Overview</h2><p>This page provides an overview of the installation process.</p><h3 id=before-installation>Before installation</h3><p>Please ensure you have:</p><ul><li><a href=/docs/installation/download/>downloaded the installer</a></li><li><a href=/docs/installation/prereq/>satisfied the prerequisites</a></li><li><a href=/docs/installation/configure/>configured your installation</a></li></ul><h3 id=core-installation>Core Installation</h3><p>Once you have completed the preparation steps, you can proceed with:</p><ul><li>a local installation on your
<a href=/docs/installation/install/local/>local machine</a></li><li>a single server installation on a
<a href=/docs/installation/install/server/>Linux server</a></li><li>a clustered installation on a
<a href=/docs/installation/install/cluster/>Kubernetes cluster</a>.</li></ul><blockquote><p>💡 <strong>NOTE</strong></p><p>The install process will notify nuvolaris creators with the type of installation (for example: clustered or server installation), no other info will be submitted. If you want to disable the notification, you can execute the following command before the setup command:</p></blockquote><pre><code>ops -config DO_NOT_NOTIFY_NUVOLARIS=1
</code></pre><h3 id=post-installation>Post installation</h3><p>After the installation, you can consult the development guide
for informations how to reconfigure and update the system.</p><h3 id=support>Support</h3><p>If something goes wrong, you can check:</p><ul><li>the <a href=/docs/installation/debug/>Troubleshooting</a> page</li><li>our online <a href=http://nuvolaris.discourse.group>Forum</a></li></ul></div><div class=td-content style=page-break-before:always><h1 id=pg-468eb1c803501e0c8fee24ddc1d4914c>4.5.1 - Docker</h1><div class=lead>Install OpenServerless on a local machine</div><h2 id=local-docker-installation>Local Docker installation</h2><p>This page describes how to install OpenServerless on your local machine. The
services are limited and not accessible from the outside so it is an
installation useful only for <b>development purposes</b>.</p><h3 id=prerequisites>Prerequisites</h3><p>Before installing, you need to:</p><ul><li><p>install <a href=/docs/installation/prereq/docker/>Docker</a>.</p></li><li><p>install <a href=/docs/installation/download/>ops</a>.</p></li><li><p>perform a minimal configuration. For more details about this,
check <a href=/docs/installation/configure/>Configure the services</a>.</p></li></ul><style>blockquote.warning{border-color:#b91900!important}blockquote.important{border-color:#e7c416!important}</style><blockquote class=info><p class=quote-title>💡 <strong>NOTE</strong></p><p>The static service works perfectly for the default namespace nuvolaris which is linking the http://localhost to the
nuvolaris web bucket. With this setup adding new users will add an ingress with host set to
namespace.localhost, that in theory could also work if the host file of the development machine is configured
to resolve it to the 127.0.0.1 ip address.</p></blockquote><style>blockquote.warning{border-color:#b91900!important}blockquote.important{border-color:#e7c416!important}</style><blockquote class=warning><p class=quote-title>⚠ <strong>WARNING</strong></p><p>You cannot have <code>https</code> in a local installation.
If you enable it, the configuration will be ignored.</p></blockquote><h3 id=installation>Installation</h3><p>Run the commands:</p><ol><li>Minimal configuration</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops config minimal
</span></span></code></pre></div><p>Behind the scene, this command will write a cluster configuration file called <code>~/.ops/config.json</code> activating these
services: <code>static</code>, <code>redis</code>, <code>postgres</code>, <code>ferretdb</code>, <code>minio</code>, <code>cron</code> constituting the common baseline for development
tasks.</p><ol start=2><li>Setup the cluster</li></ol><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops setup devcluster
</span></span></code></pre></div><p>and wait until the command terminates.</p><details><summary>Click here to see a log sample of the setup</summary><div><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops setup devcluster
</span></span><span style=display:flex><span>Creating cluster <span style=color:#4e9a06>&#34;nuvolaris&#34;</span> ...
</span></span><span style=display:flex><span> ✓ Ensuring node image <span style=color:#ce5c00;font-weight:700>(</span>kindest/node:v1.25.3<span style=color:#ce5c00;font-weight:700>)</span> 🖼
</span></span><span style=display:flex><span> ✓ Preparing nodes 📦 📦
</span></span><span style=display:flex><span> ✓ Writing configuration 📜
</span></span><span style=display:flex><span> ✓ Starting control-plane 🕹️
</span></span><span style=display:flex><span> ✓ Installing CNI 🔌
</span></span><span style=display:flex><span> ✓ Installing StorageClass 💾
</span></span><span style=display:flex><span> ✓ Joining worker nodes 🚜
</span></span><span style=display:flex><span> ✓ Waiting ≤ 1m0s <span style=color:#204a87;font-weight:700>for</span> control-plane <span style=color:#ce5c00;font-weight:700>=</span> Ready ⏳
</span></span><span style=display:flex><span> • Ready after 1s 💚
</span></span><span style=display:flex><span>Set kubectl context to <span style=color:#4e9a06>&#34;kind-nuvolaris&#34;</span>
</span></span><span style=display:flex><span>You can now use your cluster with:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>kubectl cluster-info --context kind-nuvolaris --kubeconfig /Users/bruno/.ops/tmp/kubeconfig
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Thanks <span style=color:#204a87;font-weight:700>for</span> using kind!
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>[</span>...continue<span style=color:#ce5c00;font-weight:700>]</span>
</span></span></code></pre></div><blockquote><p>💡 <strong>NOTE</strong></p><p>The log will continue because, after kind is up and running, OpenServerless namespace and relative services are
installed inside.</p></blockquote><p>It will take some minute to complete, so be patient.</p></div></details><h3 id=troubleshooting>Troubleshooting</h3><p>Usually the setup completes without errors.</p><p>However, if <code>ops</code> is unable to complete the setup, you may see this message at the end:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>ops: Failed to run task &#34;create&#34;: exit status 1
</span></span><span style=display:flex><span>task execution error: ops: Failed to run task &#34;create&#34;: exit status 1
</span></span><span style=display:flex><span>ops: Failed to run task &#34;devcluster&#34;: exit status 1
</span></span><span style=display:flex><span>task execution error: ops: Failed to run task &#34;devcluster&#34;: exit status 1
</span></span></code></pre></div><p>If this is your case, try to perform a uninstall / reinstall:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops setup cluster --uninstall
</span></span><span style=display:flex><span>ops config reset
</span></span><span style=display:flex><span>ops config minimal
</span></span><span style=display:flex><span>ops setup devcluster
</span></span></code></pre></div><p>If this will not solve, please contact the community.</p><h3 id=post-install>Post install</h3><p><a href=/docs/tutorial/>Check the tutorial</a> to learn how to use it.</p><h3 id=uninstall>Uninstall</h3><p>To uninstall you may:</p><h4 id=uninstall-devcluster>Uninstall devcluster</h4><p>This will actually remove the ops namespace and all the services from kind.
Useful to re-try an installation when something gone wrong.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops setup cluster --uninstall
</span></span><span style=display:flex><span>ops config reset
</span></span></code></pre></div><h4 id=remove-devcluster>Remove devcluster</h4><p>This will actually remove the nodes from kind:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>ops setup devcluster --uninstall
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-2a348e473e676744aeb27b6b290fa85c>4.5.2 - Linux Server</h1><div class=lead>Install on a Linux Server</div><h2 id=server-installation>Server Installation</h2><p>This page describes how to install OpenServerless on a Linux server
accessible with SSH.</p><p>This is a single node installation, so it is advisable only for
development purposes.</p><h3 id=prerequisites>Prerequisites</h3><p>Before installing, you need to:</p><ol><li><p>install the OpenServerless CLI <a href=/docs/installation/download/>ops</a>;</p></li><li><p>provision a <a href=/docs/installation/prereq/server/>server running a Linux operating system</a>,
either a virtual machine or a physical server, and you know its IP address
or DNS name;</p></li><li><p>configure it to have <a href=/docs/installation/prereq/server/generic/>passwordless ssh access and sudo rights</a>;</p></li><li><p>open the firewall to have access to ports 80, 443 and 6443 or 16443
from your client machine;</p></li><li><p><a href=/docs/installation/configure/dns/>configure</a> the DNS name for the server and choose
the services you want to enable;</p></li></ol><h3 id=installation>Installation</h3><p>If the prerequisites are satisfied, execute the dommand:</p><pre><code>ops setup server &lt;server&gt; &lt;user&gt;
</code></pre><blockquote><p>❗ <strong>IMPORTANT</strong></p><p>Replace in the command before <code>&lt;server></code> with the IP address or DNS name
used to access the server, and <code>&lt;user></code> with the username you have to
use to access the server</p></blockquote><p>Wait until the command completes and you will have OpenServerless up and
running.</p><h3 id=post-install>Post Install</h3><ul><li><p><a href=/docs/tutorial/>Check the tutorial</a> to learn how to use it.</p></li><li><p>To uninstall, execute the command:</p></li></ul><pre tabindex=0><code>ops setup server &lt;server&gt; &lt;user&gt; --uninstall
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-e2ad6ea02f40220590e02be2e3387f01>4.5.3 - Kubernetes cluster</h1><div class=lead>Install OpenServerless on a Kubernetes Cluster</div><h2 id=cluster-installation>Cluster Installation</h2><p>This section describes how to install OpenServerless on a Kubernetes Cluster</p><h3 id=prerequisites>Prerequisites</h3><p>Before installing, you need to:</p><ul><li><p><a href=/docs/installation/prereq/kubernetes/>Provision</a> a Kubernetes Cluster</p></li><li><p><a href=/docs/installation/configure/>Configure</a> the installation</p></li><li><p>install <a href=/docs/installation/download/>Download and install</a> OpenServerless CLI, <code>ops</code>.</p></li></ul><h3 id=installation>Installation</h3><p>If you have a Kubernetes cluster directly accessible with its
configuration, or you provisioned a cluster in some cloud using <code>ops</code>
embedded tools, you just need to type:</p><pre><code>ops setup cluster
</code></pre><p>Sometimes the kubeconfig includes access to multiple Kubernetes
instances, each one identified by a different <code>&lt;context></code> name. You can
install the OpenServerless cluster in a specified <code>&lt;context></code> with:</p><pre><code>ops setup cluster &lt;context&gt;
</code></pre><h3 id=post-install>Post Install</h3><ul><li><p><a href=/docs/tutorial/>Check the tutorial</a> to learn how to use it.</p></li><li><p>To uninstall, execute the command:</p></li></ul><pre tabindex=0><code>ops setup cluster --uninstall
</code></pre></div><div class=td-content style=page-break-before:always><h1 id=pg-c7d6e75a293d35b4ca7156b87967599c>4.6 - Troubleshooting</h1><div class=lead>How to diagnose and solve issues</div><h2 id=debug>Debug</h2><p>This document gives you hints for diagnostics and solving issues, using
the (hidden) subcommand <code>debug</code>.</p><p>Note it is technical and assumes you have some knowledge of how
Kubernetes operates.</p><h3 id=watching>Watching</h3><p>While installing, you can watch the installation (opening another
terminal) with the command:</p><pre><code>ops debug watch
</code></pre><p>Check that no pods will go in error while deploying.</p><h3 id=configuration>Configuration</h3><p>You can inspect the configuration with the <code>ops debug subcommand</code></p><ul><li><p><strong>API host</strong>: <code>ops debug apihost</code></p></li><li><p><strong>Static Configuration</strong>: <code>ops debug config</code>.</p></li><li><p><strong>Current Status</strong>: <code>ops debug status</code></p></li><li><p><strong>Runtimes</strong>: <code>ops debug runtimes</code></p></li><li><p><strong>Load Balancer</strong>: <code>ops debug lb</code></p></li><li><p><strong>Images</strong>: <code>ops debug images</code></p></li></ul><h3 id=logs>Logs</h3><p>You can inspect logs with <code>ops debug log</code> subcommand. Logs you can show:</p><ul><li><p><strong>operator</strong>: <code>ops debug log operator</code> (continuously:
<code>ops debug log foperator</code>)</p></li><li><p><strong>controller</strong>: <code>ops debug log controller</code> (continuously:
<code>ops debug log fcontroller</code>)</p></li><li><p><strong>database</strong>: <code>ops debug log couchdb</code> (continuously:
<code>ops debug log fcouchdb</code>)</p></li><li><p><strong>certificate manager</strong>: <code>ops debug log certman</code>
(continuously: <code>ops debug log fcertmap</code>)</p></li></ul><h3 id=kubernetes>Kubernetes</h3><p>You can detect which Kubernetes are you using with:</p><p><code>ops debug detect</code></p><p>You can then inspect Kubernetes objects with:</p><ul><li><p><strong>namespaces</strong>: <code>ops debug kube ns</code></p></li><li><p><strong>nodes</strong>: <code>ops debug kube nodes</code></p></li><li><p><strong>pod</strong>: <code>ops debug kube pod</code></p></li><li><p><strong>services</strong>: <code>ops debug kube svc</code></p></li><li><p><strong>users</strong>: <code>ops debug kube users</code></p></li></ul><p>You can enter a pod by name (use <code>kube pod</code> to find the name) with:</p><pre><code>ops debug kube exec P=&lt;pod-name&gt;
</code></pre><h3 id=kubeconfig>Kubeconfig</h3><p>Usually, <code>ops</code> uses a hidden kubeconfig so does not override your
Kubernetes configuration.</p><p>If you want to go more in-depth and you are knowledgeable of Kubernetes,
you can export the kubeconfig with <code>ops debug export F=&lt;file></code>.</p><p>You can <strong>overwrite your kubeconfig</strong> (be aware there is no backup) with
<code>ops debug export F=-</code>.</p></div></main></div></div><footer class="td-footer row d-print-none"><div class=container-fluid><div class="disclaimer text-center"><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-2 order-sm-1">&nbsp;</div><div class="td-footer__right col-6 col-sm-2 order-sm-3">&nbsp;</div><div class="td-footer__center col-12 col-sm-8 py-2 order-sm-2"><p>Apache Openserverless™ is an effort undergoing incubation at The Apache Software Foundation (ASF),
sponsored by the Apache Incubator. Incubation is required of all newly accepted projects until a
further review indicates that the infrastructure, communications, and decision making process
have stabilized in a manner consistent with other successful ASF projects. While incubation
status is not necessarily a reflection of the completeness or stability of the code, it does
indicate that the project has yet to be fully endorsed by the ASF.</p><br><br><p>Copyright © 2024 The Apache Software Foundation, Licensed under the Apache License, Version 2.0.
Apache Openserverless, the names of other Apache projects, and the ASF logo are either
registered trademarks or trademarks of the Apache Software Foundation in the United States
and/or other countries.</p></div></div><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1">&nbsp;</div><div class="td-footer__right col-6 col-sm-4 order-sm-3">&nbsp;</div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><a href=https://www.apache.org/><img class="asf-logo rounded-image" src=/images/asf.webp width=256 height=104>
</a><a href=https://incubator.apache.org/projects/openserverless.html><img class="asf-logo rounded-image" src=/images/apache_incubator.webp width=256 height=104></a></div></div></div></div><div class=container-fluid><div class="row mx-md-2"><div class="td-footer__left col-6 col-sm-4 order-sm-1"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title="Developer mailing list" aria-label="Developer mailing list"><a target=_blank rel=noopener href=mailto:dev-subscribe@openserverless.apache.org aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=X.com aria-label=X.com><a target=_blank rel=noopener href=https://x.com/open_serverless aria-label=X.com><i class="fab fa-x-twitter"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Reddit aria-label=Reddit><a target=_blank rel=noopener href=https://reddit.com/r/openserverless aria-label=Reddit><i class="fab fa-reddit"></i></a></li></ul></div><div class="td-footer__right col-6 col-sm-4 order-sm-3"><ul class=td-footer__links-list><li class=td-footer__links-item data-bs-toggle=tooltip title=GitHub aria-label=GitHub><a target=_blank rel=noopener href=https://github.com/apache/openserverless aria-label=GitHub><i class="fab fa-github"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Slack aria-label=Slack><a target=_blank rel=noopener href=https://the-asf.slack.com/archives/C07B6K5R3F0 aria-label=Slack><i class="fab fa-slack"></i></a></li><li class=td-footer__links-item data-bs-toggle=tooltip title=Telegram aria-label=Telegram><a target=_blank rel=noopener href=https://t.me/+XhbCjBrkkaNkOWM0 aria-label=Telegram><i class="fab fa-telegram"></i></a></li></ul></div><div class="td-footer__center col-12 col-sm-4 py-2 order-sm-2"><span class=td-footer__copyright>&copy;
2024&ndash;2024
<span class=td-footer__authors>The Apache Software Foundation, Licensed under the Apache License, Version 2.0.</span></span><span class=td-footer__all_rights_reserved>All Rights Reserved</span></div></div></div></footer></div><script src=/js/main.min.69e2c1ae9320465ab10236d9ef752c6a4442c54b48b883b17c497b7c7d96a796.js integrity="sha256-aeLBrpMgRlqxAjbZ73UsakRCxUtIuIOxfEl7fH2Wp5Y=" crossorigin=anonymous></script><script src=/js/prism.js></script><script src=/js/tabpane-persist.js></script></body></html>